/**
 * @file DTPS Core functions and module loader
 * @author jottocraft
 * @version v3.0.4
 * 
 * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */
if(void 0!==dtps)throw"Error: DTPS is already loading";var dtps={ver:304,readableVer:"v3.0.4",env:window.jottocraftSatEnv||"prod",classes:[],baseURL:document.currentScript.src?String(document.currentScript.src).split("/")[0]+"//"+String(document.currentScript.src).split("/")[2]:"https://powerplus.app",unstable:"canary"==window.localStorage.dtpsLoaderPref||"debugging"==window.localStorage.dtpsLoaderPref||String(document.currentScript.src).includes("http://localhost"),gradebookExpanded:!1,updates:[],dashboardItems:[{name:"Calendar",id:"dtps.calendar",icon:"event",size:100,defaultSide:"left"},{name:"Updates",id:"dtps.updates",icon:"calendar_view_day",size:170,defaultSide:"left"},{name:"Due Today",id:"dtps.dueToday",icon:"check_circle_outline",size:20,defaultSide:"right"},{name:"Upcoming Assignments",id:"dtps.upcoming",icon:"view_stream",size:250,defaultSide:"right"}]};jQuery.getScript("https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"),document.addEventListener("fluidTheme",(function(e){if(dtps.oldTheme!==e.detail){dtps.oldTheme=e.detail;var s=window.getComputedStyle(document.getElementsByClassName("background")[0]).getPropertyValue("--grad");"dash"!==dtps.selectedClass&&(s="linear-gradient(to bottom right, "+(dtps.classes[dtps.selectedClass]&&dtps.classes[dtps.selectedClass].color)+", var(--background))"),"dash"!==dtps.selectedClass&&$("body").removeClass("dashboard"),$(".background").css("background",s),dtps.chroma()}})),dtps.class=function(){return dtps.classes[dtps.selectedClass]},dtps.isToday=function(e){var s=new Date,t=new Date(e);return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()},dtps.changelog=function(e){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js",(function(){markdown=new showdown.Converter,jQuery.getJSON("https://api.github.com/repos/jottocraft/dtps/releases/latest",(function(s){var t=markdown.makeHtml(s.body);jQuery(".card.changelog").html('<i onclick="fluid.cards.close(\'.card.changelog\')" class="material-icons close">close</i>'+t),e?Number(s.tag_name.replace(/[^0-9]/g,""))>Number(window.localStorage.dtps)&&(localStorage.setItem("dtps",s.tag_name.replace(/[^0-9]/g,"")),s.tag_name.includes("s")||(fluid.cards.close(".card.focus"),fluid.cards(".card.changelog"))):(fluid.cards.close(".card.focus"),fluid.cards(".card.changelog"))}))}))},dtps.log=function(e){"dev"==dtps.env&&console.log("[DTPS]",e)},dtps.error=function(e,s,t){if(null!==t){var a="";s&&(a='<div style="font-size: 12px; color: var(--secText, gray); margin-top: 10px;">'+s+"</div>"),console.error("[DTPS !!ERROR!!]",s+": ",t),fluid.alert("Error",e+a,"error")}},dtps.firstrun=function(){window.localStorage.setItem("dtps",dtps.ver),jQuery(".card.changelog").html(`\n        <h3 style="margin-bottom: 0px;">Welcome to Power+</h3>\n        <h5 style="color: var(--secText); font-weight: bold; font-size: 22px;">${dtps.readableVer}</h5>\n\n        <div class="welcomeSection">\n            <i class="material-icons">dashboard</i>\n            <h5>${dtpsLMS.gradebook?"Manage your coursework and grades":"Manage your coursework"}</h5>\n            <p>Power+ organizes all of your coursework so you can easily see what you need to do next. The dashboard shows upcoming assignments, recent grades, and announcements.\n            ${dtpsLMS.gradebook?`Power+ includes a gradebook designed for ${dtpsLMS.name} to help you understand your grades.`:""}</p>\n        </div>\n\n        ${dtpsLMS.isDemoLMS?'\n            <div class="welcomeSection">\n                <i class="material-icons">priority_high</i>\n                <h5>This is a demo</h5>\n                <p>Assignment information, grades, and other content displayed is not real and is for demonstration purposes only. This demo does not retrieve or collect any data.</p>\n            </div>\n        ':`\n            <div class="welcomeSection">\n                <i class="material-icons">security</i>\n                <h5>Privacy</h5>\n                <p>Power+ does not collect any information. All of the data used in Power+ is fetched directly from ${dtpsLMS.shortName} and is never sent anywhere else. \n                 User preferences, grade history, and other Power+ data is stored locally on your computer and is not associated with your ${dtpsLMS.shortName} account.</p>\n            </div>\n            <div class="welcomeSection">\n                <i class="material-icons">priority_high</i>\n                <h5>Power+ is not official</h5>\n                <p>Assignment information, grades, and other content displayed in Power+ are not official. Power+ is neither created nor endorsed by ${dtpsLMS.legalName}.\n                 Power+ may have bugs that could cause it to display inaccurate information. Use Power+ at your own risk.</p>\n            </div>\n        `}\n        \n        <br />\n        <div onclick="window.localStorage.setItem('dtpsInstalled', 'true'); fluid.cards.close('.card.changelog');" class="btn">\n            <i class="material-icons">arrow_forward</i> Continue\n        </div>\n    `),fluid.cards.close(".card.focus"),fluid.cards(".card.changelog","stayOpen")},dtps.renderLoadingScreen=function(){window.dtpsPreLoader&&!dtps.user||jQuery("body").append('\n            <div id="dtpsNativeOverlay" style="position: fixed; top: 0px; left: 0px; width: 100vw; height: 100vh; z-index: 999; background: #191919; text-align: center; z-index: 999; transition: opacity 0.2s;">\n                &nbsp;\n                <img style="height: 100px; margin-top: 132px;" src="https://i.imgur.com/eiTE2sW.png" />\n                <div class="spinner" style="margin-top: 300px;"></div>\n                <style>body { overflow: hidden !important; } .spinner { width: 40px; height: 40px; margin: 40px auto; background-color: gray; border-radius: 100%; -webkit-animation: sk-scaleout 1.0s infinite ease-in-out; animation: sk-scaleout 1.0s infinite ease-in-out; } @-webkit-keyframes sk-scaleout { 0% { -webkit-transform: scale(0) } 100% { -webkit-transform: scale(1.0); opacity: 0; } } @keyframes sk-scaleout { 0% { -webkit-transform: scale(0); transform: scale(0); } 100% { -webkit-transform: scale(1.0); transform: scale(1.0); opacity: 0; } }</style>\n            </div>\n        ')},dtps.JS=function(e){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js",(function(){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js")})),jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.3.0/fuse.min.js"),jQuery.getScript("https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"),jQuery.getScript("https://cdn.jottocraft.com/tinycolor.js",()=>{jQuery.getScript("https://cdn.jottocraft.com/nearest-color.dtao.js",()=>{jQuery.getScript("https://cdn.jottocraft.com/fluid/v4.min.js",e)})})},dtps.CSS=function(){jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdn.jottocraft.com/fluid/v4.min.css",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:dtps.baseURL+"/dtps.css",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/css?family=Material+Icons+Outlined",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/icon?family=Material+Icons+Extended",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css",class:"dtpsHeadItem"}).appendTo("head")},dtps.init=function(){if(dtps.log("Starting DTPS "+dtps.readableVer+"..."),!window.dtpsLMS)throw"Error: No DTPS LMS configuration found";Number(window.localStorage.dtps)<dtps.ver&&(dtps.log("New release"),dtps.popup="changelog"),"true"!==window.localStorage.dtpsInstalled&&(dtps.popup="firstrun"),dtps.renderLoadingScreen(),fluidThemes=[["midnight","tome"],["rainbow"]],fluidAutoLoad=!1,window.localStorage.setItem("jottocraftEnv",!0),dtps.selectedContent="stream",dtps.CSS(),dtps.render(),dtpsLMS.fetchUser().then(e=>(dtps.user||(dtps.user=e,dtps.user.lmsID=dtps.user.id,dtps.user.children&&dtps.user.children.length&&(dtps.user.lmsID=dtps.user.children[0].id,dtps.user.parent=!0)),dtpsLMS.fetchClasses())).then(e=>new Promise(s=>{dtpsLMS.institutionSpecific&&dtpsLMS.updateClasses?dtpsLMS.updateClasses(e).then(e=>{s(e)}).catch(e=>{reject(e)}):s(e)})).then(e=>{dtps.classes=e,dtps.classes.forEach((e,s)=>e.num=s),dtps.JS(()=>{var e=nearestColor.from({red:"#cc4747",brown:"#9a4429",orange:"#ce734e",pumpkin:"#c58535",yellow:"#b58f38",yellowGreen:"#7c9630",green:"#439a47",oceanGreen:"#339a70",keppel:"#40b5c3",skyBlue:"#40a4d6",blue:"#2d72a0",purple:"#985cab",magenta:"#bd3e69",pink:"#ec7ca5",gray:"#888888",gold:"#94652a",darkRed:"#943f3f",darkBlue:"#485182",darkPurple:"#6f4882",darkGreen:"#3d7358",lightOrange:"#ea7a44",lightRed:"#e07f7f",lightBlue:"#76c1e6",lightPurple:"#978fd6",lightGreen:"#7ebb95",lightBrown:"#928871"});dtps.classes.forEach(s=>{s.color=s.color?e(s.color).value:"gray",dtpsLMS.calculateGrade&&(s.letter="...",s.grade=void 0)}),fluid.defaultScreen="dashboard",fluid.screens.dashboard=dtps.baseURL+"/scripts/assignments.js",fluid.screens.stream=dtps.baseURL+"/scripts/assignments.js",fluid.screens.moduleStream=dtps.baseURL+"/scripts/assignments.js",fluid.screens.pages=dtps.baseURL+"/scripts/pages-discussions.js",fluid.screens.discussions=dtps.baseURL+"/scripts/pages-discussions.js",dtpsLMS.gradebook?fluid.screens.gradebook=dtps.showLMSGradebook:dtpsLMS.genericGradebook&&(fluid.screens.gradebook=dtps.baseURL+"/scripts/assignments.js"),dtps.classes.forEach((e,s)=>{dtpsLMS.fetchAssignments(e.id).then(e=>new Promise(s=>{dtpsLMS.institutionSpecific&&dtpsLMS.updateAssignments?dtpsLMS.updateAssignments(e).then(e=>{s(e)}).catch(e=>{reject(e)}):s(e)})).then(t=>{if(e.assignments=t,e.assignments.forEach(t=>{t.class=s,t.gradedAt&&t.grade&&dtps.updates.push({class:e.num,type:"assignment",...t})}),dtps.updates.sort((function(e,s){return new Date(s.gradedAt||s.postedAt).getTime()-new Date(e.gradedAt||e.postedAt).getTime()})),dtps.updates.length>15&&(dtps.updates.length=15),dtpsLMS.calculateGrade){let s=dtpsLMS.calculateGrade(e,t);s?(e.letter=s.letter,e.grade=s.grade,e.gradeCalculation=s):(e.letter=null,e.grade=null),"pages"!==dtps.selectedContent&&"discuss"!==dtps.selectedContent&&dtps.showClasses(!0)}e.letter&&"..."!==e.letter?(e.hasGradebook=!0,dtps.logGrades(s),s==dtps.selectedClass&&(dtps.presentClass(s),"grades"==dtps.selectedContent&&fluid.screen("gradebook",dtps.classes[s].id))):s==dtps.selectedClass&&"grades"==dtps.selectedContent&&fluid.screen("stream",dtps.classes[s].id),"dash"!=dtps.selectedClass&&"stream"!=dtps.selectedContent||fluid.screen()}),dtpsLMS.fetchAnnouncements(e.id).then(s=>{s.forEach(s=>{dtps.updates.push({class:e.num,type:"announcement",...s})}),dtps.updates.sort((function(e,s){return new Date(s.gradedAt||s.postedAt).getTime()-new Date(e.gradedAt||e.postedAt).getTime()})),dtps.updates.length>15&&(dtps.updates.length=15),"dash"==dtps.selectedClass&&fluid.screen()})}),dtps.renderLite(),fluid.screen(),"firstrun"==dtps.popup?dtps.firstrun():"changelog"==dtps.popup&&dtps.changelog(!0)})}).catch((function(e){console.error("[DTPS] Error fetching user and classes at dtps.init",e),404==e.status?window.location.href="/?dtpsLogin=true":dtps.error("Failed to get user and/or course data","Exception in promise @ dtps.init")})),dtps.loadDashboardPrefs()},dtps.ampm=function(e){var s=e.getHours(),t=e.getMinutes(),a=s>=12?"pm":"am";return(s=(s%=12)||12)+":"+(t=t<10?"0"+t:t)+" "+a},dtps.formatDate=function(e){return e?new Date(e).toDateString().slice(0,-5)+", "+dtps.ampm(new Date(e)):""},dtps.obsSwitch=function(e){history.replaceState(null,null," "),dtps.user.lmsID=$(e).val(),dtps.classes=[],dtps.updates=[],dtps.init()},dtps.iframeLoad=function(e){var s=document.getElementById(e);s&&(s.height="",s.height=s.contentWindow.document.body.scrollHeight+"px")},dtps.clearData=function(){window.confirm("Clearing Power+ data will clear all local user data stored by Power+. This should be done if it is a new semester / school year or if you are having issues with Power+. Are you sure you want to clear all your Power+ data?")&&(window.localStorage.clear(),window.alert("Power+ data cleared"))},dtps.chroma=function(){if(fluid.chroma&&fluid.chroma.on){var e="--light";if($("body").hasClass("dark")&&(e="--norm"),$("body").hasClass("midnight")&&(e="--dark"),"dash"!==dtps.selectedClass){var s=JSON.parse("[\n        [null,null,null,"+("stream"==dtps.selectedContent?'"white","white","white","white"':"null,null,null,null")+","+("pages"==dtps.selectedContent?'"white","white","white","white"':"null,null,null,null")+","+("grades"==dtps.selectedContent?'"white","white","white","white"':"null,null,null,null")+",null,null,null,null,null,null,null],\n        [null,null,"+(dtps.classes[dtps.selectedClass].grade>=10?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=20?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=30?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=40?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=50?'"white"':0)+",\n        "+(dtps.classes[dtps.selectedClass].grade>=60?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=70?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=80?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=90?'"white"':0)+","+(dtps.classes[dtps.selectedClass].grade>=100?'"white"':0)+",null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]]"),t=$(".background")[0];void 0!==$(".class."+dtps.selectedClass)[0]&&(t=$(".class."+dtps.selectedClass)[0]),fluid.chroma.effect(tinycolor(getComputedStyle(t).getPropertyValue(e)).saturate(70).toHexString(),s)}else{t=$(".background")[0];void 0!==$(".class.dash")[0]&&(t=$(".class.dash")[0]),fluid.chroma.static(getComputedStyle(t).getPropertyValue(e))}}},dtps.showClasses=function(e){dtps.classlist=[];for(var s=0;s<dtps.classes.length;s++){var t="";dtps.classes[s].letter&&(t=dtps.classes[s].letter),null==dtps.classes[s].letter&&(t="--"),"..."==dtps.classes[s].letter&&(t='<div class="spinner" style="background-color: var(--norm); margin: -8px -10px;"></div>'),dtps.classlist.push(`\n            <div \n                onclick="${"dtps.selectedClass = "+s}" \n                class="${"class item "+s+" "+(dtps.selectedClass==s?" active":"")}"\n                style="${"--classColor: "+dtps.classes[s].color}"\n            >\n                <span class="label name">${dtps.classes[s].subject}</span>\n                <div ${null==dtps.classes[s].letter?'style="letter-spacing:2px;"':""} class="icon grade val">\n                    ${t}\n                </div>\n            </div>\n        `)}jQuery(".sidebar .class.dash")[0]&&!e||(jQuery(".sidebar").html(`\n            <div class="bigLogo" style="text-align: center; margin: 10px 0 20px; white-space: nowrap; overflow: hidden;">\n                <img style="width: 28px; margin-right: 7px; vertical-align: middle;" src="https://powerplus.app/icon.svg" />\n                <h4 style="color: var(--text); display: inline-block; font-size: 28px; vertical-align: middle; margin: 0px;">Power+</h4>\n            </div>\n            \n            <img class="logo" src="https://powerplus.app/favicon.png" />\n\n            <div class="items">\n\n                <div onclick="dtps.selectedClass = 'dash';" class="class item main dash ${"dash"==dtps.selectedClass?"active":""}">\n                    <span class="label name">Dashboard</span>\n                    <div class="icon"><i class="material-icons">dashboard</i></div>\n                </div>\n\n                <div class="divider"></div>\n\n                ${dtps.classlist.join("")}\n            </div>\n\n            <div onclick="$('body').toggleClass('collapsedSidebar'); if ($('body').hasClass('collapsedSidebar')) { $(this).children('i').html('keyboard_arrow_right'); } else {$(this).children('i').html('keyboard_arrow_left');}" init="true" class="collapse">\n                <i class="material-icons">keyboard_arrow_left</i>\n            </div>\n        `),"pages"!=dtps.selectedContent&&"discuss"!=dtps.selectedContent||fluid.screen("stream",dtps.classes[dtps.selectedClass].id),$(".class:not(.overrideClass)").click((function(e){dtps.presentClass(dtps.selectedClass),"stream"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&fluid.screen("stream",dtps.classes[dtps.selectedClass].id),"moduleStream"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&fluid.screen("moduleStream",dtps.classes[dtps.selectedClass].id),"grades"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&(dtps.classes[dtps.selectedClass].hasGradebook?fluid.screen("gradebook",dtps.classes[dtps.selectedClass].id):fluid.screen("stream",dtps.classes[dtps.selectedClass].id)),"dash"==dtps.selectedClass&&fluid.screen("dashboard")})))},dtps.presentClass=function(e){dtps.selectedClass=e,dtps.classes[e]?document.title=dtps.classes[e].subject+" | Power+":document.title="Power+","dash"==e?$("body").addClass("dashboard"):$("body").removeClass("dashboard"),dtps.chroma();var s="https://i.imgur.com/SpqHCNo.png";"true"!==fluid.get("pref-hideClassImages")&&dtps.classes[e]&&dtps.classes[e].image&&(s=dtps.classes[e].image),$(".background").addClass("trans"),$(".cover.image").css("background-image",'url("'+s+'")'),$(".background").css("opacity","0.90"),$(".background").css("filter","none"),clearTimeout(dtps.bgTimeout),dtps.bgTimeout=setTimeout((function(){dtps.oldTheme="squidward theme park",document.dispatchEvent(new CustomEvent("fluidTheme")),$(".background").removeClass("trans")}),500),dtps.classes[e]&&$(".background").css("--classColor",dtps.classes[e].color),$(".class."+e).siblings().removeClass("active"),$(".class."+e).addClass("active"),$("#headText").html("dash"==e?"Dashboard":dtps.classes[e]&&dtps.classes[e].subject),dtps.classes[e]?$(".header .btns").show():$(".header .btns").hide(),dtps.classes[e]&&(dtps.classes[e].pages?$(".btns .btn.pages").show():$(".btns .btn.pages").hide(),dtps.classes[e].discussions?$(".btns .btn.discuss").show():$(".btns .btn.discuss").hide(),(dtpsLMS.genericGradebook||dtpsLMS.gradebook)&&dtps.classes[e].hasGradebook?$(".btns .btn.grades").show():$(".btns .btn.grades").hide(),$("#dtpsTabBar .btn:visible").length<2&&$("#dtpsTabBar").hide())},dtps.showLMSGradebook=function(e){var s=dtps.classes.map(e=>e.id).indexOf(e);function t(){dtpsLMS.gradebook(dtps.classes[s]).then(e=>{e&&dtps.selectedClass==s&&"grades"==dtps.selectedContent&&($(".classContent").html(e),dtpsLMS.gradebookDidRender&&dtpsLMS.gradebookDidRender(dtps.classes[s]))}).catch((function(e){dtps.error("Could not load the gradebook","Caught promise rejection @ dtps.showLMSGradebook",e)}))}dtps.selectedClass=s,dtps.selectedContent="grades",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.grades").addClass("active"),dtps.presentClass(s),dtps.showClasses(),-1==s&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.showLMSGradebook"),"grades"==dtps.selectedContent&&dtps.selectedClass==s&&jQuery(".classContent").html('<div class="spinner"></div>'),fluid.externalScreens.stream?t():jQuery.getScript(dtps.baseURL+"/scripts/assignments.js",()=>{t()})},dtps.showIFrameCard=function(e){$("#CardIFrame").attr("src",""),fluid.cards(".card.iFrameCard"),$("#CardIFrame").attr("src",e)},dtps.logGrades=function(e){if(window.localStorage.getItem("gradeHistory-"+dtps.classes[e].id)){var s=window.localStorage.getItem("gradeHistory-"+dtps.classes[e].id).split("|")[0],t=window.localStorage.getItem("gradeHistory-"+dtps.classes[e].id).split("|")[1];s!==dtps.classes[e].letter&&(window.localStorage.setItem("gradeHistory-"+dtps.classes[e].id,dtps.classes[e].letter+"|"+s),dtps.classes[e].previousLetter=s),s==dtps.classes[e].letter&&t&&(dtps.classes[e].previousLetter=t)}else window.localStorage.setItem("gradeHistory-"+dtps.classes[e].id,dtps.classes[e].letter)},dtps.settings=function(){if("true"!==$("#leftDashboardColumn").attr("loaded")){function e(e){return e.map(e=>`\n                <div dashboardItem-id="${e.id}" style="height: ${1.7*e.size+50}px" class="dashboardItem">\n                    <h5>\n                        <i class="material-icons">${e.icon}</i>\n                        <span>${e.name}</span>\n                    </h5>\n                </div>\n            `).join("")}$("#leftDashboardColumn").html(e(dtps.leftDashboard)),$("#rightDashboardColumn").html(e(dtps.rightDashboard)),$(".dashboardColumn").sortable({connectWith:".dashboardColumn",update:function(e,s){dtps.saveDashboardPrefs()}}),$("#leftDashboardColumn").attr("loaded","true")}fluid.modal(".settingsCard")},dtps.saveDashboardPrefs=function(){for(var e=[],s=0;s<$(".dashboardColumn").children().length;s++){var t=$($(".dashboardColumn").children()[s]);e.push({id:t.attr("dashboardItem-id"),side:t.parent().attr("id").includes("left")?"left":"right"})}window.localStorage.setItem("dtpsDashboardItems",JSON.stringify(e)),dtps.loadDashboardPrefs()},dtps.loadDashboardPrefs=function(){if(dtps.leftDashboard=[],dtps.rightDashboard=[],window.localStorage.dtpsDashboardItems){var e=JSON.parse(window.localStorage.dtpsDashboardItems),s=dtps.dashboardItems.map(e=>e.id);e.forEach(e=>{if(s.includes(e.id)){var t=s.indexOf(e.id),a=dtps.dashboardItems[t];"left"==e.side?dtps.leftDashboard.push(a):"right"==e.side&&dtps.rightDashboard.push(a)}})}else dtps.dashboardItems.forEach(e=>{"left"==e.defaultSide?dtps.leftDashboard.push(e):"right"==e.defaultSide&&dtps.rightDashboard.push(e)})},dtps.render=function(){$("link:not(.dtpsHeadItem)").remove(),$("head *:not(.dtpsHeadItem)").remove(),$("body").attr("class","dark showThemeWindows hasSidebar dashboard"),document.title="Power+",jQuery("<link/>",{rel:"shortcut icon",type:"image/png",href:"https://powerplus.app/favicon.png"}).appendTo("head"),jQuery("body *:not(#dtpsNativeOverlay):not(#dtpsNativeOverlay *)").remove(),jQuery("body").append(`\n        <div style="line-height: 0;" class="sidebar acrylicMaterial"></div>\n\n        \x3c!-- Header background elements --\x3e\n        <div class="cover image"></div>\n        <div class="background"></div>\n\n        \x3c!-- Header with class name and tabs --\x3e\n        <div class="header">\n            <p id="timeRemaining" style="position: absolute;top:${dtps.unstable?"2px":"14px"};margin-left: 20px;"></p>\n            ${dtps.unstable?'<p style="position: absolute;top: 45px;margin-left: 20px; color: #ff6e6e; background-color: black; font-size: 12px;">THIS IS AN UNSTABLE VERSION OF POWER+. USE AT YOUR OWN RISK.</p>':""}\n        \n            <h2 id="headText">Dashboard</h2>\n        \n            \x3c!-- Class tabs. Each button has init=true to prevent Fluid UI from automatically managing their states --\x3e\n            <div style="display: none;" id="dtpsTabBar" class="btns row tabs">\n                <button init="true" onclick="fluid.screen('stream', dtps.classes[dtps.selectedClass].id);" class="btn stream">\n                    <i class="material-icons">library_books</i>\n                    Coursework\n                </button>\n                <button init="true" onclick="fluid.screen('discussions', dtps.classes[dtps.selectedClass].id);" class="btn discuss">\n                    <i class="material-icons">forum</i>\n                    Discussions\n                </button>\n                <button init="true" onclick="fluid.screen('pages', dtps.classes[dtps.selectedClass].id);" class="btn pages">\n                    <i class="material-icons">insert_drive_file</i>\n                    Pages\n                </button>\n                <button init="true" onclick="fluid.screen('gradebook', dtps.classes[dtps.selectedClass].id);" class="btn grades">\n                    <i class="material-icons">assessment</i>\n                    ${dtpsLMS.gradebook?"Grades":"Gradebook"}\n                </button>\n            </div>\n        </div>\n\n        \x3c!-- Class content area --\x3e\n        <div class="classContent">\n            <div class="spinner"></div>\n        </div>\n\n        \x3c!-- Settings card (its inner HTML is added later) --\x3e\n        <div style="height: calc(100vh - 50px); overflow: auto !important;" class="card withnav focus close container settingsCard"></div>\n\n        \x3c!-- Toolbar (the thing at the top-right with your name, profile picture, and buttons. its inner HTML is also added later) --\x3e\n        <div class="toolbar items"></div>\n\n        \x3c!-- Changelog card --\x3e\n        <div style="border-radius: 30px;" class="card focus changelog close container">\n            <i onclick="fluid.cards.close('.card.changelog')" class="material-icons close">close</i>\n            <h3>What's new in Power+</h3>\n            <h5>Loading...</h5>\n        </div>\n\n        \x3c!-- General details card for assignments, outcomes, class info, etc. --\x3e\n        <div style="border-radius: 30px;" class="card focus details close container">\n            <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n            <p>An error occured</p>\n        </div>\n\n        \x3c!-- General iFrame card (with white background) --\x3e\n        <div style="border-radius: 30px; top: 50px; background-color: white; color: black;" class="card focus close iFrameCard container">\n            <i style="color: black !important;" onclick="fluid.cards.close('.card.iFrameCard'); $('#CardIFrame').attr('src', '');" class="material-icons close">close</i>\n            <br /><br />\n            <iframe style="width: 100%; height: calc(100vh - 175px); border: none;" id="CardIFrame"></iframe>\n        </div>\n    `)},dtps.renderLite=function(){"true"==fluid.get("pref-hideGrades")&&jQuery("body").addClass("hidegrades"),document.addEventListener("pref-hideGrades",(function(e){"true"==e.detail||1==e.detail?jQuery("body").addClass("hidegrades"):jQuery("body").removeClass("hidegrades")})),jQuery(".card.settingsCard").html(`\n        <i onclick="fluid.cards.close('.card.settingsCard')" class="material-icons close">close</i>\n\n        <div class="sidenav" style="position: fixed; height: calc(100% - 50px); border-radius: 20px 0px 0px 20px;">\n            <div class="title">\n\t            <img src="https://powerplus.app/icon.svg" style="width: 50px;vertical-align: middle;padding: 7px; padding-top: 14px;" />\n\t            <div style="vertical-align: middle; display: inline-block;">\n                    <h5 style="font-weight: bold;display: inline-block;vertical-align: middle;">Power+</h5>\n                    <p>${dtps.readableVer+(window.localStorage.dtpsLoaderPref?` <span style="font-size: 12px;">(${window.localStorage.dtpsLoaderPref})</span>`:"")}</p>\n\t            </div>\n            </div>\n\n            <div onclick="$('.abtpage').hide();$('.abtpage.settings').show();" class="item active">\n                <i class="material-icons">settings</i> Settings\n            </div>\n            <div onclick="$('.abtpage').hide();$('.abtpage.dashboard').show();" class="item">\n                <i class="material-icons">dashboard</i> Dashboard\n            </div>\n            ${"dev"==dtps.env?'\n                <div onclick="$(\'.abtpage\').hide();$(\'.abtpage.debugging\').show();" class="item">\n                    <i class="material-icons">bug_report</i> Debugging\n                </div>\n            ':""}\n            <div onclick="$('.abtpage').hide();$('.abtpage.about').show(); if ($('body').hasClass('sudo')) { $('.advancedOptions').show(); $('.advOp').hide(); } else { $('.advancedOptions').hide(); $('.advOp').show(); }" class="item abt">\n                <i class="material-icons">info</i> About\n            </div>\n        </div>\n\n        <div style="min-height: 100%" class="content">\n            <div class="abtpage settings">\n                <h5>Settings</h5>\n                \n                <br />\n                <p>Theme</p>\n\n                <div>\n                    <div class="btns row themeSelector"></div>\n                    \n                    <br /><br />\n                    <p>Grades</p>\n\n                    <div onclick="fluid.set('pref-hideGrades')" class="switch pref-hideGrades"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">visibility_off</i> Hide class grades</div>\n                </div>\n\n                <br /><br />\n                <p>Classes</p>\n\n                <div>\n                    <div onclick="fluid.set('pref-fullNames')" class="switch pref-fullNames"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">title</i> Show full class names (requires reload)</div>\n                    \n                    <br /><br />\n                    <div onclick="fluid.set('pref-hideClassImages')" class="switch pref-hideClassImages"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">image</i> Hide class images</div>\n\n                    <div class="razerChroma" style="display: none;">\n                        <br /><br />\n                        <div onclick="fluid.set('pref-chromaEffects')" class="switch pref-chromaEffects"><span class="head"></span></div>\n                        <div class="label"><img style="width: 26px;vertical-align: middle;margin-right: 2px;" src="https://i.imgur.com/FLwviAM.png" class="material-icons" /> Razer Chroma Effects (beta)</div>\n                    </div>\n                </div>\n\n                ${window.localStorage.githubCanary||window.localStorage.dtpsDebuggingPort?`\n                    <br /><br />\n                    <p>Prerelease testing</p>\n\n                    <div>\n                        <div class="btns row small">\n                            <button \n                                onclick="window.localStorage.setItem('dtpsLoaderPref', 'prod')" \n                                class="btn ${"canary"!=window.localStorage.dtpsLoaderPref&&"debugging"!=window.localStorage.dtpsLoaderPref?"active":""}">\n                                <i class="material-icons">label</i> Production\n                            </button>\n                            ${window.localStorage.githubCanary?`\n                                <button \n                                    onclick="window.localStorage.setItem('dtpsLoaderPref', 'canary')" \n                                    class="btn ${"canary"==window.localStorage.dtpsLoaderPref?"active":""}">\n                                    <i class="material-icons">build_circle</i> Canary\n                                </button>\n                            `:""}\n                            ${window.localStorage.dtpsDebuggingPort?`\n                                <button \n                                    onclick="window.localStorage.setItem('dtpsLoaderPref', 'debugging')" \n                                    class="btn ${"debugging"==window.localStorage.dtpsLoaderPref?"active":""}">\n                                    <i class="material-icons">bug_report</i> Debugging\n                                </button>\n                            `:""}\n                        </div>\n                    </div>\n                `:""}\n\n            </div>\n\n            <div style="display: none;" class="abtpage dashboard">\n                <h5>Dashboard</h5>\n                <p>You can rearrange the items shown on the dashboard by dragging them below. You might have to reload Power+ for changes to take effect.</p>\n\n                <br />\n                \n                <div id="leftDashboardColumn" class="dashboardColumn"></div>\n\n                <div id="rightDashboardColumn" class="dashboardColumn"></div>\n\n            </div>\n\n            ${"dev"==dtps.env?`\n                <div style="display: none;" class="abtpage debugging">\n                   <h5>Debugging</h5>\n                   <p>These settings are for development only and might break Power+. Use at your own risk.</p>\n\n                   <br />\n\n                   <div>\n                       <input id="dtpsDebuggingPort" value="${window.localStorage.dtpsDebuggingPort||""}" placeholder="Debugging Port" />\n                       <button class="btn small" onclick="window.localStorage.setItem('dtpsDebuggingPort', $('#dtpsDebuggingPort').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n\n                   <br />\n\n                   <div>\n                       <input id="dtpsLMSOverride" value="${window.localStorage.dtpsLMSOverride||""}" placeholder="LMS override" />\n                       <button class="btn small" onclick="window.localStorage.setItem('dtpsLMSOverride', $('#dtpsLMSOverride').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n                </div>\n            `:""}\n\n            <div style="display: none;" class="abtpage about">\n                <h5>About</h5>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <img src="https://powerplus.app/icon.svg" style="height: 50px; margin-right: 10px; vertical-align: middle; margin-top: 20px;" />\n                    \n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 32px; margin-bottom: 0px;">Power+</h4>\n                        <div style="font-size: 16px; margin-top: 5px;">\n                            ${dtps.readableVer}\n                            <div class="buildInfo" style="display: inline-block;margin: 0px 5px;font-size: 12px;cursor: pointer;"></div>\n                        </div>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;"><a onclick="dtps.changelog();" style="color: var(--lightText); margin: 0px 5px;" href="#"><i class="material-icons" style="vertical-align: middle">update</i> Changelog</a>\n                        <a onclick="if (window.confirm('Are you sure you want to uninstall Power+? The extension will be removed and all of your Power+ data will be erased. If you use the Power+ bookmarklet, you will have to remove that yourself.')) { document.dispatchEvent(new CustomEvent('extensionData', { detail: 'extensionUninstall' })); window.localStorage.clear(); window.alert('Power+ has been uninstalled. Reload the page to go back to ${dtpsLMS.shortName}.') }" style="color: var(--lightText); margin: 0px 5px;" href="#"><i class="material-icons" style="vertical-align: middle">delete_outline</i> Uninstall</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=***REMOVED***&item_name=Donate+to+Power%2B&currency_code=USD&source=url"><i class="material-icons" style="vertical-align: middle">attach_money</i> Donate</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="mailto:hello@jottocraft.com"><i class="material-icons" style="vertical-align: middle">email</i> Contact</a>\n                    </div>\n                </div>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <div style="margin-top: 12px;">\n                        <img src="${dtps.user.photoURL}" style="height: 50px; margin-right: 10px; vertical-align: middle; border-radius: 50%;" />\n\n                        <div style="display: inline-block; vertical-align: middle;">\n                            <h4 style="font-weight: bold; font-size: 32px; margin: 0px;">${dtps.user.name} <span style="font-size: 12px; line-height: 0px;">${dtps.user.id}</span></h4>\n                        </div>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="/logout"><i class="material-icons" style="vertical-align: middle">exit_to_app</i> Logout</a>\n                    </div>\n                </div>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <img src="${dtpsLMS.logo}" style="height: 50px; margin-right: 10px; vertical-align: middle; margin-top: 20px; border-radius: 50%; background: #ee5034;" />\n\n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 32px; margin-bottom: 0px;">${dtpsLMS.name}</h4>\n                        ${dtpsLMS.description?`\n                            <div style="font-size: 16px; margin-top: 5px;">${dtpsLMS.description}</div>\n                        `:""}\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="${dtpsLMS.source}"><i class="material-icons" style="vertical-align: middle">code</i> LMS integration source code</a>\n                    </div>\n                </div>\n\n                <div class="card advancedOptions" style="padding: 8px 16px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px; display: none;">\n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 28px; margin-bottom: 0px;">Advanced Options</h4>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" onclick="dtps.clearData();" href="#"><i class="material-icons" style="vertical-align: middle">refresh</i> Reset Power+</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="https://github.com/jottocraft/dtps/issues/new/choose"><i class="material-icons" style="vertical-align: middle">bug_report</i> Bug Report / Feedback</a>\n                    </div>\n                </div>\n\n                <br />\n                <p style="cursor: pointer; color: var(--secText, gray)" onclick="$('.advancedOptions').show(); $(this).hide();" class="advOp">Show advanced options</p>\n\n                <div style="text-align: center; padding: 50px 0px;">\n                    <img style="height: 45px; margin-right: 20px; vertical-align: middle;" src="https://cdn.jottocraft.com/images/footerImage.png" />\n                    <h5 style="display: inline-block; vertical-align: middle;">jottocraft</h5>\n                    <p>(c) jottocraft 2018-2020. All rights reserved.&nbsp;&nbsp;<a href="https://github.com/jottocraft/dtps">source code</a>&nbsp;&nbsp;<a href="https://github.com/jottocraft/dtps/blob/master/LICENSE">license</a></p>\n                </div>\n            </div>\n        </div>\n    `),jQuery(".toolbar.items").html(`\n        <div style="text-align: right;">\n            ${dtps.user.parent?`\n                <select onchange="dtps.obsSwitch(this)">\n                    ${dtps.user.children.map(e=>`<option ${dtps.user.lmsID==e.id?"selected":""} value = "${e.id}">${e.name}</option>`).join("")}\n                </select>\n            `:`\n                <h4 style="font-size: 22px;">${dtps.user.name}</h4>\n            `}\n            <img src="${dtps.user.photoURL}" style="height: 34px; margin: 0px; margin-right: 10px; border-radius: 50%; vertical-align: middle;" />\n        </div>\n\n        <div style="margin-top: 5px; display: inline-block; text-align: right; float: right;">\n            <a href="/" class="itemButton"><i class="material-icons">exit_to_app</i> ${dtpsLMS.isDemoLMS?"Exit demo":"Go to "+(dtpsLMS.shortName||dtpsLMS.name)}</a>\n            ${dtps.unstable?'<div onclick="window.open(\'https://github.com/jottocraft/dtps/issues/new/choose\')" class="itemButton"><i class="material-icons">feedback</i> Feedback</div>':""}\n            <div onclick="dtps.settings();" class="itemButton"><i class="material-icons">settings</i> Settings</div>\n        </div>\n    `),fluid.chroma&&(dtps.chromaProfile={title:"Power+",description:"Razer Chroma effects for Power+ (beta)",author:"jottocraft",domain:"powerplus.app"},fluid.chroma.supported((function(e){e&&($(".razerChroma").show(),"true"==fluid.get("pref-chromaEffects")&&(fluid.chroma.on||fluid.chroma.init(dtps.chromaProfile,()=>fluid.chroma.static(getComputedStyle($(".background")[0]).getPropertyValue("--dark")))),document.addEventListener("pref-chromaEffects",(function(e){"true"==String(e.detail)?fluid.chroma.on||fluid.chroma.init(dtps.chromaProfile,()=>fluid.chroma.static(getComputedStyle($(".background")[0]).getPropertyValue("--dark"))):fluid.chroma.disable()})))}))),fluid.onLoad(),dtps.showClasses(),document.dispatchEvent(new CustomEvent("fluidTheme")),jQuery("#dtpsNativeOverlay style").remove(),jQuery("#dtpsNativeOverlay").css("opacity","0"),setTimeout(()=>jQuery("#dtpsNativeOverlay").remove(),200)},dtps.init();
//# sourceMappingURL=/scripts/core.js.map