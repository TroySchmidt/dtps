/**
 * @file DTPS Core functions and module loader
 * @author jottocraft
 * @version v3.0.6
 * 
 * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */
if(void 0!==dtps)throw"Error: DTPS is already loading";var dtps={ver:306,readableVer:"v3.0.6",env:"localhost"==new URL(window.dtpsBaseURL||"https://powerplus.app").hostname?"dev":window.jottocraftSatEnv||"prod",classes:[],baseURL:window.dtpsBaseURL||"https://powerplus.app",unstable:"https://powerplus.app"!==window.dtpsBaseURL,gradebookExpanded:!1,updates:[],dashboardItems:[{name:"Calendar",id:"dtps.calendar",icon:"event",size:100,defaultSide:"left"},{name:"Updates",id:"dtps.updates",icon:"calendar_view_day",size:170,defaultSide:"left"},{name:"Due Today",id:"dtps.dueToday",icon:"check_circle_outline",size:20,defaultSide:"right"},{name:"Upcoming Assignments",id:"dtps.upcoming",icon:"view_stream",size:250,defaultSide:"right"}],remoteConfig:{showFeedbackButton:!1,gradeCalculationEnabled:!0,allowWhatIfGrades:!0,showVideoMeetingButton:!0,showGradesInSettings:!0,dtechHomepageFluidUITabs:!0,dtechCleanUpAssignments:!0,dtechCurrentTerm:"20-21",debugClassID:"1098",feedbackButtonUsesEmail:!1,topSneaky:!1}};jQuery.getScript("https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"),document.addEventListener("fluidTheme",(function(e){if(dtps.oldTheme!==e.detail){dtps.oldTheme=e.detail;var s=window.getComputedStyle(document.getElementsByClassName("background")[0]).getPropertyValue("--grad");"dash"!==dtps.selectedClass&&(s="linear-gradient(to bottom right, "+(dtps.classes[dtps.selectedClass]&&dtps.classes[dtps.selectedClass].color)+", var(--background))"),"dash"!==dtps.selectedClass&&$("body").removeClass("dashboard"),$(".background").css("background",s)}})),dtps.class=function(){return dtps.classes[dtps.selectedClass]},dtps.isToday=function(e){var s=new Date,t=new Date(e);return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()},dtps.changelog=function(e){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js",(function(){markdown=new showdown.Converter,jQuery.getJSON("https://api.github.com/repos/jottocraft/dtps/releases/latest",(function(s){var t=markdown.makeHtml(s.body);jQuery(".card.changelog").html('<i onclick="fluid.cards.close(\'.card.changelog\')" class="material-icons close">close</i>'+t),e?Number(s.tag_name.replace(/[^0-9]/g,""))>Number(window.localStorage.dtps)&&(localStorage.setItem("dtps",s.tag_name.replace(/[^0-9]/g,"")),s.tag_name.includes("s")||(fluid.cards.close(".card.focus"),fluid.cards(".card.changelog"))):(fluid.cards.close(".card.focus"),fluid.cards(".card.changelog"))}))}))},dtps.log=function(e){"dev"==dtps.env&&console.log("[DTPS]",e)},dtps.error=function(e,s,t){if(null!==t){var a="";s&&(a='<div style="font-size: 12px; color: var(--secText, gray); margin-top: 10px;">'+s+"</div>"),console.error("[DTPS !!ERROR!!]",s+": ",t),fluid.alert("Error",e+a,"error")}},dtps.firstrun=function(){window.localStorage.setItem("dtps",dtps.ver),jQuery(".card.changelog").html(`\n        <h3 style="margin-bottom: 0px;">Welcome to Power+</h3>\n        <h5 style="color: var(--secText); font-weight: bold; font-size: 22px;">${dtps.readableVer}</h5>\n\n        <div class="welcomeSection">\n            <i class="material-icons">dashboard</i>\n            <h5>${dtpsLMS.gradebook?"Manage your coursework and grades":"Manage your coursework"}</h5>\n            <p>Power+ organizes all of your coursework so you can easily see what you need to do next. The dashboard shows upcoming assignments, recent grades, and announcements.\n            ${dtpsLMS.gradebook?`Power+ includes a gradebook designed for ${dtpsLMS.name} to help you understand your grades.`:""}</p>\n        </div>\n\n        ${dtpsLMS.isDemoLMS?'\n            <div class="welcomeSection">\n                <i class="material-icons">priority_high</i>\n                <h5>This is a demo</h5>\n                <p>Assignment information, grades, and other content displayed is not real and is for demonstration purposes only. This demo does not retrieve or collect any data.</p>\n            </div>\n        ':`\n            <div class="welcomeSection">\n                <i class="material-icons">security</i>\n                <h5>Privacy</h5>\n                <p>Power+ does not collect any information. All of the data used in Power+ is fetched directly from ${dtpsLMS.shortName} and is never sent anywhere else. \n                 User preferences, grade history, and other Power+ data is stored locally on your computer and is not associated with your ${dtpsLMS.shortName} account.</p>\n            </div>\n            <div class="welcomeSection">\n                <i class="material-icons">priority_high</i>\n                <h5>Power+ is not official</h5>\n                <p>Assignment information, grades, and other content displayed in Power+ are not official. Power+ is neither created nor endorsed by ${dtpsLMS.legalName}.\n                 Power+ may have bugs that could cause it to display inaccurate information. Use Power+ at your own risk.</p>\n            </div>\n        `}\n        \n        <br />\n        <div onclick="window.localStorage.setItem('dtpsInstalled', 'true'); fluid.cards.close('.card.changelog');" class="btn">\n            <i class="material-icons">arrow_forward</i> Continue\n        </div>\n    `),fluid.cards.close(".card.focus"),fluid.cards(".card.changelog","stayOpen")},dtps.renderLoadingScreen=function(){window.dtpsPreLoader&&!dtps.user||jQuery("body").append('\n            <div id="dtpsNativeOverlay" style="background-color: #151515; position: fixed; top: 0px; left: 0px; width: 100%; height: 100vh; z-index: 99;text-align: center;z-index: 999;transition: opacity 0.2s;">\n                <img style="height: 100px; margin-top: 132px;" src="https://i.imgur.com/7dDUVh2.png" />\n\t\t\t    <br />\n                <div class="progress"><div class="indeterminate"></div></div>\n                <style>body {background-color: #151515; overflow: hidden;}*,:after,:before{box-sizing:border-box}.progress{position:relative;width:600px;height:5px;overflow:hidden;border-radius:12px;background:#262626;backdrop-filter:opacity(.4);display:inline-block;margin-top:75px}.progress .indeterminate{position:absolute;background:#e3ba4b;height:5px;animation:indeterminate 1.4s infinite;animation-timing-function:linear}@keyframes indeterminate{0%{width:5%;left:-15%}to{width:100%;left:110%}}</style>\n            </div>\n        ')},dtps.JS=function(e){jQuery.getScript("https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.js",(function(){jQuery.getScript("https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/locales-all.min.js")})),jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.3.0/fuse.min.js"),jQuery.getScript("https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"),jQuery.getScript("https://cdn.jottocraft.com/tinycolor.js",()=>{jQuery.getScript("https://cdn.jottocraft.com/nearest-color.dtao.js",()=>{jQuery.getScript("https://cdn.jottocraft.com/fluid/v4.min.js",e)})})},dtps.CSS=function(){jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdn.jottocraft.com/fluid/v4.min.css",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:dtps.baseURL+"/dtps.css",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/css?family=Material+Icons+Outlined",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.css",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/icon?family=Material+Icons+Extended",class:"dtpsHeadItem"}).appendTo("head"),jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css",class:"dtpsHeadItem"}).appendTo("head")},dtps.init=function(){if(dtps.log("Starting DTPS "+dtps.readableVer+"..."),!window.dtpsLMS)throw"Error: No DTPS LMS configuration found";Number(window.localStorage.dtps)<dtps.ver&&(dtps.log("New release"),dtps.popup="changelog"),"true"!==window.localStorage.dtpsInstalled&&(dtps.popup="firstrun"),dtps.renderLoadingScreen();var e=new URLSearchParams(window.location.search);Array.from(e).length&&window.history.replaceState(null,null,window.location.pathname),fluidThemes=[["midnight","tome"],["rainbow"]],fluidAutoLoad=!1,window.localStorage.setItem("jottocraftEnv",!0),dtps.selectedContent="stream",dtps.CSS(),dtps.render(),new Promise(e=>{jQuery.getJSON("https://project-dtps.firebaseio.com/config.json",s=>{s&&Object.keys(s).forEach(e=>{var t=s[e];dtps.remoteConfig[e]=t}),e()}).fail(e)}).then(()=>("dev"==dtps.env&&Object.keys(dtps.remoteConfig).forEach(e=>{window.localStorage.getItem("dtpsRemoteConfig-"+e)&&(val=window.localStorage.getItem("dtpsRemoteConfig-"+e),"true"==val&&(val=!0),"false"==val&&(val=!1),dtps.remoteConfig[e]=val)}),dtpsLMS.fetchUser())).then(e=>(dtps.user||(dtps.user=e,dtps.user.lmsID=dtps.user.id,dtps.user.children&&dtps.user.children.length&&(dtps.user.lmsID=dtps.user.children[0].id,dtps.user.parent=!0)),dtpsLMS.fetchClasses())).then(e=>new Promise(s=>{dtpsLMS.institutionSpecific&&dtpsLMS.updateClasses?dtpsLMS.updateClasses(e).then(e=>{s(e)}).catch(e=>{reject(e)}):s(e)})).then(s=>{dtps.classes=s,dtps.classes.forEach((e,s)=>e.num=s),dtps.JS(()=>{var s=nearestColor.from({red:"#cc4747",brown:"#9a4429",orange:"#ce734e",pumpkin:"#c58535",yellow:"#b58f38",yellowGreen:"#7c9630",green:"#439a47",oceanGreen:"#339a70",keppel:"#40b5c3",skyBlue:"#40a4d6",blue:"#2d72a0",purple:"#985cab",magenta:"#bd3e69",pink:"#ec7ca5",gray:"#888888",gold:"#94652a",darkRed:"#943f3f",darkBlue:"#485182",darkPurple:"#6f4882",darkGreen:"#3d7358",lightOrange:"#ea7a44",lightRed:"#e07f7f",lightBlue:"#76c1e6",lightPurple:"#978fd6",lightGreen:"#7ebb95",lightBrown:"#928871"});dtps.classes.forEach(e=>{e.color=e.color?s(e.color).value:"gray",dtpsLMS.calculateGrade&&(e.letter="...",e.grade=void 0)}),fluid.defaultScreen="dashboard",fluid.screens.dashboard=dtps.baseURL+"/scripts/assignments.js",fluid.screens.stream=dtps.baseURL+"/scripts/assignments.js",fluid.screens.moduleStream=dtps.baseURL+"/scripts/assignments.js",fluid.screens.people=dtps.baseURL+"/scripts/people.js",fluid.screens.pages=dtps.baseURL+"/scripts/pages-discussions.js",fluid.screens.discussions=dtps.baseURL+"/scripts/pages-discussions.js",!dtpsLMS.gradebook||"dev"==dtps.env&&"true"==fluid.get("pref-debuggingGenericGradebook")?(dtpsLMS.genericGradebook||"dev"==dtps.env&&"true"==fluid.get("pref-debuggingGenericGradebook"))&&(fluid.screens.gradebook=dtps.baseURL+"/scripts/assignments.js"):fluid.screens.gradebook=dtps.showLMSGradebook,dtps.classes.forEach((e,s)=>{dtpsLMS.fetchAssignments(e.id).then(e=>new Promise(s=>{dtpsLMS.institutionSpecific&&dtpsLMS.updateAssignments?dtpsLMS.updateAssignments(e).then(e=>{s(e)}).catch(e=>{reject(e)}):s(e)})).then(t=>{if(e.assignments=t,e.assignments.forEach(t=>{t.class=s,t.gradedAt&&t.grade&&dtps.updates.push({class:e.num,type:"assignment",...t})}),dtps.updates.sort((function(e,s){return new Date(s.gradedAt||s.postedAt).getTime()-new Date(e.gradedAt||e.postedAt).getTime()})),dtps.updates.length>15&&(dtps.updates.length=15),dtpsLMS.calculateGrade){let s=dtpsLMS.calculateGrade(e,t);s?(e.letter=s.letter,e.grade=s.grade,e.gradeCalculation=s):(e.letter=null,e.grade=null),"pages"!==dtps.selectedContent&&"discuss"!==dtps.selectedContent&&dtps.showClasses(!0)}e.letter&&"..."!==e.letter?(e.hasGradebook=!0,dtps.logGrades(s),s==dtps.selectedClass&&(dtps.presentClass(s),"grades"==dtps.selectedContent&&fluid.screen("gradebook",dtps.classes[s].id))):s==dtps.selectedClass&&"grades"==dtps.selectedContent&&fluid.screen("stream",dtps.classes[s].id),dtps.remoteConfig.showGradesInSettings&&dtps.renderGradesInSettings(),"dash"!=dtps.selectedClass&&"stream"!=dtps.selectedContent||fluid.screen()}),dtpsLMS.fetchAnnouncements(e.id).then(s=>{s.forEach(s=>{dtps.updates.push({class:e.num,type:"announcement",...s})}),dtps.updates.sort((function(e,s){return new Date(s.gradedAt||s.postedAt).getTime()-new Date(e.gradedAt||e.postedAt).getTime()})),dtps.updates.length>15&&(dtps.updates.length=15),"dash"==dtps.selectedClass&&fluid.screen()})}),dtps.renderLite(),fluid.screen(),"firstrun"==dtps.popup?dtps.firstrun():"changelog"==dtps.popup&&dtps.changelog(!0),"canary"==e.get("prerelease")&&e.get("repo")&&fluid.alert("Power+ Canary","<p>Do you want to add this release configuration to Power+?</p>","build_circle",[{name:"Add",icon:"add",action:"window.localStorage.githubCanary = '"+e.get("repo")+"'; alert('Please reload the page for changes to take effect');"},{name:"Cancel",icon:"cancel"}])})}).catch((function(e){console.error("[DTPS] Error fetching user and classes at dtps.init",e),404==e.status?window.location.href="/?dtpsLogin=true":dtps.error("Failed to get user and/or course data","Exception in promise @ dtps.init")})),dtps.loadDashboardPrefs()},dtps.formatDate=function(e){return e?new Date(e).toLocaleString("en",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""},dtps.obsSwitch=function(e){history.replaceState(null,null," "),dtps.user.lmsID=$(e).val(),dtps.classes=[],dtps.updates=[],dtps.init()},dtps.iframeLoad=function(e){var s=document.getElementById(e);s&&(s.height="",s.height=s.contentWindow.document.body.scrollHeight+"px")},dtps.clearData=function(){window.confirm("Clearing Power+ data will clear all local user data stored by Power+. This should be done if it is a new semester / school year or if you are having issues with Power+. Are you sure you want to clear all your Power+ data?")&&(window.localStorage.clear(),window.alert("Power+ data cleared"))},dtps.showClasses=function(e){dtps.classlist=[];for(var s=0;s<dtps.classes.length;s++){var t="";dtps.classes[s].letter&&(t=dtps.classes[s].letter),null==dtps.classes[s].letter&&(t="--"),"..."==dtps.classes[s].letter&&(t='<div class="spinner" style="background-color: var(--norm); margin: -8px -10px;"></div>'),dtps.classlist.push(`\n            <div \n                onclick="${"dtps.selectedClass = "+s}" \n                class="${"class item "+s+" "+(dtps.selectedClass==s?" active":"")}"\n                style="${"--classColor: "+dtps.classes[s].color}"\n            >\n                <span class="label name">${dtps.classes[s].subject}</span>\n                <div ${null==dtps.classes[s].letter?'style="letter-spacing:2px;"':""} class="icon grade val">\n                    ${t}\n                </div>\n            </div>\n        `)}jQuery(".sidebar .class.dash")[0]&&!e||(jQuery(".sidebar").html(`\n            <div class="bigLogo" style="text-align: center; margin: 10px 0 20px; white-space: nowrap; overflow: hidden;">\n                <img style="width: 28px; margin-right: 7px; vertical-align: middle;" src="${dtps.baseURL+"/icon.svg"}" />\n                <h4 style="color: var(--text); display: inline-block; font-size: 28px; vertical-align: middle; margin: 0px;">Power+</h4>\n            </div>\n            \n            <img class="logo" src="${dtps.baseURL+"/favicon.png"}" />\n\n            <div class="items">\n\n                <div onclick="dtps.selectedClass = 'dash';" class="class item main dash ${"dash"==dtps.selectedClass?"active":""}">\n                    <span class="label name">Dashboard</span>\n                    <div class="icon"><i class="material-icons">dashboard</i></div>\n                </div>\n\n                <div class="divider"></div>\n\n                ${dtps.classlist.join("")}\n            </div>\n\n            <div onclick="$('body').toggleClass('collapsedSidebar'); if ($('body').hasClass('collapsedSidebar')) { $(this).children('i').html('keyboard_arrow_right'); } else {$(this).children('i').html('keyboard_arrow_left');}" init="true" class="collapse">\n                <i class="material-icons">keyboard_arrow_left</i>\n            </div>\n        `),"pages"!=dtps.selectedContent&&"discuss"!=dtps.selectedContent||fluid.screen("stream",dtps.classes[dtps.selectedClass].id),$(".class:not(.overrideClass)").click((function(e){dtps.presentClass(dtps.selectedClass),"stream"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&fluid.screen("stream",dtps.classes[dtps.selectedClass].id),"moduleStream"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&fluid.screen("moduleStream",dtps.classes[dtps.selectedClass].id),"people"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&fluid.screen("people",dtps.classes[dtps.selectedClass].id),"grades"==dtps.selectedContent&&dtps.classes[dtps.selectedClass]&&(dtps.classes[dtps.selectedClass].hasGradebook?fluid.screen("gradebook",dtps.classes[dtps.selectedClass].id):fluid.screen("stream",dtps.classes[dtps.selectedClass].id)),"dash"==dtps.selectedClass&&fluid.screen("dashboard")})))},dtps.presentClass=function(e){dtps.selectedClass=e,dtps.classes[e]?document.title=dtps.classes[e].subject+" | Power+":document.title="Power+","dash"==e?$("body").addClass("dashboard"):$("body").removeClass("dashboard");var s="https://i.imgur.com/SpqHCNo.png";"true"!==fluid.get("pref-hideClassImages")&&dtps.classes[e]&&dtps.classes[e].image&&(s=dtps.classes[e].image),$(".background").addClass("trans"),$(".cover.image").css("background-image",'url("'+s+'")'),$(".background").css("opacity","0.6"),$(".background").css("filter","none"),clearTimeout(dtps.bgTimeout),dtps.bgTimeout=setTimeout((function(){dtps.oldTheme="nklfsdlflsdajflks",document.dispatchEvent(new CustomEvent("fluidTheme")),$(".background").removeClass("trans")}),500),dtps.classes[e]&&$(".background").css("--classColor",dtps.classes[e].color),$(".class."+e).siblings().removeClass("active"),$(".class."+e).addClass("active"),$("#headText").html("dash"==e?"Dashboard":dtps.classes[e]&&dtps.classes[e].subject),dtps.classes[e]?$(".header .btns").show():$(".header .btns").hide(),dtps.classes[e]&&(dtps.classes[e].pages?$(".btns .btn.pages").show():$(".btns .btn.pages").hide(),dtpsLMS.fetchUsers?$(".btns .btn.people").show():$(".btns .btn.people").hide(),dtps.classes[e].discussions?$(".btns .btn.discuss").show():$(".btns .btn.discuss").hide(),(dtpsLMS.genericGradebook||dtpsLMS.gradebook)&&dtps.classes[e].hasGradebook?$(".btns .btn.grades").show():$(".btns .btn.grades").hide(),$("#dtpsTabBar .btn:visible").length<2&&$("#dtpsTabBar").hide())},dtps.showLMSGradebook=function(e){var s=dtps.classes.map(e=>e.id).indexOf(e);function t(){dtpsLMS.gradebook(dtps.classes[s]).then(e=>{e&&dtps.selectedClass==s&&"grades"==dtps.selectedContent&&($(".classContent").html(e),dtpsLMS.gradebookDidRender&&dtpsLMS.gradebookDidRender(dtps.classes[s]))}).catch((function(e){dtps.error("Could not load the gradebook","Caught promise rejection @ dtps.showLMSGradebook",e)}))}dtps.selectedClass=s,dtps.selectedContent="grades",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.grades").addClass("active"),dtps.presentClass(s),dtps.showClasses(),-1==s&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.showLMSGradebook"),"grades"==dtps.selectedContent&&dtps.selectedClass==s&&jQuery(".classContent").html('<div class="spinner"></div>'),fluid.externalScreens.stream?t():jQuery.getScript(dtps.baseURL+"/scripts/assignments.js",()=>{t()})},dtps.showIFrameCard=function(e){$("#CardIFrame").attr("src",""),fluid.cards(".card.iFrameCard"),$("#CardIFrame").attr("src",e)},dtps.brightenTextForDarkMode=function(e,s){s||(s="black");var t=$("<div></div>").append(e);return t.find("span").filter((function(){return $(this).css("color")&&!($(this).css("background-color")||$(this).css("background"))&&!$(this).parents().filter((function(){return $(this).css("background-color")||$(this).css("background")})).length})).toArray().forEach(e=>{var t=tinycolor($(e).css("color")).getBrightness()/255*100,a=100-tinycolor(s).getBrightness()/255*100-t-t;a>0?$(e).css("color","#"+tinycolor($(e).css("color")).brighten(Math.abs(a)).toHex()):$(e).css("color","#"+tinycolor($(e).css("color")).darken(Math.abs(a)).toHex())}),t.html()},dtps.logGrades=function(e){if(window.localStorage.getItem("gradeHistory-"+dtps.classes[e].id)){var s=window.localStorage.getItem("gradeHistory-"+dtps.classes[e].id).split("|")[0],t=window.localStorage.getItem("gradeHistory-"+dtps.classes[e].id).split("|")[1];s!==dtps.classes[e].letter&&(window.localStorage.setItem("gradeHistory-"+dtps.classes[e].id,dtps.classes[e].letter+"|"+s),dtps.classes[e].previousLetter=s),s==dtps.classes[e].letter&&t&&(dtps.classes[e].previousLetter=t)}else window.localStorage.setItem("gradeHistory-"+dtps.classes[e].id,dtps.classes[e].letter)},dtps.settings=function(e){if(e||"true"!==$("#leftDashboardColumn").attr("loaded")){function s(e){return e.map(e=>`\n                <div dashboardItem-id="${e.id}" style="height: ${1.7*e.size+50}px" class="dashboardItem">\n                    <h5>\n                        <i class="material-icons">${e.icon}</i>\n                        <span>${e.name}</span>\n                    </h5>\n                </div>\n            `).join("")}$("#leftDashboardColumn").html(s(dtps.leftDashboard)),$("#rightDashboardColumn").html(s(dtps.rightDashboard)),$(".dashboardColumn").sortable({connectWith:".dashboardColumn",update:function(e,s){dtps.saveDashboardPrefs()}}),$("#leftDashboardColumn").attr("loaded","true")}dtps.remoteConfig.showGradesInSettings&&dtps.renderGradesInSettings(),fluid.modal(".settingsCard")},dtps.renderGradesInSettings=function(){$("#classGradeBars").html(dtps.classes.map(e=>{var s=0;return"A"==e.letter&&(s=100),"A-"==e.letter&&(s=91),"B+"==e.letter&&(s=88),"B"==e.letter&&(s=85),"B-"==e.letter&&(s=81),"C+"==e.letter&&(s=78),"C"==e.letter&&(s=75),e.letter?`<div style="cursor: auto; background-color: var(--elements);" class="progressBar big">\n        <div style="color: white;" class="progressLabel">${e.subject} (${e.letter})</div>\n        <div class="progress" style="background-color: ${e.color}; width: calc(${s}% - 300px);"></div></div>`:""}));var e=0,s=0;dtps.classes.forEach(t=>{if("..."==t.letter)e=null;else if(t.letter&&null!==e){var a=0;"A"==t.letter&&(a=4),"A-"==t.letter&&(a=3.7),"B+"==t.letter&&(a=3.3),"B"==t.letter&&(a=3),"B-"==t.letter&&(a=2.7),"C+"==t.letter&&(a=2.3),"C"==t.letter&&(a=2),"I"==t.letter&&(a=0),e+=a,s++}}),null==e?$("#dtpsGpaText").text("..."):$("#dtpsGpaText").text((e/s).toFixed(1))},dtps.saveDashboardPrefs=function(){for(var e=[],s=0;s<$(".dashboardColumn").children().length;s++){var t=$($(".dashboardColumn").children()[s]);e.push({id:t.attr("dashboardItem-id"),side:t.parent().attr("id").includes("left")?"left":"right"})}window.localStorage.setItem("dtpsDashboardItems",JSON.stringify(e)),dtps.loadDashboardPrefs()},dtps.resetDashboardPrefs=function(){window.localStorage.removeItem("dtpsDashboardItems"),dtps.loadDashboardPrefs(),dtps.settings(!0)},dtps.loadDashboardPrefs=function(){if(dtps.leftDashboard=[],dtps.rightDashboard=[],window.localStorage.dtpsDashboardItems){var e=JSON.parse(window.localStorage.dtpsDashboardItems),s=dtps.dashboardItems.map(e=>e.id);e.forEach(e=>{if(s.includes(e.id)){var t=s.indexOf(e.id),a=dtps.dashboardItems[t];"left"==e.side?dtps.leftDashboard.push(a):"right"==e.side&&dtps.rightDashboard.push(a)}})}else dtps.dashboardItems.forEach(e=>{"left"==e.defaultSide?dtps.leftDashboard.push(e):"right"==e.defaultSide&&dtps.rightDashboard.push(e)})},dtps.render=function(){$("link:not(.dtpsHeadItem)").remove(),$("head *:not(.dtpsHeadItem)").remove(),$("body").attr("class","dark showThemeWindows hasSidebar dashboard"),document.title="Power+",jQuery("<link/>",{rel:"shortcut icon",type:"image/png",href:dtps.baseURL+"/favicon.png"}).appendTo("head"),jQuery("body *:not(#dtpsNativeOverlay):not(#dtpsNativeOverlay *)").remove(),jQuery("body").append(`\n        <div class="sidebar acrylicMaterial"></div>\n\n        \x3c!-- Header background elements --\x3e\n        <div class="cover image"></div>\n        <div class="background"></div>\n\n        \x3c!-- Header with class name and tabs --\x3e\n        <div class="header">\n            <p id="timeRemaining" style="position: absolute;top:${dtps.unstable?"2px":"14px"};margin-left: 20px;"></p>\n            ${dtps.unstable?'<p style="position: absolute;top: 45px;margin-left: 20px; color: red;font-weight: bold;background-color: black; font-size: 12px;">THIS IS AN UNSTABLE VERSION OF POWER+. USE AT YOUR OWN RISK.</p>':""}\n        \n            <h2 id="headText">Dashboard</h2>\n        \n            \x3c!-- Class tabs. Each button has init=true to prevent Fluid UI from automatically managing their states --\x3e\n            <div style="display: none;" id="dtpsTabBar" class="btns row tabs">\n                <button init="true" onclick="fluid.screen('stream', dtps.classes[dtps.selectedClass].id);" class="btn stream">\n                    <i class="material-icons">library_books</i>\n                    Coursework\n                </button>\n                <button init="true" onclick="fluid.screen('people', dtps.classes[dtps.selectedClass].id);" class="btn people">\n                    <i class="material-icons">group</i>\n                    People\n                </button>\n                <button init="true" onclick="fluid.screen('discussions', dtps.classes[dtps.selectedClass].id);" class="btn discuss">\n                    <i class="material-icons">forum</i>\n                    Discussions\n                </button>\n                <button init="true" onclick="fluid.screen('pages', dtps.classes[dtps.selectedClass].id);" class="btn pages">\n                    <i class="material-icons">insert_drive_file</i>\n                    Pages\n                </button>\n                <button init="true" onclick="fluid.screen('gradebook', dtps.classes[dtps.selectedClass].id);" class="btn grades">\n                    <i class="material-icons">assessment</i>\n                    ${dtpsLMS.gradebook?"Grades":"Gradebook"}\n                </button>\n            </div>\n        </div>\n\n        \x3c!-- Class content area --\x3e\n        <div class="classContent">\n            <div class="spinner"></div>\n        </div>\n\n        \x3c!-- Settings card (its inner HTML is added later) --\x3e\n        <div style="height: calc(100vh - 50px); overflow: auto !important;" class="card withnav focus close container settingsCard"></div>\n\n        \x3c!-- Toolbar (the thing at the top-right with your name, profile picture, and buttons. its inner HTML is also added later) --\x3e\n        <div class="toolbar items"></div>\n\n        \x3c!-- Changelog card --\x3e\n        <div style="border-radius: 30px;" class="card focus changelog close container">\n            <i onclick="fluid.cards.close('.card.changelog')" class="material-icons close">close</i>\n            <h3>What's new in Power+</h3>\n            <h5>Loading...</h5>\n        </div>\n\n        \x3c!-- General details card for assignments, outcomes, class info, etc. --\x3e\n        <div style="border-radius: 30px;" class="card focus details close container">\n            <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n            <p>An error occured</p>\n        </div>\n\n        \x3c!-- General iFrame card (with white background) --\x3e\n        <div style="border-radius: 30px; top: 50px; background-color: white; color: black;" class="card focus close iFrameCard container">\n            <i style="color: black !important;" onclick="fluid.cards.close('.card.iFrameCard'); $('#CardIFrame').attr('src', '');" class="material-icons close">close</i>\n            <br /><br />\n            <iframe style="width: 100%; height: calc(100vh - 175px); border: none;" id="CardIFrame"></iframe>\n        </div>\n    `)},dtps.renderLite=function(){"true"==fluid.get("pref-hideGrades")&&jQuery("body").addClass("hidegrades"),document.addEventListener("pref-hideGrades",(function(e){"true"==e.detail||1==e.detail?jQuery("body").addClass("hidegrades"):jQuery("body").removeClass("hidegrades")}));var e=new URL(dtps.baseURL).hostname;jQuery(".card.settingsCard").html(`\n        <i onclick="fluid.cards.close('.card.settingsCard')" class="material-icons close">close</i>\n\n        <div class="sidenav" style="position: fixed; height: calc(100% - 50px); border-radius: 20px 0px 0px 20px;">\n            <div class="title">\n\t            <img src="${dtps.baseURL+"/icon.svg"}" style="width: 50px;vertical-align: middle;padding: 7px; padding-top: 14px;" />\n\t            <div style="vertical-align: middle; display: inline-block;">\n                    <h5 style="font-weight: bold;display: inline-block;vertical-align: middle;">Power+</h5>\n                    <p>${dtps.readableVer+(dtps.unstable?' <span style="font-size: 12px;">(unstable)</span>':"")}</p>\n\t            </div>\n            </div>\n\n            <div onclick="$('.abtpage').hide();$('.abtpage.settings').show();" class="item active">\n                <i class="material-icons">settings</i> Settings\n            </div>\n            ${dtps.remoteConfig.showGradesInSettings?'\n                <div onclick="$(\'.abtpage\').hide();$(\'.abtpage.grades\').show();" class="item">\n                    <i class="material-icons">assessment</i> Grades\n                </div>\n            ':""}\n            <div onclick="$('.abtpage').hide();$('.abtpage.dashboard').show();" class="item">\n                <i class="material-icons">dashboard</i> Dashboard\n            </div>\n            ${"dev"==dtps.env?'\n                <div onclick="$(\'.abtpage\').hide();$(\'.abtpage.debugging\').show();" class="item">\n                    <i class="material-icons">bug_report</i> Debugging\n                </div>\n                <div onclick="$(\'.abtpage\').hide();$(\'.abtpage.experiments\').show();" class="item">\n                    <i class="material-icons">science</i> Experiments\n                </div>\n            ':""}\n            <div onclick="$('.abtpage').hide();$('.abtpage.about').show();" class="item abt">\n                <i class="material-icons">info</i> About\n            </div>\n        </div>\n\n        <div style="min-height: 100%" class="content">\n            <div class="abtpage settings">\n                <h5><b>Settings</b></h5>\n                \n                <br />\n                <p>Theme</p>\n\n                <div>\n                    <div class="btns row themeSelector"></div>\n                    \n                    <br /><br />\n                    <p>Grades</p>\n\n                    <div onclick="fluid.set('pref-hideGrades')" class="switch pref-hideGrades"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">visibility_off</i> Hide class grades</div>\n                </div>\n\n                <br /><br />\n                <p>Classes</p>\n\n                <div>\n                    <div onclick="fluid.set('pref-fullNames')" class="switch pref-fullNames"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">title</i> Show full class names (requires reload)</div>\n                    \n                    <br /><br />\n                    <div onclick="fluid.set('pref-hideClassImages')" class="switch pref-hideClassImages"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">image</i> Hide class images</div>\n\n                    ${dtpsLMS.dtech&&dtps.remoteConfig.dtechCleanUpAssignments?'\n                            <br /><br />\n                            <div onclick="fluid.set(\'pref-formatAssignmentContent\')" class="switch pref-formatAssignmentContent active"><span class="head"></span></div>\n                            <div class="label"><i class="material-icons">format_paint</i> Reformat assignment content</div>\n                        ':""}\n\n                </div>\n\n                <div id="dtpsPrereleaseTesting" style="${window.localStorage.prereleaseEnabled||"dev"==dtps.env||window.localStorage.githubRepo||window.localStorage.externalReleaseURL?"":"display: none;"}">\n                    <br /><br />\n                    <p>Prerelease testing</p>\n\n                    <div>\n                        <div class="btns row small">\n                            <button \n                                onclick="window.localStorage.setItem('dtpsLoaderPref', 'prod')" \n                                class="btn ${["dev","github","external","local"].includes(window.localStorage.dtpsLoaderPref)?"":"active"}">\n                                <i class="material-icons">label</i> Production\n                            </button>\n                            <button \n                                onclick="window.localStorage.setItem('dtpsLoaderPref', 'dev')" \n                                class="btn ${"dev"==window.localStorage.dtpsLoaderPref?"active":""}">\n                                <i class="material-icons">feedback</i> Dev\n                            </button>\n                            ${window.localStorage.githubRepo?`\n                                <button \n                                    onclick="window.localStorage.setItem('dtpsLoaderPref', 'github')" \n                                    class="btn ${"github"==window.localStorage.dtpsLoaderPref?"active":""}">\n                                    <i class="material-icons">account_tree</i> Branch\n                                </button>\n                            `:""}\n                            ${window.localStorage.externalReleaseURL?`\n                                <button \n                                    onclick="window.localStorage.setItem('dtpsLoaderPref', 'external')" \n                                    class="btn ${"external"==window.localStorage.dtpsLoaderPref?"active":""}">\n                                    <i class="material-icons">public</i> External\n                                </button>\n                            `:""}\n                            <button\n                                onclick="window.localStorage.setItem('dtpsLoaderPref', 'local')" \n                                class="btn ${"local"==window.localStorage.dtpsLoaderPref?"active":""}">\n                                <i class="material-icons">developer_board</i> Local\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n\n            <div style="display: none;" class="abtpage grades">\n                <h5><b>Grades</b></h5>\n                \n                <br />\n\n                <div>\n                <h6>Estimated GPA: <b id="dtpsGpaText">...</b></h6>\n                <p style="color: var(--secText);"><i>This GPA calculation is unofficial and does not account for honors credit</i></p>\n                </div>\n                \n                <br />\n\n                <div id="classGradeBars"></div>\n            </div>\n\n            <div style="display: none;" class="abtpage dashboard">\n                <h5><b>Dashboard</b></h5>\n                <p>You can rearrange the items shown on the dashboard by dragging them below. You might have to reload Power+ for changes to take effect.</p>\n\n                <button onclick="dtps.resetDashboardPrefs();" class="btn small"><i class="material-icons">refresh</i> Reset dashboard layout</button>\n\n                <br />\n                \n                <div id="leftDashboardColumn" class="dashboardColumn"></div>\n\n                <div id="rightDashboardColumn" class="dashboardColumn"></div>\n            </div>\n\n            ${"dev"==dtps.env?`\n                <div style="display: none;" class="abtpage debugging">\n                   <h5><b>Debugging</b></h5>\n                   <p>These settings are for development only and might break Power+. Use at your own risk.</p>\n\n                   <div>\n                    <button onclick="dtps.firstrun()" class="btn small"><i class="material-icons">web_asset</i> Show firstrun screen</button>\n                   </div>\n\n                   <br /><br />\n\n                   <h5>Release configuration</h5>\n\n                   <button onclick="['dtpsLoaderPref', 'prereleaseEnabled', 'githubRepo', 'externalReleaseURL', 'dtpsLMSOverride'].forEach(k => window.localStorage.removeItem(k)); window.location.reload();" class="btn small"><i class="material-icons">cancel</i> Clear release configurations</button>\n                   <br /><br />\n\n                   <div>\n                       <input id="dtpsGithubRepo" value="${window.localStorage.githubRepo||""}" placeholder="Branch GitHub repo" />\n                       <button class="btn small" onclick="window.localStorage.setItem('githubRepo', $('#dtpsGithubRepo').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n\n                   <div>\n                       <input id="dtpsExternalReleaseURL" value="${window.localStorage.externalReleaseURL||""}" placeholder="External release URL" />\n                       <button class="btn small" onclick="window.localStorage.setItem('externalReleaseURL', $('#dtpsExternalReleaseURL').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n\n                   <div>\n                       <input id="dtpsLMSOverride" value="${window.localStorage.dtpsLMSOverride||""}" placeholder="LMS override" />\n                       <button class="btn small" onclick="window.localStorage.setItem('dtpsLMSOverride', $('#dtpsLMSOverride').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n\n                   <br />\n\n                   <h5>Behavior Overrides</h5>\n\n                   <br />\n                   <div onclick="fluid.set('pref-debuggingGenericGradebook')" class="switch pref-debuggingGenericGradebook"><span class="head"></span></div>\n                   <div class="label">Always use the generic gradebook</div>\n                </div>\n                <div style="display: none;" class="abtpage experiments">\n                    <h5><b>Experiments</b></h5>\n                    <p>These settings control how Power+ behaves. Changing these settings may enabled unsupported and/or unfinished features that can break Power+. Use at your own risk.</p>\n\n                    <button onclick="Object.keys(dtps.remoteConfig).forEach(k => window.localStorage.removeItem('dtpsRemoteConfig-' + k));" class="btn small"><i class="material-icons">cancel</i> Clear Overrides</button>\n                    <br /><br />\n                   ${Object.keys(dtps.remoteConfig).map(e=>`\n                        <div>\n                            <p>${e} ${window.localStorage.getItem("dtpsRemoteConfig-"+e)?" <b>(overridden)</b>":""}</p>\n                            <input value="${dtps.remoteConfig[e]}" placeholder="Value" />\n                            <button class="btn small" onclick="window.localStorage.setItem('dtpsRemoteConfig-${e}', $(this).siblings('input').val())"><i class="material-icons">save</i> Save</button>\n                        </div>\n                    `).join("")}\n                </div>\n            `:""}\n\n            <div style="display: none;" class="abtpage about">\n                <h5><b>About</b></h5>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <img src="${dtps.baseURL+"/icon.svg"}" style="height: 50px; margin-right: 10px; vertical-align: middle; margin-top: 20px;" />\n                    \n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 32px; margin-bottom: 0px;">Power+</h4>\n                        <div style="font-size: 16px; margin-top: 5px;">\n                            ${dtps.readableVer}\n                            <div style="display: inline-block;margin: 0px 5px;font-size: 12px;">${"powerplus.app"!==e?`(from ${e})`:""}</div>\n                        </div>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;"><a onclick="dtps.changelog();" style="color: var(--lightText); margin: 0px 5px;" href="#"><i class="material-icons" style="vertical-align: middle">update</i> Changelog</a>\n                        <a onclick="if (window.confirm('Are you sure you want to uninstall Power+? The extension will be removed and all of your Power+ data will be erased. If you use the Power+ bookmarklet, you will have to remove that yourself.')) { document.dispatchEvent(new CustomEvent('extensionData', { detail: 'extensionUninstall' })); window.localStorage.clear(); window.alert('Power+ has been uninstalled. Reload the page to go back to ${dtpsLMS.shortName}.') }" style="color: var(--lightText); margin: 0px 5px; cursor: pointer;"><i class="material-icons" style="vertical-align: middle">delete_outline</i> Uninstall</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="mailto:hello@jottocraft.com"><i class="material-icons" style="vertical-align: middle">email</i> Contact</a>\n                    </div>\n                </div>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <div style="margin-top: 12px;">\n                        <img src="${dtps.user.photoURL}" style="height: 50px; margin-right: 10px; vertical-align: middle; border-radius: 50%;" />\n\n                        <div style="display: inline-block; vertical-align: middle;">\n                            <h4 style="font-weight: bold; font-size: 32px; margin: 0px;">${dtps.user.name} <span style="font-size: 12px; line-height: 0px;">${dtps.user.id}</span></h4>\n                        </div>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="/logout"><i class="material-icons" style="vertical-align: middle">exit_to_app</i> Logout</a>\n                    </div>\n                </div>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <img src="${dtpsLMS.logo}" style="height: 50px; margin-right: 10px; vertical-align: middle; margin-top: 20px; border-radius: 50%; background: #ee5034;" />\n\n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 32px; margin-bottom: 0px;">${dtpsLMS.name}</h4>\n                        ${dtpsLMS.description?`\n                            <div style="font-size: 16px; margin-top: 5px;">${dtpsLMS.description}</div>\n                        `:""}\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="${dtpsLMS.source}"><i class="material-icons" style="vertical-align: middle">code</i> LMS integration source code</a>\n                    </div>\n                </div>\n\n                <div class="card advancedOptions" style="padding: 8px 16px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px; ${"dev"==dtps.env?"":"display: none;"}">\n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 28px; margin-bottom: 0px;">Advanced Options</h4>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px; cursor: pointer;" onclick="dtps.clearData();"><i class="material-icons" style="vertical-align: middle">refresh</i> Reset Power+</a>\n                        <a style="color: var(--lightText); margin: 0px 5px; cursor: pointer;" onclick="window.localStorage.prereleaseEnabled = 'true'; $('#dtpsPrereleaseTesting').show(); alert('Prerelease versions can be enabled by going to Settings -> Prerelease testing');"><i class="material-icons" style="vertical-align: middle">feedback</i> Test prerelease versions</a>\n                    </div>\n                </div>\n\n                <br />\n                ${"dev"==dtps.env?"":'<p style="cursor: pointer; color: var(--secText, gray)" onclick="$(\'.advancedOptions\').show(); $(this).hide();" class="advOp">Show advanced options</p>'}\n\n                <div style="text-align: center; padding: 50px 0px;">\n                    <img style="height: 45px; margin-right: 20px; vertical-align: middle;" src="https://cdn.jottocraft.com/images/footerImage.png" />\n                    <h5 style="display: inline-block; vertical-align: middle;">jottocraft</h5>\n                    <p>(c) jottocraft 2018-2020. All rights reserved.&nbsp;&nbsp;<a href="https://github.com/jottocraft/dtps">source code</a>&nbsp;&nbsp;<a href="https://github.com/jottocraft/dtps/blob/main/LICENSE">license</a></p>\n                </div>\n            </div>\n        </div>\n    `),jQuery(".toolbar.items").html(`\n        <div style="text-align: right;">\n            ${dtps.user.parent?`\n                <select onchange="dtps.obsSwitch(this)">\n                    ${dtps.user.children.map(e=>`<option ${dtps.user.lmsID==e.id?"selected":""} value = "${e.id}">${e.name}</option>`).join("")}\n                </select>\n            `:`\n                <h4 style="font-size: 22px;">${dtps.user.name}</h4>\n            `}\n            <img src="${dtps.user.photoURL}" style="height: 34px; margin: 0px; margin-right: 10px; border-radius: 50%; vertical-align: middle;" />\n        </div>\n\n        <div style="margin-top: 5px; display: inline-block; text-align: right; float: right;">\n            <a href="/" target="_blank" class="itemButton"><i class="material-icons">exit_to_app</i> ${dtpsLMS.isDemoLMS?"Exit demo":"Go to "+(dtpsLMS.shortName||dtpsLMS.name)}</a>\n            ${dtps.remoteConfig.showFeedbackButton||dtps.unstable?`<a target="_blank" href="${dtps.remoteConfig.feedbackButtonUsesEmail?"mailto:hello@jottocraft.com":"https://github.com/jottocraft/dtps/issues/new/choose"}" class="itemButton"><i class="material-icons">feedback</i> Feedback</a>`:""}\n            <div onclick="dtps.settings();" class="itemButton"><i class="material-icons">settings</i> Settings</div>\n        </div>\n    `),fluid.onLoad(),dtps.showClasses(),document.dispatchEvent(new CustomEvent("fluidTheme")),jQuery("#dtpsNativeOverlay style").remove(),jQuery("#dtpsNativeOverlay").css("opacity","0"),setTimeout(()=>jQuery("#dtpsNativeOverlay").remove(),200)},dtps.init();
//# sourceMappingURL=/scripts/core.js.map