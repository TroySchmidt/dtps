/**
 * @file DTPS Core functions and module loader
 * @author jottocraft
 * @version v3.0.3
 * 
 * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */
if(typeof dtps!=="undefined")throw"Error: DTPS is already loading";var dtps={ver:303,readableVer:"v3.0.3",env:window.jottocraftSatEnv||"prod",classes:[],baseURL:String(document.currentScript.src).split("/")[0]+"//"+String(document.currentScript.src).split("/")[2],unstable:window.localStorage.dtpsLoaderPref=="canary"||window.localStorage.dtpsLoaderPref=="debugging"||String(document.currentScript.src).includes("http://localhost"),gradebookExpanded:false,updates:[],dashboardItems:[{name:"Calendar",id:"dtps.calendar",icon:"event",size:100,defaultSide:"left"},{name:"Updates",id:"dtps.updates",icon:"calendar_view_day",size:170,defaultSide:"left"},{name:"Due Today",id:"dtps.dueToday",icon:"check_circle_outline",size:20,defaultSide:"right"},{name:"Upcoming Assignments",id:"dtps.upcoming",icon:"view_stream",size:250,defaultSide:"right"}]};jQuery.getScript("https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js");document.addEventListener("fluidTheme",(function(data){if(dtps.oldTheme!==data.detail){dtps.oldTheme=data.detail;var next=window.getComputedStyle(document.getElementsByClassName("background")[0]).getPropertyValue("--grad");if(dtps.selectedClass!=="dash")next="linear-gradient(to bottom right, "+(dtps.classes[dtps.selectedClass]&&dtps.classes[dtps.selectedClass].color)+", var(--background))";if(dtps.selectedClass!=="dash")$("body").removeClass("dashboard");$(".background").css("background",next);dtps.chroma()}}));dtps.class=function(){return dtps.classes[dtps.selectedClass]};dtps.isToday=function(date){var today=new Date;var d1=new Date(date);return d1.getFullYear()===today.getFullYear()&&d1.getMonth()===today.getMonth()&&d1.getDate()===today.getDate()};dtps.changelog=function(onlyIfNewVersion){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js",(function(){markdown=new showdown.Converter;jQuery.getJSON("https://api.github.com/repos/jottocraft/dtps/releases/latest",(function(data){var changelogHTML=markdown.makeHtml(data.body);jQuery(".card.changelog").html(`<i onclick="fluid.cards.close('.card.changelog')" class="material-icons close">close</i>`+changelogHTML);if(!onlyIfNewVersion){fluid.cards.close(".card.focus");fluid.cards(".card.changelog")}else if(Number(data.tag_name.replace(/[^0-9]/g,""))>Number(window.localStorage.dtps)){localStorage.setItem("dtps",data.tag_name.replace(/[^0-9]/g,""));if(!data.tag_name.includes("s")){fluid.cards.close(".card.focus");fluid.cards(".card.changelog")}}}))}))};dtps.log=function(msg){if(dtps.env=="dev")console.log("[DTPS]",msg)};dtps.error=function(msg,devNotes,err){if(err!==null){var formattedDevNotes="";if(devNotes){formattedDevNotes='<div style="font-size: 12px; color: var(--secText, gray); margin-top: 10px;">'+devNotes+"</div>"}console.error("[DTPS !!ERROR!!]",devNotes+": ",err);fluid.alert("Error",msg+formattedDevNotes,"error")}};dtps.firstrun=function(){window.localStorage.setItem("dtps",dtps.ver);jQuery(".card.changelog").html(`\n        <h3 style="margin-bottom: 0px;">Welcome to Power+</h3>\n        <h5 style="color: var(--secText); font-weight: bold; font-size: 22px;">${dtps.readableVer}</h5>\n\n        <div class="welcomeSection">\n            <i class="material-icons">dashboard</i>\n            <h5>${dtpsLMS.gradebook?"Manage your coursework and grades":"Manage your coursework"}</h5>\n            <p>Power+ organizes all of your coursework so you can easily see what you need to do next. The dashboard shows upcoming assignments, recent grades, and announcements.\n            ${dtpsLMS.gradebook?`Power+ includes a gradebook designed for ${dtpsLMS.name} to help you understand your grades.`:``}</p>\n        </div>\n\n        ${dtpsLMS.isDemoLMS?`\n            <div class="welcomeSection">\n                <i class="material-icons">priority_high</i>\n                <h5>This is a demo</h5>\n                <p>Assignment information, grades, and other content displayed is not real and is for demonstration purposes only. This demo does not retrieve or collect any data.</p>\n            </div>\n        `:`\n            <div class="welcomeSection">\n                <i class="material-icons">security</i>\n                <h5>Privacy</h5>\n                <p>Power+ does not collect any information. All of the data used in Power+ is fetched directly from ${dtpsLMS.shortName} and is never sent anywhere else. \n                 User preferences, grade history, and other Power+ data is stored locally on your computer and is not associated with your ${dtpsLMS.shortName} account.</p>\n            </div>\n            <div class="welcomeSection">\n                <i class="material-icons">priority_high</i>\n                <h5>Power+ is not official</h5>\n                <p>Assignment information, grades, and other content displayed in Power+ are not official. Power+ is neither created nor endorsed by ${dtpsLMS.legalName}.\n                 Power+ may have bugs that could cause it to display inaccurate information. Use Power+ at your own risk.</p>\n            </div>\n        `}\n        \n        <br />\n        <div onclick="window.localStorage.setItem('dtpsInstalled', 'true'); fluid.cards.close('.card.changelog');" class="btn">\n            <i class="material-icons">arrow_forward</i> Continue\n        </div>\n    `);fluid.cards.close(".card.focus");fluid.cards(".card.changelog","stayOpen")};dtps.renderLoadingScreen=function(){if(!window.dtpsPreLoader||dtps.user){jQuery("body").append(`\n            <div id="dtpsNativeOverlay" style="position: fixed; top: 0px; left: 0px; width: 100vw; height: 100vh; z-index: 999; background: #191919; text-align: center; z-index: 999; transition: opacity 0.2s;">\n                &nbsp;\n                <img style="height: 100px; margin-top: 132px;" src="https://i.imgur.com/eiTE2sW.png" />\n                <div class="spinner" style="margin-top: 300px;"></div>\n                <style>body { overflow: hidden !important; } .spinner { width: 40px; height: 40px; margin: 40px auto; background-color: gray; border-radius: 100%; -webkit-animation: sk-scaleout 1.0s infinite ease-in-out; animation: sk-scaleout 1.0s infinite ease-in-out; } @-webkit-keyframes sk-scaleout { 0% { -webkit-transform: scale(0) } 100% { -webkit-transform: scale(1.0); opacity: 0; } } @keyframes sk-scaleout { 0% { -webkit-transform: scale(0); transform: scale(0); } 100% { -webkit-transform: scale(1.0); transform: scale(1.0); opacity: 0; } }</style>\n            </div>\n        `)}};dtps.JS=function(cb){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js",(function(){jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js")}));jQuery.getScript("https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.3.0/fuse.min.js");jQuery.getScript("https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js");jQuery.getScript("https://cdn.jottocraft.com/tinycolor.js",()=>{jQuery.getScript("https://cdn.jottocraft.com/nearest-color.dtao.js",()=>{jQuery.getScript("https://cdn.jottocraft.com/fluid/v4.min.js",cb)})})};dtps.CSS=function(){jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdn.jottocraft.com/fluid/v4.min.css",class:"dtpsHeadItem"}).appendTo("head");jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:dtps.baseURL+"/dtps.css",class:"dtpsHeadItem"}).appendTo("head");jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/css?family=Material+Icons+Outlined",class:"dtpsHeadItem"}).appendTo("head");jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css",class:"dtpsHeadItem"}).appendTo("head");jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/icon?family=Material+Icons+Extended",class:"dtpsHeadItem"}).appendTo("head");jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:"https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css",class:"dtpsHeadItem"}).appendTo("head")};dtps.init=function(){dtps.log("Starting DTPS "+dtps.readableVer+"...");if(!window.dtpsLMS){throw"Error: No DTPS LMS configuration found"}if(Number(window.localStorage.dtps)<dtps.ver){dtps.log("New release");dtps.popup="changelog"}if(window.localStorage.dtpsInstalled!=="true"){dtps.popup="firstrun"}dtps.renderLoadingScreen();fluidThemes=[["midnight","tome"],["rainbow"]];fluidAutoLoad=false;window.localStorage.setItem("jottocraftEnv",true);dtps.selectedContent="stream";dtps.CSS();dtps.render();dtpsLMS.fetchUser().then(data=>{if(!dtps.user){dtps.user=data;dtps.user.lmsID=dtps.user.id;if(dtps.user.children&&dtps.user.children.length){dtps.user.lmsID=dtps.user.children[0].id;dtps.user.parent=true}}return dtpsLMS.fetchClasses()}).then(rawClasses=>new Promise(resolve=>{if(dtpsLMS.institutionSpecific&&dtpsLMS.updateClasses){dtpsLMS.updateClasses(rawClasses).then(updatedClasses=>{resolve(updatedClasses)}).catch(e=>{reject(e)})}else{resolve(rawClasses)}})).then(classData=>{dtps.classes=classData;dtps.classes.forEach((course,index)=>course.num=index);dtps.JS(()=>{var nearestCourseColor=nearestColor.from({red:"#cc4747",brown:"#9a4429",orange:"#ce734e",pumpkin:"#c58535",yellow:"#b58f38",yellowGreen:"#7c9630",green:"#439a47",oceanGreen:"#339a70",keppel:"#40b5c3",skyBlue:"#40a4d6",blue:"#2d72a0",purple:"#985cab",magenta:"#bd3e69",pink:"#ec7ca5",gray:"#888888",gold:"#94652a",darkRed:"#943f3f",darkBlue:"#485182",darkPurple:"#6f4882",darkGreen:"#3d7358",lightOrange:"#ea7a44",lightRed:"#e07f7f",lightBlue:"#76c1e6",lightPurple:"#978fd6",lightGreen:"#7ebb95",lightBrown:"#928871"});dtps.classes.forEach(course=>{course.color=course.color?nearestCourseColor(course.color).value:"gray";if(dtpsLMS.calculateGrade){course.letter="...";course.grade=undefined}});fluid.defaultScreen="dashboard";fluid.screens.dashboard=dtps.baseURL+"/scripts/assignments.js";fluid.screens.stream=dtps.baseURL+"/scripts/assignments.js";fluid.screens.moduleStream=dtps.baseURL+"/scripts/assignments.js";fluid.screens.pages=dtps.baseURL+"/scripts/pages-discussions.js";fluid.screens.discussions=dtps.baseURL+"/scripts/pages-discussions.js";if(dtpsLMS.gradebook){fluid.screens.gradebook=dtps.showLMSGradebook}else if(dtpsLMS.genericGradebook){fluid.screens.gradebook=dtps.baseURL+"/scripts/assignments.js"}dtps.classes.forEach((course,courseIndex)=>{dtpsLMS.fetchAssignments(course.id).then(rawAssignments=>new Promise(resolve=>{if(dtpsLMS.institutionSpecific&&dtpsLMS.updateAssignments){dtpsLMS.updateAssignments(rawAssignments).then(updatedAssignments=>{resolve(updatedAssignments)}).catch(e=>{reject(e)})}else{resolve(rawAssignments)}})).then(assignments=>{course.assignments=assignments;course.assignments.forEach(assignment=>{assignment.class=courseIndex;if(assignment.gradedAt&&assignment.grade){dtps.updates.push({class:course.num,type:"assignment",...assignment})}});dtps.updates.sort((function(a,b){return new Date(b.gradedAt||b.postedAt).getTime()-new Date(a.gradedAt||a.postedAt).getTime()}));if(dtps.updates.length>15)dtps.updates.length=15;if(dtpsLMS.calculateGrade){let gradeCalcResults=dtpsLMS.calculateGrade(course,assignments);if(gradeCalcResults){course.letter=gradeCalcResults.letter;course.grade=gradeCalcResults.grade;course.gradeCalculation=gradeCalcResults}else{course.letter=null;course.grade=null}if(dtps.selectedContent!=="pages"&&dtps.selectedContent!=="discuss"){dtps.showClasses(true)}}if(course.letter&&course.letter!=="..."){course.hasGradebook=true;dtps.logGrades(courseIndex);if(courseIndex==dtps.selectedClass){dtps.presentClass(courseIndex);if(dtps.selectedContent=="grades"){fluid.screen("gradebook",dtps.classes[courseIndex].id)}}}else{if(courseIndex==dtps.selectedClass&&dtps.selectedContent=="grades"){fluid.screen("stream",dtps.classes[courseIndex].id)}}if(dtps.selectedClass=="dash"||dtps.selectedContent=="stream"){fluid.screen()}});dtpsLMS.fetchAnnouncements(course.id).then(announcements=>{announcements.forEach(announcement=>{dtps.updates.push({class:course.num,type:"announcement",...announcement})});dtps.updates.sort((function(a,b){return new Date(b.gradedAt||b.postedAt).getTime()-new Date(a.gradedAt||a.postedAt).getTime()}));if(dtps.updates.length>15)dtps.updates.length=15;if(dtps.selectedClass=="dash"){fluid.screen()}})});dtps.renderLite();fluid.screen();if(dtps.popup=="firstrun"){dtps.firstrun()}else if(dtps.popup=="changelog"){dtps.changelog(true)}})}).catch((function(err){console.error("[DTPS] Error fetching user and classes at dtps.init",err);if(err.status==404){window.location.href="/?dtpsLogin=true"}else{dtps.error("Failed to get user and/or course data","Exception in promise @ dtps.init")}}));dtps.loadDashboardPrefs()};dtps.ampm=function(date){var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"pm":"am";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var strTime=hours+":"+minutes+" "+ampm;return strTime};dtps.formatDate=function(date){if(date){return new Date(date).toDateString().slice(0,-5)+", "+dtps.ampm(new Date(date))}else{return""}};dtps.obsSwitch=function(ele){history.replaceState(null,null," ");dtps.user.lmsID=$(ele).val();dtps.classes=[];dtps.updates=[];dtps.init()};dtps.iframeLoad=function(iframeID){var iFrame=document.getElementById(iframeID);if(iFrame){iFrame.height="";iFrame.height=iFrame.contentWindow.document.body.scrollHeight+"px"}};dtps.clearData=function(){if(window.confirm("Clearing Power+ data will clear all local user data stored by Power+. This should be done if it is a new semester / school year or if you are having issues with Power+. Are you sure you want to clear all your Power+ data?")){window.localStorage.clear();window.alert("Power+ data cleared")}};dtps.chroma=function(){if(fluid.chroma){if(fluid.chroma.on){var classVar="--light";if($("body").hasClass("dark"))classVar="--norm";if($("body").hasClass("midnight"))classVar="--dark";if(dtps.selectedClass!=="dash"){var dark="white";var lighting=JSON.parse(`[\n        [null,null,null,`+(dtps.selectedContent=="stream"?'"white","white","white","white"':"null,null,null,null")+`,`+(dtps.selectedContent=="pages"?'"white","white","white","white"':"null,null,null,null")+`,`+(dtps.selectedContent=="grades"?'"white","white","white","white"':"null,null,null,null")+`,null,null,null,null,null,null,null],\n        [null,null,`+(dtps.classes[dtps.selectedClass].grade>=10?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=20?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=30?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=40?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=50?`"`+dark+`"`:0)+`,\n        `+(dtps.classes[dtps.selectedClass].grade>=60?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=70?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=80?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=90?`"`+dark+`"`:0)+`,`+(dtps.classes[dtps.selectedClass].grade>=100?`"`+dark+`"`:0)+`,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\n        [null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]]`);var ele=$(".background")[0];if($(".class."+dtps.selectedClass)[0]!==undefined)ele=$(".class."+dtps.selectedClass)[0];fluid.chroma.effect(tinycolor(getComputedStyle(ele).getPropertyValue(classVar)).saturate(70).toHexString(),lighting)}else{var ele=$(".background")[0];if($(".class.dash")[0]!==undefined)ele=$(".class.dash")[0];fluid.chroma.static(getComputedStyle(ele).getPropertyValue(classVar))}}}};dtps.showClasses=function(override){dtps.classlist=[];for(var i=0;i<dtps.classes.length;i++){var letterGradeHTML="";if(dtps.classes[i].letter)letterGradeHTML=dtps.classes[i].letter;if(dtps.classes[i].letter==null)letterGradeHTML="--";if(dtps.classes[i].letter=="...")letterGradeHTML=`<div class="spinner" style="background-color: var(--norm); margin: -8px -10px;"></div>`;dtps.classlist.push(`\n            <div \n                onclick="${"dtps.selectedClass = "+i}" \n                class="${"class item "+i+" "+(dtps.selectedClass==i?" active":"")}"\n                style="${"--classColor: "+dtps.classes[i].color}"\n            >\n                <span class="label name">${dtps.classes[i].subject}</span>\n                <div ${dtps.classes[i].letter==null?`style="letter-spacing:2px;"`:""} class="icon grade val">\n                    ${letterGradeHTML}\n                </div>\n            </div>\n        `)}if(!jQuery(".sidebar .class.dash")[0]||override){jQuery(".sidebar").html(`\n            <div class="bigLogo" style="text-align: center; margin: 10px 0 20px; white-space: nowrap; overflow: hidden;">\n                <img style="width: 28px; margin-right: 7px; vertical-align: middle;" src="https://powerplus.app/icon.svg" />\n                <h4 style="color: var(--text); display: inline-block; font-size: 28px; vertical-align: middle; margin: 0px;">Power+</h4>\n            </div>\n            \n            <img class="logo" src="https://powerplus.app/favicon.png" />\n\n            <div class="items">\n\n                <div onclick="dtps.selectedClass = 'dash';" class="class item main dash ${dtps.selectedClass=="dash"?"active":""}">\n                    <span class="label name">Dashboard</span>\n                    <div class="icon"><i class="material-icons">dashboard</i></div>\n                </div>\n\n                <div class="divider"></div>\n\n                ${dtps.classlist.join("")}\n            </div>\n\n            <div onclick="$('body').toggleClass('collapsedSidebar'); if ($('body').hasClass('collapsedSidebar')) { $(this).children('i').html('keyboard_arrow_right'); } else {$(this).children('i').html('keyboard_arrow_left');}" init="true" class="collapse">\n                <i class="material-icons">keyboard_arrow_left</i>\n            </div>\n        `);if(dtps.selectedContent=="pages"||dtps.selectedContent=="discuss"){fluid.screen("stream",dtps.classes[dtps.selectedClass].id)}$(".class:not(.overrideClass)").click((function(event){dtps.presentClass(dtps.selectedClass);if(dtps.selectedContent=="stream"&&dtps.classes[dtps.selectedClass]){fluid.screen("stream",dtps.classes[dtps.selectedClass].id)}if(dtps.selectedContent=="moduleStream"&&dtps.classes[dtps.selectedClass]){fluid.screen("moduleStream",dtps.classes[dtps.selectedClass].id)}if(dtps.selectedContent=="grades"&&dtps.classes[dtps.selectedClass]){if(dtps.classes[dtps.selectedClass].hasGradebook){fluid.screen("gradebook",dtps.classes[dtps.selectedClass].id)}else{fluid.screen("stream",dtps.classes[dtps.selectedClass].id)}}if(dtps.selectedClass=="dash"){fluid.screen("dashboard")}}))}};dtps.presentClass=function(classNum){dtps.selectedClass=classNum;if(dtps.classes[classNum]){document.title=dtps.classes[classNum].subject+" | Power+"}else{document.title="Power+"}if(classNum=="dash"){$("body").addClass("dashboard")}else{$("body").removeClass("dashboard")}dtps.chroma();var imageURL="https://i.imgur.com/SpqHCNo.png";if(fluid.get("pref-hideClassImages")!=="true"){if(dtps.classes[classNum]&&dtps.classes[classNum].image){imageURL=dtps.classes[classNum].image}}$(".background").addClass("trans");$(".cover.image").css("background-image",'url("'+imageURL+'")');$(".background").css("opacity","0.90");$(".background").css("filter","none");clearTimeout(dtps.bgTimeout);dtps.bgTimeout=setTimeout((function(){dtps.oldTheme="squidward theme park";document.dispatchEvent(new CustomEvent("fluidTheme"));$(".background").removeClass("trans")}),500);if(dtps.classes[classNum]){$(".background").css("--classColor",dtps.classes[classNum].color)}$(".class."+classNum).siblings().removeClass("active");$(".class."+classNum).addClass("active");$("#headText").html(classNum=="dash"?"Dashboard":dtps.classes[classNum]&&dtps.classes[classNum].subject);if(!dtps.classes[classNum]){$(".header .btns").hide()}else{$(".header .btns").show()}if(dtps.classes[classNum]){if(dtps.classes[classNum].pages){$(".btns .btn.pages").show()}else{$(".btns .btn.pages").hide()}if(dtps.classes[classNum].discussions){$(".btns .btn.discuss").show()}else{$(".btns .btn.discuss").hide()}if((dtpsLMS.genericGradebook||dtpsLMS.gradebook)&&dtps.classes[classNum].hasGradebook){$(".btns .btn.grades").show()}else{$(".btns .btn.grades").hide()}if($("#dtpsTabBar .btn:visible").length<2){$("#dtpsTabBar").hide()}}};dtps.showLMSGradebook=function(classID){var classNum=dtps.classes.map(course=>course.id).indexOf(classID);dtps.selectedClass=classNum;dtps.selectedContent="grades";$("#dtpsTabBar .btn").removeClass("active");$("#dtpsTabBar .btn.grades").addClass("active");dtps.presentClass(classNum);dtps.showClasses();if(classNum==-1){dtps.error("The selected class doesn't exist","classNum check failed @ dtps.showLMSGradebook")}if(dtps.selectedContent=="grades"&&dtps.selectedClass==classNum){jQuery(".classContent").html(`<div class="spinner"></div>`)}function renderGradebook(){dtpsLMS.gradebook(dtps.classes[classNum]).then(html=>{if(html&&dtps.selectedClass==classNum&&dtps.selectedContent=="grades"){$(".classContent").html(html);if(dtpsLMS.gradebookDidRender)dtpsLMS.gradebookDidRender(dtps.classes[classNum])}}).catch((function(err){dtps.error("Could not load the gradebook","Caught promise rejection @ dtps.showLMSGradebook",err)}))}if(!fluid.externalScreens.stream){jQuery.getScript(dtps.baseURL+"/scripts/assignments.js",()=>{renderGradebook()})}else{renderGradebook()}};dtps.showIFrameCard=function(url){$("#CardIFrame").attr("src","");fluid.cards(".card.iFrameCard");$("#CardIFrame").attr("src",url)};dtps.logGrades=function(classNum){if(window.localStorage.getItem("gradeHistory-"+dtps.classes[classNum].id)){var savedCurrent=window.localStorage.getItem("gradeHistory-"+dtps.classes[classNum].id).split("|")[0];var savedPrevious=window.localStorage.getItem("gradeHistory-"+dtps.classes[classNum].id).split("|")[1];if(savedCurrent!==dtps.classes[classNum].letter){window.localStorage.setItem("gradeHistory-"+dtps.classes[classNum].id,dtps.classes[classNum].letter+"|"+savedCurrent);dtps.classes[classNum].previousLetter=savedCurrent}if(savedCurrent==dtps.classes[classNum].letter&&savedPrevious){dtps.classes[classNum].previousLetter=savedPrevious}}else{window.localStorage.setItem("gradeHistory-"+dtps.classes[classNum].id,dtps.classes[classNum].letter)}};dtps.settings=function(){if($("#leftDashboardColumn").attr("loaded")!=="true"){function dashboardHTML(dashboardArray){return dashboardArray.map(dashboardItem=>`\n                <div dashboardItem-id="${dashboardItem.id}" style="height: ${dashboardItem.size*1.7+50}px" class="dashboardItem">\n                    <h5>\n                        <i class="material-icons">${dashboardItem.icon}</i>\n                        <span>${dashboardItem.name}</span>\n                    </h5>\n                </div>\n            `).join("")}$("#leftDashboardColumn").html(dashboardHTML(dtps.leftDashboard));$("#rightDashboardColumn").html(dashboardHTML(dtps.rightDashboard));$(".dashboardColumn").sortable({connectWith:".dashboardColumn",update:function(e,ui){dtps.saveDashboardPrefs()}});$("#leftDashboardColumn").attr("loaded","true")}fluid.modal(".settingsCard")};dtps.saveDashboardPrefs=function(){var dashboardPrefs=[];for(var i=0;i<$(".dashboardColumn").children().length;i++){var child=$($(".dashboardColumn").children()[i]);dashboardPrefs.push({id:child.attr("dashboardItem-id"),side:child.parent().attr("id").includes("left")?"left":"right"})}window.localStorage.setItem("dtpsDashboardItems",JSON.stringify(dashboardPrefs));dtps.loadDashboardPrefs()};dtps.loadDashboardPrefs=function(){dtps.leftDashboard=[];dtps.rightDashboard=[];if(window.localStorage.dtpsDashboardItems){var dashboardPref=JSON.parse(window.localStorage.dtpsDashboardItems);var dashboardIDs=dtps.dashboardItems.map(item=>item.id);dashboardPref.forEach(dashboardItemPref=>{if(dashboardIDs.includes(dashboardItemPref.id)){var itemIndex=dashboardIDs.indexOf(dashboardItemPref.id);var dashboardItem=dtps.dashboardItems[itemIndex];if(dashboardItemPref.side=="left"){dtps.leftDashboard.push(dashboardItem)}else if(dashboardItemPref.side=="right"){dtps.rightDashboard.push(dashboardItem)}}})}else{dtps.dashboardItems.forEach(dashboardItem=>{if(dashboardItem.defaultSide=="left"){dtps.leftDashboard.push(dashboardItem)}else if(dashboardItem.defaultSide=="right"){dtps.rightDashboard.push(dashboardItem)}})}};dtps.render=function(){$("link:not(.dtpsHeadItem)").remove();$("head *:not(.dtpsHeadItem)").remove();$("body").attr("class","dark showThemeWindows hasSidebar dashboard");document.title="Power+";jQuery("<link/>",{rel:"shortcut icon",type:"image/png",href:"https://powerplus.app/favicon.png"}).appendTo("head");jQuery("body *:not(#dtpsNativeOverlay):not(#dtpsNativeOverlay *)").remove();jQuery("body").append(`\n        <div style="line-height: 0;" class="sidebar acrylicMaterial"></div>\n\n        \x3c!-- Header background elements --\x3e\n        <div class="cover image"></div>\n        <div class="background"></div>\n\n        \x3c!-- Header with class name and tabs --\x3e\n        <div class="header">\n            <p id="timeRemaining" style="position: absolute;top:${dtps.unstable?"2px":"14px"};margin-left: 20px;"></p>\n            ${dtps.unstable?`<p style="position: absolute;top: 45px;margin-left: 20px; color: #ff6e6e; background-color: black; font-size: 12px;">THIS IS AN UNSTABLE VERSION OF POWER+. USE AT YOUR OWN RISK.</p>`:""}\n        \n            <h2 id="headText">Dashboard</h2>\n        \n            \x3c!-- Class tabs. Each button has init=true to prevent Fluid UI from automatically managing their states --\x3e\n            <div style="display: none;" id="dtpsTabBar" class="btns row tabs">\n                <button init="true" onclick="fluid.screen('stream', dtps.classes[dtps.selectedClass].id);" class="btn stream">\n                    <i class="material-icons">library_books</i>\n                    Coursework\n                </button>\n                <button init="true" onclick="fluid.screen('discussions', dtps.classes[dtps.selectedClass].id);" class="btn discuss">\n                    <i class="material-icons">forum</i>\n                    Discussions\n                </button>\n                <button init="true" onclick="fluid.screen('pages', dtps.classes[dtps.selectedClass].id);" class="btn pages">\n                    <i class="material-icons">insert_drive_file</i>\n                    Pages\n                </button>\n                <button init="true" onclick="fluid.screen('gradebook', dtps.classes[dtps.selectedClass].id);" class="btn grades">\n                    <i class="material-icons">assessment</i>\n                    ${dtpsLMS.gradebook?"Grades":"Gradebook"}\n                </button>\n            </div>\n        </div>\n\n        \x3c!-- Class content area --\x3e\n        <div class="classContent">\n            <div class="spinner"></div>\n        </div>\n\n        \x3c!-- Settings card (its inner HTML is added later) --\x3e\n        <div style="height: calc(100vh - 50px); overflow: auto !important;" class="card withnav focus close container settingsCard"></div>\n\n        \x3c!-- Toolbar (the thing at the top-right with your name, profile picture, and buttons. its inner HTML is also added later) --\x3e\n        <div class="toolbar items"></div>\n\n        \x3c!-- Changelog card --\x3e\n        <div style="border-radius: 30px;" class="card focus changelog close container">\n            <i onclick="fluid.cards.close('.card.changelog')" class="material-icons close">close</i>\n            <h3>What's new in Power+</h3>\n            <h5>Loading...</h5>\n        </div>\n\n        \x3c!-- General details card for assignments, outcomes, class info, etc. --\x3e\n        <div style="border-radius: 30px;" class="card focus details close container">\n            <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n            <p>An error occured</p>\n        </div>\n\n        \x3c!-- General iFrame card (with white background) --\x3e\n        <div style="border-radius: 30px; top: 50px; background-color: white; color: black;" class="card focus close iFrameCard container">\n            <i style="color: black !important;" onclick="fluid.cards.close('.card.iFrameCard'); $('#CardIFrame').attr('src', '');" class="material-icons close">close</i>\n            <br /><br />\n            <iframe style="width: 100%; height: calc(100vh - 175px); border: none;" id="CardIFrame"></iframe>\n        </div>\n    `)};dtps.renderLite=function(){if(fluid.get("pref-hideGrades")=="true"){jQuery("body").addClass("hidegrades")}document.addEventListener("pref-hideGrades",(function(e){if(e.detail=="true"||e.detail==true){jQuery("body").addClass("hidegrades")}else{jQuery("body").removeClass("hidegrades")}}));jQuery(".card.settingsCard").html(`\n        <i onclick="fluid.cards.close('.card.settingsCard')" class="material-icons close">close</i>\n\n        <div class="sidenav" style="position: fixed; height: calc(100% - 50px); border-radius: 20px 0px 0px 20px;">\n            <div class="title">\n\t            <img src="https://powerplus.app/icon.svg" style="width: 50px;vertical-align: middle;padding: 7px; padding-top: 14px;" />\n\t            <div style="vertical-align: middle; display: inline-block;">\n                    <h5 style="font-weight: bold;display: inline-block;vertical-align: middle;">Power+</h5>\n                    <p>${dtps.readableVer+(window.localStorage.dtpsLoaderPref?` <span style="font-size: 12px;">(${window.localStorage.dtpsLoaderPref})</span>`:"")}</p>\n\t            </div>\n            </div>\n\n            <div onclick="$('.abtpage').hide();$('.abtpage.settings').show();" class="item active">\n                <i class="material-icons">settings</i> Settings\n            </div>\n            <div onclick="$('.abtpage').hide();$('.abtpage.dashboard').show();" class="item">\n                <i class="material-icons">dashboard</i> Dashboard\n            </div>\n            ${dtps.env=="dev"?`\n                <div onclick="$('.abtpage').hide();$('.abtpage.debugging').show();" class="item">\n                    <i class="material-icons">bug_report</i> Debugging\n                </div>\n            `:``}\n            <div onclick="$('.abtpage').hide();$('.abtpage.about').show(); if ($('body').hasClass('sudo')) { $('.advancedOptions').show(); $('.advOp').hide(); } else { $('.advancedOptions').hide(); $('.advOp').show(); }" class="item abt">\n                <i class="material-icons">info</i> About\n            </div>\n        </div>\n\n        <div style="min-height: 100%" class="content">\n            <div class="abtpage settings">\n                <h5>Settings</h5>\n                \n                <br />\n                <p>Theme</p>\n\n                <div>\n                    <div class="btns row themeSelector"></div>\n                    \n                    <br /><br />\n                    <p>Grades</p>\n\n                    <div onclick="fluid.set('pref-hideGrades')" class="switch pref-hideGrades"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">visibility_off</i> Hide class grades</div>\n                </div>\n\n                <br /><br />\n                <p>Classes</p>\n\n                <div>\n                    <div onclick="fluid.set('pref-fullNames')" class="switch pref-fullNames"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">title</i> Show full class names (requires reload)</div>\n                    \n                    <br /><br />\n                    <div onclick="fluid.set('pref-hideClassImages')" class="switch pref-hideClassImages"><span class="head"></span></div>\n                    <div class="label"><i class="material-icons">image</i> Hide class images</div>\n\n                    <div class="razerChroma" style="display: none;">\n                        <br /><br />\n                        <div onclick="fluid.set('pref-chromaEffects')" class="switch pref-chromaEffects"><span class="head"></span></div>\n                        <div class="label"><img style="width: 26px;vertical-align: middle;margin-right: 2px;" src="https://i.imgur.com/FLwviAM.png" class="material-icons" /> Razer Chroma Effects (beta)</div>\n                    </div>\n                </div>\n\n                ${window.localStorage.githubCanary||window.localStorage.dtpsDebuggingPort?`\n                    <br /><br />\n                    <p>Prerelease testing</p>\n\n                    <div>\n                        <div class="btns row small">\n                            <button \n                                onclick="window.localStorage.setItem('dtpsLoaderPref', 'prod')" \n                                class="btn ${window.localStorage.dtpsLoaderPref!="canary"&&window.localStorage.dtpsLoaderPref!="debugging"?"active":""}">\n                                <i class="material-icons">label</i> Production\n                            </button>\n                            ${window.localStorage.githubCanary?`\n                                <button \n                                    onclick="window.localStorage.setItem('dtpsLoaderPref', 'canary')" \n                                    class="btn ${window.localStorage.dtpsLoaderPref=="canary"?"active":""}">\n                                    <i class="material-icons">build_circle</i> Canary\n                                </button>\n                            `:``}\n                            ${window.localStorage.dtpsDebuggingPort?`\n                                <button \n                                    onclick="window.localStorage.setItem('dtpsLoaderPref', 'debugging')" \n                                    class="btn ${window.localStorage.dtpsLoaderPref=="debugging"?"active":""}">\n                                    <i class="material-icons">bug_report</i> Debugging\n                                </button>\n                            `:``}\n                        </div>\n                    </div>\n                `:``}\n\n            </div>\n\n            <div style="display: none;" class="abtpage dashboard">\n                <h5>Dashboard</h5>\n                <p>You can rearrange the items shown on the dashboard by dragging them below. You might have to reload Power+ for changes to take effect.</p>\n\n                <br />\n                \n                <div id="leftDashboardColumn" class="dashboardColumn"></div>\n\n                <div id="rightDashboardColumn" class="dashboardColumn"></div>\n\n            </div>\n\n            ${dtps.env=="dev"?`\n                <div style="display: none;" class="abtpage debugging">\n                   <h5>Debugging</h5>\n                   <p>These settings are for development only and might break Power+. Use at your own risk.</p>\n\n                   <br />\n\n                   <div>\n                       <input id="dtpsDebuggingPort" value="${window.localStorage.dtpsDebuggingPort||""}" placeholder="Debugging Port" />\n                       <button class="btn small" onclick="window.localStorage.setItem('dtpsDebuggingPort', $('#dtpsDebuggingPort').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n\n                   <br />\n\n                   <div>\n                       <input id="dtpsLMSOverride" value="${window.localStorage.dtpsLMSOverride||""}" placeholder="LMS override" />\n                       <button class="btn small" onclick="window.localStorage.setItem('dtpsLMSOverride', $('#dtpsLMSOverride').val())"><i class="material-icons">save</i> Save</button>\n                   </div>\n                </div>\n            `:``}\n\n            <div style="display: none;" class="abtpage about">\n                <h5>About</h5>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <img src="https://powerplus.app/icon.svg" style="height: 50px; margin-right: 10px; vertical-align: middle; margin-top: 20px;" />\n                    \n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 32px; margin-bottom: 0px;">Power+</h4>\n                        <div style="font-size: 16px; margin-top: 5px;">\n                            ${dtps.readableVer}\n                            <div class="buildInfo" style="display: inline-block;margin: 0px 5px;font-size: 12px;cursor: pointer;"></div>\n                        </div>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;"><a onclick="dtps.changelog();" style="color: var(--lightText); margin: 0px 5px;" href="#"><i class="material-icons" style="vertical-align: middle">update</i> Changelog</a>\n                        <a onclick="if (window.confirm('Are you sure you want to uninstall Power+? The extension will be removed and all of your Power+ data will be erased. If you use the Power+ bookmarklet, you will have to remove that yourself.')) { document.dispatchEvent(new CustomEvent('extensionData', { detail: 'extensionUninstall' })); window.localStorage.clear(); window.alert('Power+ has been uninstalled. Reload the page to go back to ${dtpsLMS.shortName}.') }" style="color: var(--lightText); margin: 0px 5px;" href="#"><i class="material-icons" style="vertical-align: middle">delete_outline</i> Uninstall</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=***REMOVED***&item_name=Donate+to+Power%2B&currency_code=USD&source=url"><i class="material-icons" style="vertical-align: middle">attach_money</i> Donate</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="mailto:hello@jottocraft.com"><i class="material-icons" style="vertical-align: middle">email</i> Contact</a>\n                    </div>\n                </div>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <div style="margin-top: 12px;">\n                        <img src="${dtps.user.photoURL}" style="height: 50px; margin-right: 10px; vertical-align: middle; border-radius: 50%;" />\n\n                        <div style="display: inline-block; vertical-align: middle;">\n                            <h4 style="font-weight: bold; font-size: 32px; margin: 0px;">${dtps.user.name} <span style="font-size: 12px; line-height: 0px;">${dtps.user.id}</span></h4>\n                        </div>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="/logout"><i class="material-icons" style="vertical-align: middle">exit_to_app</i> Logout</a>\n                    </div>\n                </div>\n\n                <div class="card" style="padding: 10px 20px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px;">\n                    <img src="${dtpsLMS.logo}" style="height: 50px; margin-right: 10px; vertical-align: middle; margin-top: 20px; border-radius: 50%; background: #ee5034;" />\n\n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 32px; margin-bottom: 0px;">${dtpsLMS.name}</h4>\n                        ${dtpsLMS.description?`\n                            <div style="font-size: 16px; margin-top: 5px;">${dtpsLMS.description}</div>\n                        `:``}\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="${dtpsLMS.source}"><i class="material-icons" style="vertical-align: middle">code</i> LMS integration source code</a>\n                    </div>\n                </div>\n\n                <div class="card advancedOptions" style="padding: 8px 16px; box-shadow: none !important; border: 2px solid var(--elements); margin-top: 20px; display: none;">\n                    <div style="display: inline-block; vertical-align: middle;">\n                        <h4 style="font-weight: bold; font-size: 28px; margin-bottom: 0px;">Advanced Options</h4>\n                    </div>\n\n                    <div style="margin-top: 15px; margin-bottom: 7px;">\n                        <a style="color: var(--lightText); margin: 0px 5px;" onclick="dtps.clearData();" href="#"><i class="material-icons" style="vertical-align: middle">refresh</i> Reset Power+</a>\n                        <a style="color: var(--lightText); margin: 0px 5px;" href="https://github.com/jottocraft/dtps/issues/new/choose"><i class="material-icons" style="vertical-align: middle">bug_report</i> Bug Report / Feedback</a>\n                    </div>\n                </div>\n\n                <br />\n                <p style="cursor: pointer; color: var(--secText, gray)" onclick="$('.advancedOptions').show(); $(this).hide();" class="advOp">Show advanced options</p>\n\n                <div style="text-align: center; padding: 50px 0px;">\n                    <img style="height: 45px; margin-right: 20px; vertical-align: middle;" src="https://cdn.jottocraft.com/images/footerImage.png" />\n                    <h5 style="display: inline-block; vertical-align: middle;">jottocraft</h5>\n                    <p>(c) jottocraft 2018-2020. All rights reserved.&nbsp;&nbsp;<a href="https://github.com/jottocraft/dtps">source code</a>&nbsp;&nbsp;<a href="https://github.com/jottocraft/dtps/blob/master/LICENSE">license</a></p>\n                </div>\n            </div>\n        </div>\n    `);jQuery(".toolbar.items").html(`\n        <div style="text-align: right;">\n            ${dtps.user.parent?`\n                <select onchange="dtps.obsSwitch(this)">\n                    ${dtps.user.children.map(child=>`<option ${dtps.user.lmsID==child.id?"selected":""} value = "${child.id}">${child.name}</option>`).join("")}\n                </select>\n            `:`\n                <h4 style="font-size: 22px;">${dtps.user.name}</h4>\n            `}\n            <img src="${dtps.user.photoURL}" style="height: 34px; margin: 0px; margin-right: 10px; border-radius: 50%; vertical-align: middle;" />\n        </div>\n\n        <div style="margin-top: 5px; display: inline-block; text-align: right; float: right;">\n            <a href="/" class="itemButton"><i class="material-icons">exit_to_app</i> ${dtpsLMS.isDemoLMS?"Exit demo":"Go to "+(dtpsLMS.shortName||dtpsLMS.name)}</a>\n            ${dtps.unstable?`<div onclick="window.open('https://github.com/jottocraft/dtps/issues/new/choose')" class="itemButton"><i class="material-icons">feedback</i> Feedback</div>`:""}\n            <div onclick="dtps.settings();" class="itemButton"><i class="material-icons">settings</i> Settings</div>\n        </div>\n    `);if(fluid.chroma){dtps.chromaProfile={title:"Power+",description:"Razer Chroma effects for Power+ (beta)",author:"jottocraft",domain:"powerplus.app"};fluid.chroma.supported((function(res){if(res){$(".razerChroma").show();if(fluid.get("pref-chromaEffects")=="true"){if(!fluid.chroma.on){fluid.chroma.init(dtps.chromaProfile,()=>fluid.chroma.static(getComputedStyle($(".background")[0]).getPropertyValue("--dark")))}}document.addEventListener("pref-chromaEffects",(function(e){if(String(e.detail)=="true"){if(!fluid.chroma.on){fluid.chroma.init(dtps.chromaProfile,()=>fluid.chroma.static(getComputedStyle($(".background")[0]).getPropertyValue("--dark")))}}else{fluid.chroma.disable()}}))}}))}fluid.onLoad();dtps.showClasses();document.dispatchEvent(new CustomEvent("fluidTheme"));jQuery("#dtpsNativeOverlay style").remove();jQuery("#dtpsNativeOverlay").css("opacity","0");setTimeout(()=>jQuery("#dtpsNativeOverlay").remove(),200)};dtps.init();
//# sourceMappingURL=/scripts/core.js.map