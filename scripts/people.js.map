{"version":3,"sources":["scripts/people.js"],"names":["dtps","usersList","courseID","classNum","classes","map","course","id","indexOf","selectedClass","selectedContent","$","removeClass","addClass","presentClass","showClasses","error","jQuery","html","join","Promise","resolve","people","dtpsLMS","fetchUsers","lmsID","then","data","sections","allStudents","allTeachers","currentSection","forEach","section","users","user","title","includes","push","length","photoURL","url","name","catch","err","fluid","externalScreens"],"mappings":";;;;;;;AAcAA,KAAKC,UAAY,SAAUC,GAEvB,IAAIC,EAAWH,KAAKI,QAAQC,KAAIC,GAAUA,EAAOC,KAAIC,QAAQN,GAC7DF,KAAKS,cAAgBN,EAGrBH,KAAKU,gBAAkB,SACvBC,EAAE,oBAAoBC,YAAY,UAClCD,EAAE,2BAA2BE,SAAS,UAGtCb,KAAKc,aAAaX,GAGlBH,KAAKe,eAEY,GAAbZ,GAEAH,KAAKgB,MAAM,mCAAoC,0CAG9ChB,KAAKS,eAAiBN,GAAsC,UAAxBH,KAAKU,iBAC1CO,OAAO,iBAAiBC,KAAa,86BAiB3B,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAGb,KAAI,IACb,gdAQjBc,KAAK,qCAMZ,IAAIC,SAAQC,IACJrB,KAAKI,QAAQD,GAAUmB,SAA6C,IAAlCtB,KAAKI,QAAQD,GAAUmB,OACzDD,EAAQrB,KAAKI,QAAQD,GAAUmB,QAE/BC,QAAQC,WAAWxB,KAAKI,QAAQD,GAAUsB,OAAOC,MAAKC,GAAQN,EAAQM,QAE3ED,MAAK,SAAUE,GACd5B,KAAKI,QAAQD,GAAUmB,OAASM,EAGhC,IAAIC,EAAc,GACdC,EAAc,GACdC,EAAiB,KACrBH,EAASI,SAAQC,IACbA,EAAQC,MAAMF,SAAQG,IACI,YAAjBF,EAAQG,OAAyBN,EAAYO,SAASF,EAAK5B,IAEpDsB,EAAYQ,SAASF,EAAK5B,KAClCsB,EAAYS,KAAKH,EAAK5B,IAFtBuB,EAAYQ,KAAKH,EAAK5B,IAKrBwB,GAAmBI,EAAK5B,IAAMP,KAAKmC,KAAK5B,KACzCwB,EAAiBE,EAAQG,aAKhCpC,KAAKS,eAAiBN,GAAsC,UAAxBH,KAAKU,kBACrCkB,GAAgC,GAAnBA,EAASW,OASvBtB,OAAO,iBAAiBC,KAAa,iQAG4Da,GAAkB,oPAIhFF,EAAYU,kPAIZT,EAAYS,4FACqC,GAAtBT,EAAYS,OAAc,UAAY,8FAGhGX,EAASvB,KAAI4B,GAAW,oFAGPA,EAAQG,+CACfH,EAAQC,MAAM7B,KAAI8B,GAAQ,uOAIoFA,EAAKK,sEAC1FL,EAAKM,4DAA4DN,EAAKO,yIAI1GvB,KAAK,8DAGLA,KAAK,KAtCRF,OAAO,iBAAiBC,KAAa,8PAyC9CyB,OAAM,SAAUC,GACf5C,KAAKgB,MAAM,uBAAwB,4CAA6C4B,OAKxFC,MAAMC,gBAAgBxB,OAAUpB,IAC5BF,KAAKC,UAAUC","sourceRoot":"/","sourcesContent":["/**\r\n * @file DTPS course user list screen\r\n * @author jottocraft\r\n * \r\n * @copyright Copyright (c) 2018-2021 jottocraft. All rights reserved.\r\n * @license GPL-2.0-only\r\n */\r\n\r\n\r\n/**\r\n * Renders the people tab for a class\r\n * \r\n * @param {string} courseID The course ID to render the people tab for\r\n */\r\ndtps.usersList = function (courseID) {\r\n    //Get class index and set as selected class\r\n    var classNum = dtps.classes.map(course => course.id).indexOf(courseID);\r\n    dtps.selectedClass = classNum;\r\n\r\n    //Set people as the selected content\r\n    dtps.selectedContent = \"people\";\r\n    $(\"#dtpsTabBar .btn\").removeClass(\"active\");\r\n    $(\"#dtpsTabBar .btn.people\").addClass(\"active\");\r\n\r\n    //Load class color and things\r\n    dtps.presentClass(classNum);\r\n\r\n    //Ensure classes are shown in the sidebar\r\n    dtps.showClasses();\r\n\r\n    if (classNum == -1) {\r\n        //Class does not exist\r\n        dtps.error(\"The selected class doesn't exist\", \"classNum check failed @ dtps.usersList\");\r\n    }\r\n\r\n    if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"people\")) {\r\n        jQuery(\".classContent\").html(/*html*/`\r\n            <div style=\"--size: 250px; margin: 0px 20px;\" class=\"grid flex\">\r\n              <div class=\"block status card\">\r\n                <h2 class=\"main\"><span class=\"shimmer\">--</span></h2>\r\n                <h5 class=\"bottom\"><i class=\"fluid-icon\">contact_page</i> Your section</h5>\r\n              </div>\r\n              <div class=\"block status\">\r\n                <h2 class=\"main numFont\"><span class=\"shimmer\">--</span></h2>\r\n                <h5 class=\"bottom\"><i class=\"fluid-icon\">groups</i> Total Students</h5>\r\n              </div>\r\n              <div class=\"block status\">\r\n                <h2 class=\"main numFont\"><span class=\"shimmer\">--</span></h2>\r\n                <h5 class=\"bottom\"><i class=\"fluid-icon\">school</i> Teachers</h5>\r\n              </div>\r\n            </div>\r\n            <div class=\"card\">\r\n                <h5><b style=\"width: 300px; display: inline-block;\" class=\"shimmer\">Title</b></h5>\r\n                ${[1, 2, 3, 4, 5, 6].map(() => (\r\n                    /*html*/`\r\n                        <div>\r\n                            <p class=\"shimmerParent\">\r\n                                <span style=\"width: 30px; height: 30px; outline: none; border-radius: 50%; display: inline-block; vertical-align: middle; margin-right: 5px;\"></span>\r\n                                <a style=\"color: var(--text); vertical-align: middle;\">User name</a>\r\n                            </p>\r\n                        </div>\r\n                    `\r\n        )).join(\"\")}\r\n            </div>\r\n        `);\r\n    }\r\n\r\n    //Fetch users list\r\n    new Promise(resolve => {\r\n        if (dtps.classes[classNum].people && (dtps.classes[classNum].people !== true)) {\r\n            resolve(dtps.classes[classNum].people);\r\n        } else {\r\n            dtpsLMS.fetchUsers(dtps.classes[classNum].lmsID).then(data => resolve(data));\r\n        }\r\n    }).then(function (sections) {\r\n        dtps.classes[classNum].people = sections;\r\n\r\n        //Count students and teachers by user ID\r\n        var allStudents = [];\r\n        var allTeachers = [];\r\n        var currentSection = null;\r\n        sections.forEach(section => {\r\n            section.users.forEach(user => {\r\n                if ((section.title == \"Teachers\") && !allTeachers.includes(user.id)) {\r\n                    allTeachers.push(user.id);\r\n                } else if (!allStudents.includes(user.id)) {\r\n                    allStudents.push(user.id);\r\n                }\r\n\r\n                if (!currentSection && (user.id == dtps.user.id)) {\r\n                    currentSection = section.title;\r\n                }\r\n            });\r\n        });\r\n\r\n        if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"people\")) {\r\n            if (!sections || (sections.length == 0)) {\r\n                //No people in this class? (this shouldn't be possible)\r\n                jQuery(\".classContent\").html(/*html*/`\r\n                    <div style=\"cursor: auto;\" class=\"card assignment\">\r\n                        <h4>Error</h4>\r\n                        <p>Power+ could not get the list of people in this course</p>\r\n                    </div>\r\n                `);\r\n            } else {\r\n                jQuery(\".classContent\").html(/*html*/`\r\n                    <div style=\"--size: 250px; margin: 0px 20px;\" class=\"grid flex\">\r\n                      <div class=\"block status card\">\r\n                        <h2 style=\"white-space: nowrap;overflow: hidden;text-overflow: ellipsis;\" class=\"main\">${currentSection || \"--\"}</h2>\r\n                        <h5 class=\"bottom\"><i class=\"fluid-icon\">contact_page</i> Your section</h5>\r\n                      </div>\r\n                      <div class=\"block status\">\r\n                        <h2 class=\"main numFont\">${allStudents.length}</h2>\r\n                        <h5 class=\"bottom\"><i class=\"fluid-icon\">groups</i> Total Students</h5>\r\n                      </div>\r\n                      <div class=\"block status\">\r\n                        <h2 class=\"main numFont\">${allTeachers.length}</h2>\r\n                        <h5 class=\"bottom\"><i class=\"fluid-icon\">school</i> ${allTeachers.length == 1 ? \"Teacher\" : \"Teachers\"}</h5>\r\n                      </div>\r\n                    </div>\r\n                ` + sections.map(section => (\r\n                    /*html*/`\r\n                        <div class=\"card\">\r\n                            <h5><b>${section.title}</b></h5>\r\n                            ${section.users.map(user => (\r\n                                /*html*/`\r\n                                    <div>\r\n                                        <p>\r\n                                            <img style=\"width: 30px; border-radius: 50%; vertical-align: middle; margin-right: 5px;\" src=\"${user.photoURL}\" />\r\n                                            <a href=\"${user.url}\" style=\"color: var(--text); vertical-align: middle;\">${user.name}</a>\r\n                                        </p>\r\n                                    </div>\r\n                                `\r\n                )).join(\"\")}\r\n                        </div>\r\n                    `\r\n                )).join(\"\"));\r\n            }\r\n        }\r\n    }).catch(function (err) {\r\n        dtps.error(\"Couldn't fetch users\", \"Caught promise rejection @ dtps.usersList\", err);\r\n    });\r\n}\r\n\r\n//Fluid UI screen definitions\r\nfluid.externalScreens.people = (courseID) => {\r\n    dtps.usersList(courseID);\r\n}\r\n\r\n/**\r\n* @typedef {Object} ClassSection\r\n* @description Defines a class section in DTPS\r\n* @property {string} title Name of the section\r\n* @property {string} id Section ID\r\n* @property {User[]} users Students in this section\r\n*/"]}