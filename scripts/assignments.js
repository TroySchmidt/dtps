/**
 * @file DTPS assignment functions
 * @author jottocraft
 * 
 * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */
dtps.renderAssignment=function(e){var s=dtps.renderAssignmentScore(e);return`\n        <div \n            onclick="${"dtps.assignment('"+e.id+"', "+e.class+")"}" \n            class="card ${s?"graded assignment":"assignment"}"\n            style="${"--classColor: "+dtps.classes[e.class].color}"\n        >\n\n            \x3c!-- Color bar for the dashboard --\x3e\n            <div class="colorBar"></div>\n\n            \x3c!-- Assignment title and points --\x3e\n            <h4>\n                <span>${e.title}</span>\n\n                \x3c!-- Points display --\x3e\n                ${s?`<div class="points">${s}</div>`:""}\n            </h4>\n\n            <h5 style="white-space: nowrap; overflow: hidden;">\n                \x3c!-- Assignment info --\x3e\n                ${e.dueAt?'<div class="infoChip"><i style="margin-top: -2px;" class="material-icons">alarm</i> Due '+dtps.formatDate(e.dueAt)+"</div>":""}\n                ${e.outcomes?'<div class="infoChip weighted"><i class="material-icons">adjust</i>'+e.outcomes.length+"</div>":""}\n                ${e.category?'<div class="infoChip weighted"><i class="material-icons">category</i> '+e.category+"</div>":""}\n\n                \x3c!-- Status icons --\x3e\n                ${e.turnedIn?'<i title="Assignment submitted" class="material-icons statusIcon" style="color: #0bb75b;">assignment_turned_in</i>':""}\n                ${e.missing?'<i title="Assignment is missing" class="material-icons statusIcon" style="color: #c44848;">remove_circle_outline</i>':""}\n                ${e.late?'<i title="Assignment is late" class="material-icons statusIcon" style="color: #c44848;">assignment_late</i>':""}\n                ${e.locked?'<i title="Assignment submissions are locked" class="material-icons statusIcon" style="font-family: \'Material Icons Extended\'; color: var(--secText, gray);">lock_outline</i>':""}\n                ${e.pending?'<i title="Grade is pending review" class="material-icons statusIcon" style="color: #b3b70b;">rate_review</i>':""}\n            </h5>\n        </div>\n    `},dtps.renderAssignmentScore=function(e){var s="";if(dtpsLMS.useRubricGrades&&e.rubric){var t=[];e.rubric.forEach(e=>{e.score&&t.push(`\n                    <div title="${e.title}" style="color: ${e.color||"var(--text)"};">\n                        ${e.score}\n                    </div>\n                `)}),t.length&&(s=`<div class="dtpsRubricScore">${t.join("")}</div>`)}else dtpsLMS.useRubricGrades||!e.grade&&0!=e.grade||(s=`\n            <div class="assignmentGrade">\n                <div class="grade">${e.grade}</div>\n                <div class="value">/${e.value}</div>\n                ${e.letter?`<div class="letter">${e.letter.replace("incomplete",'<i class="material-icons">cancel</i>').replace("complete",'<i class="material-icons">done</i>')}</div>`:""}\n                <div class="percentage">${Math.round(e.grade/e.value*100)}%</div>\n            </div>\n        `);return s},dtps.masterStream=function(){dtps.presentClass("dash"),dtps.showClasses(),$("#dtpsTabBar .btn").removeClass("active");var e=0;dtps.classes.forEach(s=>{s.assignments&&e++});var s=e==dtps.classes.length;function t(e){return"dtps.calendar"==e.id?window.FullCalendar?'<div id="calendar" class="card" style="padding: 20px;"></div>':"":"dtps.updates"==e.id?'<div class="updatesStream recentlyGraded announcements"></div>':"dtps.dueToday"==e.id?'<div style="padding: 20px 0px;" class="dueToday"></div>':"dtps.upcoming"==e.id?'<div style="padding: 20px 0px;" class="assignmentStream"></div>':void 0}"dash"==dtps.selectedClass&&jQuery(".classContent").html(`\n            <div class="dash cal" style="width: 40%;display: inline-block; vertical-align: top;">\n                ${dtps.leftDashboard.map(e=>t(e)).join("")}\n            </div>\n\n            <div style="width: 59%; display: inline-block;" class="dash stream">\n                ${s?"":'<div style="margin: 75px 25px 10px 75px;"><div class="spinner"></div></div>'}\n                ${dtps.rightDashboard.map(e=>t(e)).join("")}\n            </div>\n        `),dtps.renderUpdates(),dtps.renderUpcoming(s),dtps.calendar(),dtps.renderDueToday(s)},dtps.renderDueToday=function(e){var s=[];dtps.classes&&dtps.classes.forEach(e=>{e.assignments&&e.assignments.forEach(e=>{dtps.isToday(e.dueAt)&&s.push(e)})}),s.sort((function(e,s){var t=new Date(e.dueAt).getTime(),a=new Date(s.dueAt).getTime();return t>a?1:t<a?-1:0}));var t=s.map(e=>dtps.renderAssignment(e)).join("");t=0==s.length?e?'<p style="text-align: center;margin: 10px 25px 10px 75px; font-size: 18px;"><i class="material-icons">done</i> Nothing due today</p>':"":'\n            <h5 style="text-align: center; margin: 10px 25px 10px 75px; font-weight: bold;">Due today</h5>\n        '+t,"dash"==dtps.selectedClass&&jQuery(".classContent .dash .dueToday").html(t)},dtps.renderUpcoming=function(){var e=[];dtps.classes&&dtps.classes.forEach(s=>{s.assignments&&s.assignments.forEach(s=>{new Date(s.dueAt)>new Date&&!dtps.isToday(s.dueAt)&&e.push(s)})}),e.sort((function(e,s){var t=new Date(e.dueAt).getTime(),a=new Date(s.dueAt).getTime();return t>a?1:t<a?-1:0}));var s=e.map(e=>dtps.renderAssignment(e)).join("");0==e.length&&(s=""),"dash"==dtps.selectedClass&&jQuery(".classContent .dash .assignmentStream").html(s)},dtps.renderUpdates=function(){var e="";dtps.updates.forEach(s=>{if("announcement"==s.type)e+=`\n                <div onclick="$(this).toggleClass('open');" style="cursor: pointer; padding: 20px; --classColor: ${dtps.classes[s.class].color};" class="announcement card">\n                    <div class="className">${s.title}</div>\n                    ${s.body}\n                </div>\n            `;else if("assignment"==s.type){var t=dtps.renderAssignmentScore(s);e+=`\n                <div onclick="dtps.assignment('${s.id}', ${s.class})" style="--classColor: ${dtps.classes[s.class].color};" class="card recentGrade">\n                    <h5>\n                        <span>${s.title}</span>\n\n                        \x3c!-- Points display --\x3e\n                        ${t?`<div class="points">${t}</div>`:""}\n                    </h5>\n\n                    <p>Graded at ${dtps.formatDate(s.gradedAt)}</p>\n                </div>\n            `}}),"dash"==dtps.selectedClass&&jQuery(".classContent .dash .updatesStream").html(e)},dtps.calendar=function(){if("dash"==dtps.selectedClass){var e=[];if(dtps.classes.forEach((s,t)=>{s.assignments&&s.assignments.forEach(a=>{e.push({title:a.title,start:a.dueAt,id:a.id,allDay:!0,backgroundColor:s.color,textColor:"white",classNum:t,assignmentID:a.id})})}),window.FullCalendar){var s=document.getElementById("calendar");calendar=new FullCalendar.Calendar(s,{locale:"en",initialView:"dayGridMonth",events:e,contentHeight:0,handleWindowResize:!1,headerToolbar:{start:"title",center:"",end:"prev,next"},eventClick:function(e){console.log(e),dtps.assignment(e.event.extendedProps.assignmentID,e.event.extendedProps.classNum)}}),calendar.render()}}},dtps.classStream=function(e,s,t){var a=dtps.classes.map(e=>e.id).indexOf(e);dtps.selectedClass=a,dtps.selectedContent="stream",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.stream").addClass("active"),dtps.presentClass(a),dtps.showClasses(),-1==a&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.classStream");var n=s||dtps.classes[a].assignments;if(n)if(0==n.length)t?dtps.selectedClass==a&&"stream"==dtps.selectedContent&&$(".classContent").html(dtps.renderClassTools(a,"stream",t)+'\n                    <div style="cursor: auto;" class="card assignment">\n                        <h4>No results</h4>\n                        <p>There weren\'t any search results</p>\n                        <button onclick="fluid.screen()" class="btn"><i class="material-icons">arrow_back</i> Back</button>\n                    </div>\n                '):dtps.selectedClass==a&&"stream"==dtps.selectedContent&&$(".classContent").html(dtps.renderClassTools(a,"stream",t)+'<div style="cursor: auto;" class="card assignment"><h4>No assignments</h4><p>There aren\'t any assignments in this class yet</p></div>');else{n.sort((function(e,s){var t=new Date(e.dueAt).getTime(),a=new Date(s.dueAt).getTime(),n=(new Date).getTime();return e.dueAt||(t=0),s.dueAt||(a=0),t<n||a<n?t<a?1:t>a?-1:0:t>a?1:t<a?-1:0}));var i=null,l=n.map(e=>{var s="";return e.dueAt?new Date(e.dueAt)<new Date?(i&&"old"!==i&&(s='<h5 style="margin: 75px 75px 10px 75px;font-weight: bold;">Old Assignments</h5>'),i="old"):i="upcoming":(i&&"undated"!==i&&(s='<h5 style="margin: 75px 75px 10px 75px;font-weight: bold;">Undated Assignments</h5>'),i="undated"),s+dtps.renderAssignment(e)}).join("");l=dtps.renderClassTools(a,"stream",t)+l,dtps.selectedClass==a&&"stream"==dtps.selectedContent&&$(".classContent").html(l)}else dtps.selectedClass==a&&"stream"==dtps.selectedContent&&jQuery(".classContent").html(dtps.renderClassTools(a,"stream",t)+'<div class="spinner"></div>')},dtps.assignment=function(e,s){var t=dtps.classes[s].assignments.map(e=>e.id),a=dtps.classes[s].assignments[t.indexOf(e)],n=null;if(a.body){var i=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards"),l=getComputedStyle($(".card.details")[0]).getPropertyValue("--text"),d=a.body;$("body").hasClass("dark")&&(d=dtps.brightenTextForDarkMode(a.body,i));var r=!1;if(d.toLowerCase().includes("deliverable")&&d.toLowerCase().includes("instruction")&&d.toLowerCase().includes("look for")&&(r=!0),dtps.remoteConfig.dtechCleanUpAssignments&&"false"!==fluid.get("pref-formatAssignmentContent")&&dtpsLMS.dtech&&r&&$("<div></div>").append(d).children("table").find("tbody tr").length>1){var o=[];$("<div></div>").append(d).children("table").find("tbody tr").toArray().forEach((e,s)=>{var t=$(e).find("h4:first-child").text().toLowerCase();if(t){var a=$(e);a.find("h4:first-child").remove();var n=a.html();if(n){var i=null;t.includes("deliverable")&&(i="description",t="Deliverables"),t.includes("instruction")&&(i="assignment",t="Instructions"),t.includes("look for")&&(i="find_in_page",t="Look Fors"),o.push({text:t,icon:i,innerHTML:n})}}});var c=$("<div></div>").append(d);c.children("table").replaceWith(o.map(e=>`\n                    <div class="dtpsFormattedAssignmentSection" style="margin: 20px 0px;">\n                        <h2><i style="vertical-align: middle; margin-right: 10px; font-size: 24px;" class="material-icons-outlined">${e.icon}</i><span style="vertical-align: middle;text-decoration: underline;">${e.text}</span></h2>\n                        ${e.innerHTML}\n                    </div>\n                `).join(""));var p=c.html(),m=new Blob([`\n                    <base target="_blank" /> \n                    <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">\n                    <style>body {background-color: ${i}; color: ${l};} .dtpsFormattedAssignmentSection *:not(a) { color: ${l} !important; }</style>\n                    ${p}\n            `],{type:"text/html"});n=`<iframe id="assignmentParts" onload="dtps.iframeLoad('assignmentParts')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${window.URL.createObjectURL(m)}" />`}else{m=new Blob([`\n                <base target="_blank" /> \n                <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                <style>body {background-color: ${i}; color: ${l};}</style>\n                ${d}\n            `],{type:"text/html"});n=`<iframe id="assignmentIframe" onload="dtps.iframeLoad('assignmentIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${window.URL.createObjectURL(m)}" />`}}var u="";if(a.rubric)u=a.rubric.map((function(e){return`\n                    <div class="dtpsAssignmentRubricItem">\n                        <h5>${e.title}</h5>\n                        <div class="score">\n                            <p style="color: ${e.color?e.color:"var(--secText)"};" class="scoreName">\n                                ${e.score?e.scoreName||"":"Not assessed"}\n\n                                <div class="points">\n                                    <p class="earned">${e.score||"-"}</p>\n                                    <p class="possible">${"/"+e.value}</p>\n                                </div>\n                            </p>\n                        </div>\n                    </div>\n                `})).join("");var g="";if(a.feedback)g=a.feedback.map(e=>`\n                    <div class="dtpsSubmissionComment">\n                        ${e.author?`\n                            <img src="${e.author.photoURL}" />\n                            <h5>${e.author.name}</h5>\n                        `:""}\n\n                        <p>${e.comment}</p>\n                    </div>\n                `).join("");var v=dtps.renderAssignmentScore(a);$(".card.details").html(`\n            <i onclick="fluid.cards.close('.card.details'); $('.card.details').html('');" class="material-icons close">close</i>\n\n            <h4 style="font-weight: bold;">${a.title}</h4>\n\n            <div>\n                ${a.dueAt?`<div class="assignmentChip"><i class="material-icons">alarm</i><span>Due ${dtps.formatDate(a.dueAt)}</span></div>`:""}\n                ${a.turnedIn?'<div title="Assignment submitted" class="assignmentChip" style="color: #0bb75b"><i class="material-icons">assignment_turned_in</i></div>':""}\n                ${a.missing?'<div  title="Assignment is missing" class="assignmentChip" style="color: #c44848"><i class="material-icons">remove_circle_outline</i></div>':""}\n                ${a.late?'<div title="Assignment is late" class="assignmentChip" style="color: #c44848"><i class="material-icons">assignment_late</i></div>':""}\n                ${a.locked?'<div title="Assignment submissions are locked" class="assignmentChip" style="color: var(--secText, gray);"><i style="font-family: \'Material Icons Extended\';" class="material-icons">lock_outline</i></div>':""}\n                ${v}\n            </div>\n\n            <div style="margin-top: 20px;" class="assignmentBody">\n                ${a.body?n:""}\n            </div>\n\n            ${a.body?'<div style="margin: 5px 0px; background-color: var(--darker); height: 1px; width: 100%;" class="divider"></div>':""}\n\n            <div style="width: calc(40% - 2px); margin-top: 20px; display: inline-block; overflow: hidden; vertical-align: top;">\n                ${a.publishedAt?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">add_box</i> Published: ${dtps.formatDate(a.publishedAt)}</p>`:""}\n                ${a.dueAt?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">alarm</i> Due: ${dtps.formatDate(a.dueAt)}</p>`:""}\n                ${a.value?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">bar_chart</i> Point value: ${a.value}</p>`:""}\n                ${a.grade||0==a.grade?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">assessment</i> Points earned: ${a.grade}</p>`:""}\n                ${a.letter?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">font_download</i> Letter grade: ${a.letter}</p>`:""}\n                ${a.category?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">category</i> Category: ${a.category}</p>`:""}\n                ${a.rubric?a.rubric.map((function(e){return`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">adjust</i> ${e.title}</p>`})).join(""):""}\n                <p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">class</i> Class: ${dtps.classes[a.class].subject}</p>\n                ${"dev"==dtps.env?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">code</i> Assignment ID: ${a.id}</p>`:""}\n\n                <br />\n                <div class="row">\n                    ${a.url?`<div class="btn small outline" onclick="window.open('${a.url}')"><i class="material-icons">open_in_new</i> Open in ${dtpsLMS.shortName||dtpsLMS.name}</div>`:""}\n                </div>\n            </div>\n\n            <div style="width: calc(60% - 7px); margin-top: 20px; margin-left: 5px; display: inline-block; overflow: hidden; vertical-align: middle;">\n                ${g}\n\n                ${u}\n            </div>\n        `),fluid.cards.close(".card.focus"),fluid.modal(".card.details")},dtps.search=function(){if(""==$("input.search").val())fluid.screen();else{var e=$("input.search").val(),s=new Fuse(dtps.classes[dtps.selectedClass].assignments,{keys:["title","body"]});dtps.classStream(dtps.classes[dtps.selectedClass].id,s.search(e),e)}},dtps.moduleStream=function(e){var s=dtps.classes.map(e=>e.id).indexOf(e);dtps.selectedClass=s,dtps.selectedContent="moduleStream",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.stream").addClass("active"),dtps.presentClass(s),dtps.showClasses(),-1==s&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.moduleStream"),dtps.selectedClass==s&&"moduleStream"==dtps.selectedContent&&jQuery(".classContent").html(dtps.renderClassTools(s,"modules")+'<div class="spinner"></div>'),new Promise(e=>{dtps.classes[s].modules&&!0!==dtps.classes[s].modules?e(dtps.classes[s].modules):dtpsLMS.fetchModules(dtps.classes[s].id).then(s=>e(s))}).then(t=>{dtps.classes[s].modules=t;var a=dtps.renderClassTools(s,"modules");t.forEach(t=>{var n="";t.items.forEach(t=>{var a="list";"assignment"==t.type&&(a="assignment"),"page"==t.type&&(a="insert_drive_file"),"discussion"==t.type&&(a="forum"),"url"==t.type&&(a="open_in_new"),"header"==t.type&&(a="format_size"),"embed"==t.type&&(a="web");var i="";"assignment"==t.type&&(i="dtps.assignment('"+t.id+"', "+s+")"),"page"==t.type&&(i="fluid.screen('pages', '"+e+"|"+t.id+"|true')"),"discussion"==t.type&&(i="fluid.screen('discussions', '"+e+"|"+t.id+"|true')"),"url"==t.type&&(i="window.open('"+t.url+"')"),"header"==t.type&&(i=""),"embed"==t.type&&(i="dtps.showIFrameCard('"+t.url+"')"),"header"==t.type?n+=`<h5 style="font-size: 22px;padding: 2px 10px;">${t.title}</h5>`:n+=`\n                        <div class="moduleItem" onclick="${i}" style="margin-left: ${15*t.indent}px;">\n                            <i ${t.completed?'style="color: #27ba3c"':""} class="material-icons">${t.completed?"check":a}</i>\n                            ${t.title}\n                        </div>\n                    `}),a+=`\n                <div class="module card ${t.collapsed?"collapsed":""}">\n                    <h4>\n                        <i onclick="dtps.moduleCollapse(this, '${dtps.classes[s].id}', '${t.id}');" \n                            class="material-icons collapseIcon">${t.collapsed?"keyboard_arrow_right":"keyboard_arrow_down"}</i>\n                        ${t.title}\n                    </h4>\n\n                    <div class="moduleContents" style="padding-top: 10px;">\n                        ${n}\n                    </div>\n                </div>\n            `}),0==t.length&&(a+='<div style="cursor: auto;" class="card assignment"><h4>No modules</h4><p>There aren\'t any modules in this class yet</p></div>'),dtps.selectedClass==s&&"moduleStream"==dtps.selectedContent&&jQuery(".classContent").html(a)}).catch(e=>{dtps.error("Could not load modules","Caught promise rejection @ dtps.moduleStream",e)})},dtps.moduleCollapse=function(e,s,t){$(e).parents(".card").toggleClass("collapsed"),$(e).parents(".card").hasClass("collapsed")?(dtpsLMS.collapseModule&&dtpsLMS.collapseModule(s,t,!0),$(e).html("keyboard_arrow_right")):(dtpsLMS.collapseModule&&dtpsLMS.collapseModule(s,t,!1),$(e).html("keyboard_arrow_down"))},dtps.renderClassTools=function(e,s,t){var a=dtps.classes[e].modules;return`\n        <div style="position: absolute;display:inline-block;margin: ${a?"82px":"38px 82px"};">\n\n            ${dtps.classes[e].teacher?`\n                <div class="acrylicMaterial" style="border-radius: 20px; display: inline-block; margin-right: 5px;">\n                    <img src="${dtps.classes[e].teacher.photoURL}" style="width: 40px; height: 40px; border-radius: 50%;vertical-align: middle;"> \n                    <div style="font-size: 16px;display: inline-block;vertical-align: middle;margin: 0px 10px;">${dtps.classes[e].teacher.name}</div>\n                </div>`:""}\n\n            <div onclick="dtps.classInfo(${e})" class="acrylicMaterial" style="border-radius: 50%; height: 40px; width: 40px; text-align: center; display: inline-block; vertical-align: middle; cursor: pointer; margin-right: 3px;">\n                <i style="line-height: 40px;" class="material-icons">info</i>\n            </div>\n\n            ${dtps.classes[e].homepage?`\n                <div onclick="dtps.classHome(${e})" class="acrylicMaterial" style="border-radius: 50%; height: 40px; width: 40px; text-align: center; display: inline-block; vertical-align: middle; cursor: pointer; margin-right: 3px;">\n                    <i style="line-height: 40px;" class="material-icons">home</i>\n                </div>`:""}\n\n        ${dtps.classes[e].videoMeetingURL?`\n                <div onclick="window.open('${dtps.classes[e].videoMeetingURL}')" class="acrylicMaterial" style="border-radius: 50%; height: 40px; width: 40px; text-align: center; display: inline-block; vertical-align: middle; cursor: pointer; margin-right: 3px;">\n                    <i style="line-height: 40px;" class="material-icons">videocam</i>\n                </div>`:""}\n\n        </div>\n        \n        ${"modules"==s||"stream"==s?`\n            <div style="text-align: right;${a?"":"margin-top: 20px;"}">\n\n                ${"stream"==s?`<i class="inputIcon material-icons">search</i><input ${t?`value="${t}"`:""} onchange="dtps.search()" class="search inputIcon filled shadow" placeholder="Search assignments" type="search" />`:""}\n\n                <br />\n                ${a?`\n                    <div class="btns row small acrylicMaterial assignmentPicker" style="margin: ${"stream"==s?"20px 80px 20px 0px !important":"63px 80px 20px 0px !important"};">\n                        <button class="btn ${"stream"==s?"active":""}" onclick="fluid.screen('stream', dtps.classes[dtps.selectedClass].id);"><i class="material-icons">assignment</i>Assignments</button>\n                        <button class="btn ${"modules"==s?"active":""}" onclick="fluid.screen('moduleStream', dtps.classes[dtps.selectedClass].id);"><i class="material-icons">view_module</i>Modules</button>\n                    </div>\n                `:""}\n                \n            </div>`:""}\n    `},dtps.classInfo=function(e){if(""!==dtps.classes[e].syllabus&&null!==dtps.classes[e].syllabus)var s=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards"),t=getComputedStyle($(".card.details")[0]).getPropertyValue("--text"),a=new Blob([`\n            <base target="_blank" /> \n            <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n            <style>body {background-color: ${s}; color: ${t};</style>\n            ${dtps.classes[e].syllabus}\n        `],{type:"text/html"}),n=window.URL.createObjectURL(a);$(".card.details").html(`\n        <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n\n        <h4 style="font-weight: bold;">${dtps.classes[e].name}</h4>\n        <p style="color: var(--secText)">${dtps.classes[e].description||""}</p>\n\n        ${dtps.classes[e].numStudents?`<div class="assignmentChip"><i class="material-icons">group</i><span>${dtps.classes[e].numStudents} students</span></div>`:""}\n        ${"dev"==dtps.env?`<div class="assignmentChip"><i class="material-icons">code</i><span>Class ID: ${dtps.classes[e].id}</span></div>`:""}\n    \n        <br />\n\n        <div style="margin-top: 20px;" class="syllabusBody">\n            ${dtps.classes[e].syllabus?`\n                <iframe id="syllabusIframe" onload="dtps.iframeLoad('syllabusIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${n}" />`:""}\n        </div>\n    `),fluid.modal(".card.details")},dtps.classHome=function(e){$(".card.details").html(`\n        <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n        <h4 style="font-weight: bold;">${dtps.classes[e].subject} Homepage</h4>\n\n        <br />\n        <p>Loading...</p>\n    `),dtpsLMS.fetchHomepage(dtps.classes[e].id).then(s=>{if(s){var t=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards"),a=getComputedStyle($(".card.details")[0]).getPropertyValue("--text");if($("body").hasClass("dark")&&(s=dtps.brightenTextForDarkMode(s,t)),dtps.remoteConfig.dtechHomepageFluidUITabs&&$("<div></div>").append(s).find(".enhanceable_content.tabs>ul>li").toArray().length>1){var n=[];$("<div></div>").append(s).find(".enhanceable_content.tabs>ul>li").toArray().forEach(e=>{var i=$(e).text().toLowerCase();if(i){var l=$(e).find("a").attr("href").replace("#","");if(l){var d=$(s).find("#"+l).html();if(d){var r=null;i.includes("agenda")&&(r="format_list_numbered",i="Agenda"),i.includes("instructor")&&(r="person",i="Instructor"),i.includes("course info")&&(r="info",i="Course Info"),i.includes("resources")&&(r="article",i="Course Resources");var o=new Blob([`\n                        <base target="_blank" /> \n                        <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                        <style>body {background-color: ${t}; color: ${a};</style>\n                        ${d}\n                    `],{type:"text/html"}),c=window.URL.createObjectURL(o);n.push({text:i,id:l,icon:r,frameURL:c})}}}}),$(".card.details").html(`\n                    <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n\n                    <h4 style="font-weight: bold;">${dtps.classes[e].subject} Homepage</h4>\n\n                    <br />\n                    ${dtps.classes[e].videoMeetingURL?`<button onclick="window.open('${dtps.classes[e].videoMeetingURL}')" class="btn small"><i class="material-icons">videocam</i> Zoom</button>`:""}\n                    <div class="btns row small">\n                        ${n.map((e,s)=>`<button onclick="$(this).addClass('active');$(this).siblings().removeClass('active');$('#homepageFragment').attr('src', '${e.frameURL}'); dtps.iframeLoad('homepageFragment');" \n                                style="text-transform: capitalize;" class="btn ${0==s?"active":""}">${e.icon?`<i class="material-icons">${e.icon}</i> `:""}${e.text}</button>`).join("")}\n                    </div>\n\n                    <br />\n                    <div style="margin-top: 20px;" class="homepageBody">\n                        <iframe id="homepageFragment" onload="dtps.iframeLoad('homepageFragment')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${n[0].frameURL}" />\n                    </div>\n                `)}else{var i=new Blob([`\n                    <base target="_blank" /> \n                    <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                    <style>body {background-color: ${t}; color: ${a};</style>\n                    ${s}\n                `],{type:"text/html"}),l=window.URL.createObjectURL(i);$(".card.details").html(`\n                    <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n\n                    <h4 style="font-weight: bold;">${dtps.classes[e].subject} Homepage</h4>\n\n                    <br />\n                    <div style="margin-top: 20px;" class="homepageBody">\n                        <iframe id="homepageIframe" onload="dtps.iframeLoad('homepageIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${l}" />\n                    </div>\n                `)}fluid.modal(".card.details")}else fluid.cards.close(".card.details"),dtps.error("Homepage unavailable","homepage is either empty or undefined @ dtps.classHome")}).catch(e=>{dtps.error("Couldn't load homepage","Caught a promise rejection @ dtps.classHome",e)})},dtps.gradebook=function(e){var s=dtps.classes.map(e=>e.id).indexOf(e);if(dtps.selectedClass=s,dtps.selectedContent="grades",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.grades").addClass("active"),dtps.presentClass(s),dtps.showClasses(),-1==s&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.gradebook"),dtps.selectedClass==s&&"grades"==dtps.selectedContent&&jQuery(".classContent").html('<div class="spinner"></div>'),dtps.classes[s].letter&&dtps.classes[s].assignments){var t=0,a=0,n=0,i=0,l="";dtps.classes[s].assignments.forEach(e=>{(e.grade||0==e.grade)&&(n+=e.grade,i++,l+=`\n                <div onclick="dtps.assignment('${e.id}', ${s})" class="gradebookAssignment card">\n                    <h5>\n                        ${e.title}\n\n                        <div class="stats">\n                            ${e.letter?`<div class="gradebookLetter">${e.letter}</div>`:""}\n                            <div class="gradebookScore">${e.grade}</div>\n                            <div class="gradebookValue">/${e.value}</div>\n                            <div class="gradebookPercentage">${Math.round(e.grade/e.value*100)}%</div>\n                        </div>\n                    </h5>\n                </div>\n            `),e.value&&(a+=e.value),0==e.grade&&e.value&&t++});var d=`\n        <div style="--classColor: ${dtps.classes[s].color}" class="card">\n            <h3 class="gradeTitle">\n                Grade Summary\n                <div class="classGradeCircle">\n                    ${dtps.classes[s].grade?`<span class="percentage">${dtps.classes[s].grade}%</span>`:""}\n                    <div class="letter">${dtps.classes[s].letter||""}</div>\n                </div>\n            </h3>\n\n            ${t?`\n                <h5 style="color: #d63d3d;" class="gradeStat">\n                    Zeros\n                    <div style="color: #d63d3d;" class="numFont">${t}</div>\n                </h5>\n            `:""}\n\n            <div style="${dtps.gradebookExpanded?"":"display: none;"}" id="classGradeMore">\n                <br />\n\n                ${dtps.classes[s].previousLetter?`\n                    <h5 class="smallStat">\n                        Previous Grade\n                        <div class="numFont">${dtps.classes[s].previousLetter}</div>\n                    </h5>\n                `:""}\n\n                <h5 class="smallStat">\n                    Points\n                    <div class="numFont fraction">\n                        <span class="earned">${n}</span>\n                        <span class="total">/${a}</span>\n                    </div>\n                </h5>\n\n                <h5 class="smallStat">\n                    Graded Assignments\n                    <div class="numFont">${i}</div>\n                </h5>\n            </div>\n\n            <br />\n            <a onclick="$('#classGradeMore').toggle(); if ($('#classGradeMore').is(':visible')) {$(this).html('Show less'); dtps.gradebookExpanded = true;} else {$(this).html('Show more'); dtps.gradebookExpanded = false;}"\n                style="color: var(--secText, gray); cursor: pointer; margin-right: 10px;">${dtps.gradebookExpanded?"Show less":"Show more"}</a>\n        </div>\n\n        <br />\n    `;dtps.selectedClass==s&&"grades"==dtps.selectedContent&&$(".classContent").html(d+l)}},fluid.externalScreens.dashboard=()=>{dtps.masterStream()},fluid.externalScreens.stream=e=>{dtps.classStream(e)},fluid.externalScreens.moduleStream=e=>{dtps.moduleStream(e)},fluid.externalScreens.gradebook=e=>{dtps.gradebook(e)};
//# sourceMappingURL=/scripts/assignments.js.map