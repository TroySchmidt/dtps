/**
 * @file DTPS assignment functions
 * @author jottocraft
 * 
 * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */
dtps.renderAssignment=function(s){var e=dtps.renderAssignmentScore(s);return`\n        <div \n            onclick="${"dtps.assignment('"+s.id+"', "+s.class+")"}" \n            class="card ${e?"graded assignment":"assignment"}"\n            style="${"--classColor: "+dtps.classes[s.class].color}"\n        >\n\n            \x3c!-- Color bar for the dashboard --\x3e\n            <div class="colorBar"></div>\n\n            \x3c!-- Assignment title and points --\x3e\n            <h4>\n                <span>${s.title}</span>\n\n                \x3c!-- Points display --\x3e\n                ${e?`<div class="points">${e}</div>`:""}\n            </h4>\n\n            <h5 style="white-space: nowrap; overflow: hidden;">\n                \x3c!-- Assignment info --\x3e\n                ${s.dueAt?'<div class="infoChip"><i style="margin-top: -2px;" class="material-icons">alarm</i> Due '+dtps.formatDate(s.dueAt)+"</div>":""}\n                ${s.outcomes?'<div class="infoChip weighted"><i class="material-icons">adjust</i>'+s.outcomes.length+"</div>":""}\n                ${s.category?'<div class="infoChip weighted"><i class="material-icons">category</i> '+s.category+"</div>":""}\n\n                \x3c!-- Status icons --\x3e\n                ${s.turnedIn?'<i title="Assignment submitted" class="material-icons statusIcon" style="color: #0bb75b;">assignment_turned_in</i>':""}\n                ${s.missing?'<i title="Assignment is missing" class="material-icons statusIcon" style="color: #c44848;">remove_circle_outline</i>':""}\n                ${s.late?'<i title="Assignment is late" class="material-icons statusIcon" style="color: #c44848;">assignment_late</i>':""}\n                ${s.locked?'<i title="Assignment submissions are locked" class="material-icons statusIcon" style="font-family: \'Material Icons Extended\'; color: var(--secText, gray);">lock_outline</i>':""}\n                ${s.pending?'<i title="Grade is pending review" class="material-icons statusIcon" style="color: #b3b70b;">rate_review</i>':""}\n            </h5>\n        </div>\n    `},dtps.renderAssignmentScore=function(s){var e="";if(dtpsLMS.useRubricGrades&&s.rubric){var t=[];s.rubric.forEach((s=>{s.score&&t.push(`\n                    <div title="${s.title}" style="color: ${s.color||"var(--text)"};">\n                        ${s.score}\n                    </div>\n                `)})),t.length&&(e=`<div class="dtpsRubricScore">${t.join("")}</div>`)}else dtpsLMS.useRubricGrades||!s.grade&&0!=s.grade||(e=`\n            <div class="assignmentGrade">\n                <div class="grade">${s.grade}</div>\n                <div class="value">/${s.value}</div>\n                ${s.letter?`<div class="letter">${s.letter.replace("incomplete",'<i class="material-icons">cancel</i>').replace("complete",'<i class="material-icons">done</i>')}</div>`:""}\n                <div class="percentage">${Math.round(s.grade/s.value*100)}%</div>\n            </div>\n        `);return e},dtps.masterStream=function(){dtps.presentClass("dash"),dtps.showClasses(),$("#dtpsTabBar .btn").removeClass("active");var s=0;dtps.classes.forEach((e=>{e.assignments&&s++}));var e=s==dtps.classes.length;function t(s){return"dtps.calendar"==s.id?window.FullCalendar?'<div id="calendar" class="card" style="padding: 20px;"></div>':"":"dtps.updates"==s.id?'<div class="updatesStream recentlyGraded announcements"></div>':"dtps.dueToday"==s.id?'<div style="padding: 20px 0px;" class="dueToday"></div>':"dtps.upcoming"==s.id?'<div style="padding: 20px 0px;" class="assignmentStream"></div>':void 0}"dash"==dtps.selectedClass&&jQuery(".classContent").html(`\n            <div class="dash cal" style="width: 40%;display: inline-block; vertical-align: top;">\n                ${dtps.leftDashboard.map((s=>t(s))).join("")}\n            </div>\n\n            <div style="width: 59%; display: inline-block;" class="dash stream">\n                ${e?"":'<div style="margin: 75px 25px 10px 75px;"><div class="spinner"></div></div>'}\n                ${dtps.rightDashboard.map((s=>t(s))).join("")}\n            </div>\n        `),dtps.renderUpdates(),dtps.renderUpcoming(e),dtps.calendar(),dtps.renderDueToday(e)},dtps.renderDueToday=function(s){var e=[];dtps.classes&&dtps.classes.forEach((s=>{s.assignments&&s.assignments.forEach((s=>{dtps.isToday(s.dueAt)&&e.push(s)}))})),e.sort((function(s,e){var t=new Date(s.dueAt).getTime(),n=new Date(e.dueAt).getTime();return t>n?1:t<n?-1:0}));var t=e.map((s=>dtps.renderAssignment(s))).join("");t=0==e.length?s?'<p style="text-align: center;margin: 10px 25px 10px 75px; font-size: 18px;"><i class="material-icons">done</i> Nothing due today</p>':"":'\n            <h5 style="text-align: center; margin: 10px 25px 10px 75px; font-weight: bold;">Due today</h5>\n        '+t,"dash"==dtps.selectedClass&&jQuery(".classContent .dash .dueToday").html(t)},dtps.renderUpcoming=function(){var s=[];dtps.classes&&dtps.classes.forEach((e=>{e.assignments&&e.assignments.forEach((e=>{new Date(e.dueAt)>new Date&&!dtps.isToday(e.dueAt)&&s.push(e)}))})),s.sort((function(s,e){var t=new Date(s.dueAt).getTime(),n=new Date(e.dueAt).getTime();return t>n?1:t<n?-1:0}));var e=s.map((s=>dtps.renderAssignment(s))).join("");0==s.length&&(e=""),"dash"==dtps.selectedClass&&jQuery(".classContent .dash .assignmentStream").html(e)},dtps.renderUpdates=function(){var s="";dtps.updates.forEach((e=>{if("announcement"==e.type)s+=`\n                <div onclick="$(this).toggleClass('open');" style="cursor: pointer; padding: 20px; --classColor: ${dtps.classes[e.class].color};" class="announcement card">\n                    <div class="className">${e.title}</div>\n                    ${e.body}\n                </div>\n            `;else if("assignment"==e.type){var t=dtps.renderAssignmentScore(e);s+=`\n                <div onclick="dtps.assignment('${e.id}', ${e.class})" style="--classColor: ${dtps.classes[e.class].color};" class="card recentGrade">\n                    <h5>\n                        <span>${e.title}</span>\n\n                        \x3c!-- Points display --\x3e\n                        ${t?`<div class="points">${t}</div>`:""}\n                    </h5>\n\n                    <p>Graded at ${dtps.formatDate(e.gradedAt)}</p>\n                </div>\n            `}})),"dash"==dtps.selectedClass&&jQuery(".classContent .dash .updatesStream").html(s)},dtps.calendar=function(){if("dash"==dtps.selectedClass){var s=[];if(dtps.classes.forEach(((e,t)=>{e.assignments&&e.assignments.forEach((n=>{s.push({title:n.title,start:n.dueAt,id:n.id,allDay:!0,backgroundColor:e.color,borderColor:!0===n.missing?"#c44848":"transparent",textColor:"white",classNum:t,assignmentID:n.id,missing:n.missing})}))})),window.FullCalendar){var e=document.getElementById("calendar");calendar=new FullCalendar.Calendar(e,{locale:"en",initialView:"dayGridMonth",events:s,eventContent:(s,e)=>{console.log(s);const{missing:t}=s.event.extendedProps;return{html:`\n                        <div class='fc-event-main-frame'>\n                            <div class='fc-event-title-container'>\n                                <div class='fc-event-title fc-sticky'>\n                                    ${t?'<i title="Assignment is missing" class="material-icons statusIcon">remove_circle_outline</i>':""}\n                                    <span style="vertical-align: middle;">${s.event.title}</span>\n                                </div>\n                            </div>\n                        </div>\n                    `}},contentHeight:0,handleWindowResize:!1,headerToolbar:{start:"title",center:"",end:"prev,next"},dateClick:function(s){console.log("Clicked date",s)},eventClick:function(s){console.log(s),dtps.assignment(s.event.extendedProps.assignmentID,s.event.extendedProps.classNum)}}),calendar.render()}}},dtps.classStream=function(s,e,t){var n=dtps.classes.map((s=>s.id)).indexOf(s);dtps.selectedClass=n,dtps.selectedContent="stream",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.stream").addClass("active"),dtps.presentClass(n),dtps.showClasses(),-1==n&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.classStream");var a=e||dtps.classes[n].assignments;if(a)if(0==a.length)t?dtps.selectedClass==n&&"stream"==dtps.selectedContent&&$(".classContent").html(dtps.renderClassTools(n,"stream",t)+'\n                    <div style="cursor: auto;" class="card assignment">\n                        <h4>No results</h4>\n                        <p>There weren\'t any search results</p>\n                        <button onclick="fluid.screen()" class="btn"><i class="material-icons">arrow_back</i> Back</button>\n                    </div>\n                '):dtps.selectedClass==n&&"stream"==dtps.selectedContent&&$(".classContent").html(dtps.renderClassTools(n,"stream",t)+'<div style="cursor: auto;" class="card assignment"><h4>No assignments</h4><p>There aren\'t any assignments in this class yet</p></div>');else{a.sort((function(s,e){var t=new Date(s.dueAt).getTime(),n=new Date(e.dueAt).getTime(),a=(new Date).getTime();return s.dueAt||(t=0),e.dueAt||(n=0),t<a||n<a?t<n?1:t>n?-1:0:t>n?1:t<n?-1:0}));var i=null,l=a.map((s=>{var e="";return s.dueAt?new Date(s.dueAt)<new Date?(i&&"old"!==i&&(e='<h5 style="margin: 75px 75px 10px 75px;font-weight: bold;">Old Assignments</h5>'),i="old"):i="upcoming":(i&&"undated"!==i&&(e='<h5 style="margin: 75px 75px 10px 75px;font-weight: bold;">Undated Assignments</h5>'),i="undated"),e+dtps.renderAssignment(s)})).join("");l=dtps.renderClassTools(n,"stream",t)+l,dtps.selectedClass==n&&"stream"==dtps.selectedContent&&$(".classContent").html(l)}else dtps.selectedClass==n&&"stream"==dtps.selectedContent&&jQuery(".classContent").html(dtps.renderClassTools(n,"stream",t)+'<div class="spinner"></div>')},dtps.assignment=function(s,e){var t=dtps.classes[e].assignments.map((s=>s.id)),n=dtps.classes[e].assignments[t.indexOf(s)],a=null;if(n.body){var i=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards"),l=getComputedStyle($(".card.details")[0]).getPropertyValue("--text"),d=n.body;$("body").hasClass("dark")&&(d=dtps.brightenTextForDarkMode(n.body,i));var r=!1;if(d.toLowerCase().includes("deliverable")&&d.toLowerCase().includes("instruction")&&d.toLowerCase().includes("look for")&&(r=!0),dtps.remoteConfig.dtechCleanUpAssignments&&"false"!==fluid.get("pref-formatAssignmentContent")&&dtpsLMS.dtech&&r&&$("<div></div>").append(d).children("table").find("tbody tr").length>1){var o=[];$("<div></div>").append(d).children("table").find("tbody tr").toArray().forEach(((s,e)=>{var t=$(s).find("h4:first-child").text().toLowerCase();if(t){var n=$(s);n.find("h4:first-child").remove();var a=n.html();if(a){var i=null;t.includes("deliverable")&&(i="description",t="Deliverables"),t.includes("instruction")&&(i="assignment",t="Instructions"),t.includes("look for")&&(i="find_in_page",t="Look Fors"),o.push({text:t,icon:i,innerHTML:a})}}}));var c=$("<div></div>").append(d);c.children("table").replaceWith(o.map((s=>`\n                    <div class="dtpsFormattedAssignmentSection" style="margin: 20px 0px;">\n                        <h2><i style="vertical-align: middle; margin-right: 10px; font-size: 24px;" class="material-icons-outlined">${s.icon}</i><span style="vertical-align: middle;text-decoration: underline;">${s.text}</span></h2>\n                        ${s.innerHTML}\n                    </div>\n                `)).join(""));var p=c.html(),m=new Blob([`\n                    <base target="_blank" /> \n                    <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">\n                    <style>body {background-color: ${i}; color: ${l};} .dtpsFormattedAssignmentSection *:not(a) { color: ${l} !important; } .dtpsFormattedAssignmentSection * { background: none !important; }</style>\n                    ${p}\n            `],{type:"text/html"});a=`<iframe id="assignmentParts" onload="dtps.iframeLoad('assignmentParts')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${window.URL.createObjectURL(m)}" />`}else{m=new Blob([`\n                <base target="_blank" /> \n                <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                <style>body {background-color: ${i}; color: ${l};}</style>\n                ${d}\n            `],{type:"text/html"});a=`<iframe id="assignmentIframe" onload="dtps.iframeLoad('assignmentIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${window.URL.createObjectURL(m)}" />`}}var u="";if(n.rubric)u=n.rubric.map((function(s){return`\n                    <div class="dtpsAssignmentRubricItem">\n                        <h5>${s.title}</h5>\n                        <div class="score">\n                            <p style="color: ${s.color?s.color:"var(--secText)"};" class="scoreName">\n                                ${s.score?s.scoreName||"":"Not assessed"}\n\n                                <div class="points">\n                                    <p class="earned">${s.score||"-"}</p>\n                                    <p class="possible">${"/"+s.value}</p>\n                                </div>\n                            </p>\n                        </div>\n                    </div>\n                `})).join("");var g="";if(n.feedback)g=n.feedback.map((s=>`\n                    <div class="dtpsSubmissionComment">\n                        ${s.author?`\n                            <img src="${s.author.photoURL}" />\n                            <h5>${s.author.name}</h5>\n                        `:""}\n\n                        <p>${s.comment}</p>\n                    </div>\n                `)).join("");var v=dtps.renderAssignmentScore(n);$(".card.details").html(`\n            <i onclick="fluid.cards.close('.card.details'); $('.card.details').html('');" class="material-icons close">close</i>\n\n            <h4 style="font-weight: bold;">${n.title}</h4>\n\n            <div>\n                ${n.dueAt?`<div class="assignmentChip"><i class="material-icons">alarm</i><span>Due ${dtps.formatDate(n.dueAt)}</span></div>`:""}\n                ${n.turnedIn?'<div title="Assignment submitted" class="assignmentChip" style="color: #0bb75b"><i class="material-icons">assignment_turned_in</i></div>':""}\n                ${n.missing?'<div  title="Assignment is missing" class="assignmentChip" style="color: #c44848"><i class="material-icons">remove_circle_outline</i></div>':""}\n                ${n.late?'<div title="Assignment is late" class="assignmentChip" style="color: #c44848"><i class="material-icons">assignment_late</i></div>':""}\n                ${n.locked?'<div title="Assignment submissions are locked" class="assignmentChip" style="color: var(--secText, gray);"><i style="font-family: \'Material Icons Extended\';" class="material-icons">lock_outline</i></div>':""}\n                ${v}\n            </div>\n\n            <div style="margin-top: 20px;" class="assignmentBody">\n                ${n.body?a:""}\n            </div>\n\n            ${n.body?'<div style="margin: 5px 0px; background-color: var(--darker); height: 1px; width: 100%;" class="divider"></div>':""}\n\n            <div style="width: calc(40% - 2px); margin-top: 20px; display: inline-block; overflow: hidden; vertical-align: top;">\n                ${n.publishedAt?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">add_box</i> Published: ${dtps.formatDate(n.publishedAt)}</p>`:""}\n                ${n.dueAt?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">alarm</i> Due: ${dtps.formatDate(n.dueAt)}</p>`:""}\n                ${n.value?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">bar_chart</i> Point value: ${n.value}</p>`:""}\n                ${n.grade||0==n.grade?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">assessment</i> Points earned: ${n.grade}</p>`:""}\n                ${n.letter?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">font_download</i> Letter grade: ${n.letter}</p>`:""}\n                ${n.category?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">category</i> Category: ${n.category}</p>`:""}\n                ${n.rubric?n.rubric.map((function(s){return`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">adjust</i> ${s.title}</p>`})).join(""):""}\n                <p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">class</i> Class: ${dtps.classes[n.class].subject}</p>\n                ${"dev"==dtps.env?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">code</i> Assignment ID: ${n.id}</p>`:""}\n\n                <br />\n                <div class="row">\n                    ${n.url?`<div class="btn small outline" onclick="window.open('${n.url}')"><i class="material-icons">open_in_new</i> Open in ${dtpsLMS.shortName||dtpsLMS.name}</div>`:""}\n                </div>\n            </div>\n\n            <div style="width: calc(60% - 7px); margin-top: 20px; margin-left: 5px; display: inline-block; overflow: hidden; vertical-align: middle;">\n                ${g}\n\n                ${u}\n            </div>\n        `),fluid.cards.close(".card.focus"),fluid.modal(".card.details")},dtps.search=function(){if(""==$("input.search").val())fluid.screen();else{var s=$("input.search").val(),e=new Fuse(dtps.classes[dtps.selectedClass].assignments,{keys:["title","body"]});dtps.classStream(dtps.classes[dtps.selectedClass].id,e.search(s),s)}},dtps.moduleStream=function(s){var e=dtps.classes.map((s=>s.id)).indexOf(s);dtps.selectedClass=e,dtps.selectedContent="moduleStream",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.stream").addClass("active"),dtps.presentClass(e),dtps.showClasses(),-1==e&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.moduleStream"),dtps.selectedClass==e&&"moduleStream"==dtps.selectedContent&&jQuery(".classContent").html(dtps.renderClassTools(e,"modules")+'<div class="spinner"></div>'),new Promise((s=>{dtps.classes[e].modules&&!0!==dtps.classes[e].modules?s(dtps.classes[e].modules):dtpsLMS.fetchModules(dtps.classes[e].id).then((e=>s(e)))})).then((t=>{dtps.classes[e].modules=t;var n=dtps.renderClassTools(e,"modules");t.forEach((t=>{var a="";t.items.forEach((t=>{var n="list";"assignment"==t.type&&(n="assignment"),"page"==t.type&&(n="insert_drive_file"),"discussion"==t.type&&(n="forum"),"url"==t.type&&(n="open_in_new"),"header"==t.type&&(n="format_size"),"embed"==t.type&&(n="web");var i="";"assignment"==t.type&&(i="dtps.assignment('"+t.id+"', "+e+")"),"page"==t.type&&(i="fluid.screen('pages', '"+s+"|"+t.id+"|true')"),"discussion"==t.type&&(i="fluid.screen('discussions', '"+s+"|"+t.id+"|true')"),"url"==t.type&&(i="window.open('"+t.url+"')"),"header"==t.type&&(i=""),"embed"==t.type&&(i="dtps.showIFrameCard('"+t.url+"')"),"header"==t.type?a+=`<h5 style="font-size: 22px;padding: 2px 10px;">${t.title}</h5>`:a+=`\n                        <div class="moduleItem" onclick="${i}" style="margin-left: ${15*t.indent}px;">\n                            <i ${t.completed?'style="color: #27ba3c"':""} class="material-icons">${t.completed?"check":n}</i>\n                            ${t.title}\n                        </div>\n                    `})),n+=`\n                <div class="module card ${t.collapsed?"collapsed":""}">\n                    <h4>\n                        <i onclick="dtps.moduleCollapse(this, '${dtps.classes[e].id}', '${t.id}');" \n                            class="material-icons collapseIcon">${t.collapsed?"keyboard_arrow_right":"keyboard_arrow_down"}</i>\n                        ${t.title}\n                    </h4>\n\n                    <div class="moduleContents" style="padding-top: 10px;">\n                        ${a}\n                    </div>\n                </div>\n            `})),0==t.length&&(n+='<div style="cursor: auto;" class="card assignment"><h4>No modules</h4><p>There aren\'t any modules in this class yet</p></div>'),dtps.selectedClass==e&&"moduleStream"==dtps.selectedContent&&jQuery(".classContent").html(n)})).catch((s=>{dtps.error("Could not load modules","Caught promise rejection @ dtps.moduleStream",s)}))},dtps.moduleCollapse=function(s,e,t){$(s).parents(".card").toggleClass("collapsed"),$(s).parents(".card").hasClass("collapsed")?(dtpsLMS.collapseModule&&dtpsLMS.collapseModule(e,t,!0),$(s).html("keyboard_arrow_right")):(dtpsLMS.collapseModule&&dtpsLMS.collapseModule(e,t,!1),$(s).html("keyboard_arrow_down"))},dtps.renderClassTools=function(s,e,t){var n=dtps.classes[s].modules;return`\n        <div style="position: absolute;display:inline-block;margin: ${n?"82px":"38px 82px"};">\n\n            ${dtps.classes[s].teacher?`\n                <div style="background-color: var(--elements); border-radius: 20px; display: inline-block; margin-right: 5px;">\n                    <img src="${dtps.classes[s].teacher.photoURL}" style="width: 40px; height: 40px; border-radius: 50%;vertical-align: middle;"> \n                    <div style="font-size: 16px;display: inline-block;vertical-align: middle;margin: 0px 10px;">${dtps.classes[s].teacher.name}</div>\n                </div>`:""}\n\n            <div onclick="dtps.classInfo(${s})" class="classToolChip">\n                <i style="line-height: 40px;" class="material-icons">${dtps.classes[s].id==dtps.remoteConfig.debugClassID?"bug_report":"info"}</i>\n            </div>\n\n            ${dtps.classes[s].homepage?`\n                <div onclick="dtps.classHome(${s})" class="classToolChip">\n                    <i style="line-height: 40px;" class="material-icons">home</i>\n                </div>`:""}\n\n        ${dtps.classes[s].videoMeetingURL?`\n                <div onclick="window.open('${dtps.classes[s].videoMeetingURL}')" class="classToolChip">\n                    <i style="line-height: 40px;" class="material-icons">videocam</i>\n                </div>`:""}\n\n        </div>\n        \n        ${"modules"==e||"stream"==e?`\n            <div style="text-align: right;${n?"":"margin-top: 20px;"}">\n\n                ${"stream"==e?`<i class="inputIcon material-icons">search</i><input ${t?`value="${t}"`:""} onchange="dtps.search()" class="search inputIcon filled shadow" placeholder="Search assignments" type="search" />`:""}\n\n                <br />\n                ${n?`\n                    <div class="btns row small acrylicMaterial assignmentPicker" style="margin: ${"stream"==e?"20px 80px 20px 0px !important":"63px 80px 20px 0px !important"};">\n                        <button class="btn ${"stream"==e?"active":""}" onclick="fluid.screen('stream', dtps.classes[dtps.selectedClass].id);"><i class="material-icons">assignment</i>Assignments</button>\n                        <button class="btn ${"modules"==e?"active":""}" onclick="fluid.screen('moduleStream', dtps.classes[dtps.selectedClass].id);"><i class="material-icons">view_module</i>Modules</button>\n                    </div>\n                `:""}\n                \n            </div>`:""}\n    `},dtps.classInfo=function(s){if(""!==dtps.classes[s].syllabus&&null!==dtps.classes[s].syllabus)var e=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards"),t=getComputedStyle($(".card.details")[0]).getPropertyValue("--text"),n=new Blob([`\n            <base target="_blank" /> \n            <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n            <style>body {background-color: ${e}; color: ${t};</style>\n            ${dtps.classes[s].syllabus}\n        `],{type:"text/html"}),a=window.URL.createObjectURL(n);$(".card.details").html(`\n        <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n\n        <h4 style="font-weight: bold;">${dtps.classes[s].name}</h4>\n        <p style="color: var(--secText)">${dtps.classes[s].description||""}</p>\n\n        ${dtps.classes[s].numStudents?`<div class="assignmentChip"><i class="material-icons">group</i><span>${dtps.classes[s].numStudents} students</span></div>`:""}\n        ${"dev"==dtps.env?`<div class="assignmentChip"><i class="material-icons">code</i><span>Class ID: ${dtps.classes[s].id}</span></div>`:""}\n        ${dtps.classes[s].id==dtps.remoteConfig.debugClassID?'<div class="assignmentChip"><i class="material-icons">bug_report</i><span>Debug class</span></div>':""}\n    \n        <br />\n\n        <div style="margin-top: 20px;" class="syllabusBody">\n            ${dtps.classes[s].syllabus?`\n                <iframe id="syllabusIframe" onload="dtps.iframeLoad('syllabusIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${a}" />`:""}\n        </div>\n    `),fluid.modal(".card.details")},dtps.classHome=function(s){$(".card.details").html(`\n        <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n        <h4 style="font-weight: bold;">${dtps.classes[s].subject} Homepage</h4>\n\n        <br />\n        <p>Loading...</p>\n    `),dtpsLMS.fetchHomepage(dtps.classes[s].id).then((e=>{if(e){var t=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards"),n=getComputedStyle($(".card.details")[0]).getPropertyValue("--text");if($("body").hasClass("dark")&&(e=dtps.brightenTextForDarkMode(e,t)),dtps.remoteConfig.dtechHomepageFluidUITabs&&$("<div></div>").append(e).find(".enhanceable_content.tabs>ul>li").toArray().length>1){var a=[];$("<div></div>").append(e).find(".enhanceable_content.tabs>ul>li").toArray().forEach((s=>{var i=$(s).text().toLowerCase();if(i){var l=$(s).find("a").attr("href").replace("#","");if(l){var d=$(e).find("#"+l).html();if(d){var r=null;i.includes("agenda")&&(r="format_list_numbered",i="Agenda"),i.includes("instructor")&&(r="person",i="Instructor"),i.includes("course info")&&(r="info",i="Course Info"),i.includes("resources")&&(r="article",i="Course Resources");var o=new Blob([`\n                        <base target="_blank" /> \n                        <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                        <style>body {background-color: ${t}; color: ${n};</style>\n                        ${d}\n                    `],{type:"text/html"}),c=window.URL.createObjectURL(o);a.push({text:i,id:l,icon:r,frameURL:c})}}}})),$(".card.details").html(`\n                    <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n\n                    <h4 style="font-weight: bold;">${dtps.classes[s].subject} Homepage</h4>\n\n                    <br />\n                    ${dtps.classes[s].videoMeetingURL?`<button onclick="window.open('${dtps.classes[s].videoMeetingURL}')" class="btn small"><i class="material-icons">videocam</i> Zoom</button>`:""}\n                    <div class="btns row small">\n                        ${a.map(((s,e)=>`<button onclick="$(this).addClass('active');$(this).siblings().removeClass('active');$('#homepageFragment').attr('src', '${s.frameURL}'); dtps.iframeLoad('homepageFragment');" \n                                style="text-transform: capitalize;" class="btn ${0==e?"active":""}">${s.icon?`<i class="material-icons">${s.icon}</i> `:""}${s.text}</button>`)).join("")}\n                    </div>\n\n                    <br />\n                    <div style="margin-top: 20px;" class="homepageBody">\n                        <iframe id="homepageFragment" onload="dtps.iframeLoad('homepageFragment')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${a[0].frameURL}" />\n                    </div>\n                `)}else{var i=new Blob([`\n                    <base target="_blank" /> \n                    <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                    <style>body {background-color: ${t}; color: ${n};</style>\n                    ${e}\n                `],{type:"text/html"}),l=window.URL.createObjectURL(i);$(".card.details").html(`\n                    <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n\n                    <h4 style="font-weight: bold;">${dtps.classes[s].subject} Homepage</h4>\n\n                    <br />\n                    <div style="margin-top: 20px;" class="homepageBody">\n                        <iframe id="homepageIframe" onload="dtps.iframeLoad('homepageIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${l}" />\n                    </div>\n                `)}fluid.modal(".card.details")}else fluid.cards.close(".card.details"),dtps.error("Homepage unavailable","homepage is either empty or undefined @ dtps.classHome")})).catch((s=>{dtps.error("Couldn't load homepage","Caught a promise rejection @ dtps.classHome",s)}))},dtps.gradebook=function(s){var e=dtps.classes.map((s=>s.id)).indexOf(s);if(dtps.selectedClass=e,dtps.selectedContent="grades",$("#dtpsTabBar .btn").removeClass("active"),$("#dtpsTabBar .btn.grades").addClass("active"),dtps.presentClass(e),dtps.showClasses(),-1==e&&dtps.error("The selected class doesn't exist","classNum check failed @ dtps.gradebook"),dtps.selectedClass==e&&"grades"==dtps.selectedContent&&jQuery(".classContent").html('<div class="spinner"></div>'),dtps.classes[e].letter&&dtps.classes[e].assignments){var t=0,n=0,a=0,i=0,l="";dtps.classes[e].assignments.forEach((s=>{(s.grade||0==s.grade)&&(a+=s.grade,i++,l+=`\n                <div onclick="dtps.assignment('${s.id}', ${e})" class="gradebookAssignment card">\n                    <h5>\n                        ${s.title}\n\n                        <div class="stats">\n                            ${s.letter?`<div class="gradebookLetter">${s.letter}</div>`:""}\n                            <div class="gradebookScore">${s.grade}</div>\n                            <div class="gradebookValue">/${s.value}</div>\n                            <div class="gradebookPercentage">${Math.round(s.grade/s.value*100)}%</div>\n                        </div>\n                    </h5>\n                </div>\n            `),s.value&&(n+=s.value),0==s.grade&&s.value&&t++}));var d=`\n        <div style="--classColor: ${dtps.classes[e].color}" class="card">\n            <h3 class="gradeTitle">\n                Grade Summary\n                <div class="classGradeCircle">\n                    ${dtps.classes[e].grade?`<span class="percentage">${dtps.classes[e].grade}%</span>`:""}\n                    <div class="letter">${dtps.classes[e].letter||""}</div>\n                </div>\n            </h3>\n\n            ${t?`\n                <h5 style="color: #d63d3d;" class="gradeStat">\n                    Zeros\n                    <div style="color: #d63d3d;" class="numFont">${t}</div>\n                </h5>\n            `:""}\n\n            <div style="${dtps.gradebookExpanded?"":"display: none;"}" id="classGradeMore">\n                <br />\n\n                ${dtps.classes[e].previousLetter?`\n                    <h5 class="smallStat">\n                        Previous Grade\n                        <div class="numFont">${dtps.classes[e].previousLetter}</div>\n                    </h5>\n                `:""}\n\n                <h5 class="smallStat">\n                    Points\n                    <div class="numFont fraction">\n                        <span class="earned">${a}</span>\n                        <span class="total">/${n}</span>\n                    </div>\n                </h5>\n\n                <h5 class="smallStat">\n                    Graded Assignments\n                    <div class="numFont">${i}</div>\n                </h5>\n            </div>\n\n            <br />\n            <a onclick="$('#classGradeMore').toggle(); if ($('#classGradeMore').is(':visible')) {$(this).html('Show less'); dtps.gradebookExpanded = true;} else {$(this).html('Show more'); dtps.gradebookExpanded = false;}"\n                style="color: var(--secText, gray); cursor: pointer; margin-right: 10px;">${dtps.gradebookExpanded?"Show less":"Show more"}</a>\n        </div>\n\n        <br />\n    `;dtps.selectedClass==e&&"grades"==dtps.selectedContent&&$(".classContent").html(d+l)}},fluid.externalScreens.dashboard=()=>{dtps.masterStream()},fluid.externalScreens.stream=s=>{dtps.classStream(s)},fluid.externalScreens.moduleStream=s=>{dtps.moduleStream(s)},fluid.externalScreens.gradebook=s=>{dtps.gradebook(s)};
//# sourceMappingURL=/scripts/assignments.js.map