/**
 * @file DTPS assignment functions
 * @author jottocraft
 * 
 * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */
dtps.renderAssignment=function(assignment){var scoreHTML="";if(assignment.rubric){var rubricHTML=[];assignment.rubric.forEach(rubricItem=>{if(rubricItem.score){rubricHTML.push(`\n                    <div title="${rubricItem.title}" style="color: ${rubricItem.color||"var(--text)"};">\n                        ${rubricItem.score}\n                    </div>\n                `)}});scoreHTML=`<div class="dtpsRubricScore">${rubricHTML.join("")}</div>`}var HTML=`\n        <div \n            onclick="${`dtps.assignment('`+assignment.id+`', `+assignment.class+`)`}" \n            class="card graded assignment"\n            style="${"--classColor: "+dtps.classes[assignment.class].color}"\n        >\n\n            \x3c!-- Color bar for the dashboard --\x3e\n            <div class="colorBar"></div>\n\n            \x3c!-- Assignment title and points --\x3e\n            <h4>\n                ${assignment.title}\n\n                \x3c!-- Points display --\x3e\n                <div class="points">\n                    ${scoreHTML}\n                </div>\n            </h4>\n\n            <h5 style="white-space: nowrap; overflow: hidden;">\n                \x3c!-- Assignment info --\x3e\n                ${assignment.dueAt?`<div class="infoChip"><i style="margin-top: -2px;" class="material-icons">alarm</i> Due `+dtps.formatDate(assignment.dueAt)+`</div>`:""}\n                ${assignment.outcomes?`<div class="infoChip weighted"><i class="material-icons">adjust</i>`+assignment.outcomes.length+`</div>`:""}\n                ${assignment.category?`<div class="infoChip weighted"><i class="material-icons">category</i> `+assignment.category+`</div>`:""}\n\n                \x3c!-- Status icons --\x3e\n                ${assignment.turnedIn?`<i title="Assignment submitted" class="material-icons statusIcon" style="color: #0bb75b;">assignment_turned_in</i>`:``}\n                ${assignment.missing?`<i title="Assignment is missing" class="material-icons statusIcon" style="color: #c44848;">remove_circle_outline</i>`:``}\n                ${assignment.late?`<i title="Assignment is late" class="material-icons statusIcon" style="color: #c44848;">assignment_late</i>`:``}\n                ${assignment.locked?`<i title="Assignment submissions are locked" class="material-icons statusIcon" style="font-family: 'Material Icons Extended'; color: var(--secText, gray);">lock_outline</i>`:``}\n                ${assignment.pending?`<i title="Grade is pending review" class="material-icons statusIcon" style="color: #b3b70b;">rate_review</i>`:``}\n            </h5>\n        </div>\n    `;return HTML};dtps.masterStream=function(){dtps.presentClass("dash");dtps.showClasses();var ready=0;dtps.classes.forEach(course=>{if(course.assignments)ready++});var doneLoading=ready==dtps.classes.length;function dashboardContainerHTML(dashboardItem){if(dashboardItem.id=="dtps.calendar"){return $.fullCalendar!==undefined?`<div id="calendar" class="card" style="padding: 20px;"></div>`:""}else if(dashboardItem.id=="dtps.updates"){return`<div class="updatesStream recentlyGraded announcements"></div>`}else if(dashboardItem.id=="dtps.dueToday"){return`<div style="padding: 20px 0px;" class="dueToday"></div>`}else if(dashboardItem.id=="dtps.upcoming"){return`<div style="padding: 20px 0px;" class="assignmentStream"></div>`}}if(dtps.selectedClass=="dash"){jQuery(".classContent").html(`\n            <div class="dash cal" style="width: 40%;display: inline-block; vertical-align: top;">\n                ${dtps.leftDashboard.map(dashboardItem=>dashboardContainerHTML(dashboardItem)).join("")}\n            </div>\n\n            <div style="width: 59%; display: inline-block;" class="dash stream">\n                ${!doneLoading?`<div style="margin: 75px 25px 10px 75px;"><div class="spinner"></div></div>`:""}\n                ${dtps.rightDashboard.map(dashboardItem=>dashboardContainerHTML(dashboardItem)).join("")}\n            </div>\n        `)}dtps.renderUpdates();dtps.renderUpcoming();dtps.calendar();dtps.renderDueToday()};dtps.renderDueToday=function(){var combinedStream=[];if(dtps.classes){dtps.classes.forEach(course=>{if(course.assignments){course.assignments.forEach(assignment=>{if(dtps.isToday(assignment.dueAt)){combinedStream.push(assignment)}})}})}combinedStream.sort((function(a,b){var keyA=new Date(a.dueAt).getTime(),keyB=new Date(b.dueAt).getTime();if(keyA>keyB)return 1;if(keyA<keyB)return-1;return 0}));var combinedHTML=combinedStream.map(assignment=>dtps.renderAssignment(assignment)).join("");if(combinedStream.length==0){combinedHTML=`<p style="text-align: center;margin: 10px 25px 10px 75px; font-size: 18px;"><i class="material-icons">done</i> Nothing due today</p>`}else{combinedHTML=`\n            <h5 style="text-align: center; margin: 10px 25px 10px 75px; font-weight: bold;">Due today</h5>\n        `+combinedHTML}if(dtps.selectedClass=="dash"){jQuery(".classContent .dash .dueToday").html(combinedHTML)}};dtps.renderUpcoming=function(){var combinedStream=[];if(dtps.classes){dtps.classes.forEach(course=>{if(course.assignments){course.assignments.forEach(assignment=>{if(new Date(assignment.dueAt)>new Date&&!dtps.isToday(assignment.dueAt)){combinedStream.push(assignment)}})}})}combinedStream.sort((function(a,b){var keyA=new Date(a.dueAt).getTime(),keyB=new Date(b.dueAt).getTime();if(keyA>keyB)return 1;if(keyA<keyB)return-1;return 0}));var combinedHTML=combinedStream.map(assignment=>dtps.renderAssignment(assignment)).join("");if(combinedStream.length==0){combinedHTML=""}if(dtps.selectedClass=="dash"){jQuery(".classContent .dash .assignmentStream").html(combinedHTML)}};dtps.renderUpdates=function(){};dtps.calendar=function(){if(dtps.selectedClass=="dash"){var calEvents=[];dtps.classes.forEach((course,courseIndex)=>{if(course.assignments){course.assignments.forEach(assignment=>{calEvents.push({title:assignment.title,start:moment(new Date(assignment.dueAt)).toISOString(true),allDay:false,color:course.color,classNum:courseIndex,assignmentID:assignment.id})})}});if($.fullCalendar!==undefined){$("#calendar").fullCalendar({events:calEvents,header:{left:"title",right:"prev,next"},eventClick:function(calEvent,jsEvent,view){dtps.assignment(calEvent.assignmentID,calEvent.classNum)},eventAfterAllRender:function(){$(".fc-prev-button").html(`<i class="material-icons">keyboard_arrow_left</i>`);$(".fc-next-button").html(`<i class="material-icons">keyboard_arrow_right</i>`)}})}$(".fc-prev-button").html(`<i class="material-icons">keyboard_arrow_left</i>`);$(".fc-next-button").html(`<i class="material-icons">keyboard_arrow_right</i>`)}};dtps.classStream=function(classID){var classNum=dtps.classes.map(course=>course.id).indexOf(classID);dtps.selectedClass=classNum;dtps.selectedContent="stream";$("#dtpsTabBar .btn").removeClass("active");$("#dtpsTabBar .btn.stream").addClass("active");dtps.presentClass(classNum);dtps.showClasses();if(classNum==-1){dtps.error("The selected class doesn't exist","classNum check failed @ dtps.classStream")}if(!dtps.classes[dtps.selectedClass].assignments){jQuery(".classContent").html(`<div class="spinner"></div>`)}else if(dtps.classes[dtps.selectedClass].assignments.length==0){$(".classContent").html(`<div style="cursor: auto;" class="card assignment"><h4>No assignments</h4><p>There aren't any assignments in this class yet</p></div>`)}else{dtps.classes[dtps.selectedClass].assignments.sort((function(a,b){var keyA=new Date(a.dueAt).getTime(),keyB=new Date(b.dueAt).getTime();var now=(new Date).getTime();if(!a.dueAt){keyA=0}if(!b.dueAt){keyB=0}if(keyA<now||keyB<now){if(keyA<keyB)return 1;if(keyA>keyB)return-1;return 0}else{if(keyA>keyB)return 1;if(keyA<keyB)return-1;return 0}}));var streamHTML=dtps.classes[dtps.selectedClass].assignments.map(assignment=>dtps.renderAssignment(assignment)).join("");streamHTML=dtps.renderClassTools(classNum,"stream")+streamHTML;$(".classContent").html(streamHTML)}};dtps.assignment=function(id,classNum,submissions){var assignmentIDs=dtps.classes[classNum].assignments.map(assignment=>assignment.id);var assignment=dtps.classes[classNum].assignments[assignmentIDs.indexOf(id)];if(submissions){$(".card.details").css("background-color","white");$(".card.details").css("color","black");$(".card.details").html(`<i style="color: black !important;" onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n            <i style="left: 0; right: auto; color: black !important;" onclick="dtps.assignment(`+id+`, `+classNum+`)" class="material-icons close">arrow_back</i>\n            <br /><br />\n            <iframe style="width: 100%; height: calc(100vh - 175px); border: none;" src="`+assignment.submissions+`"></iframe>\n        `)}else{var assignmentBodyURL=null;if(assignment.body){var computedBackgroundColor=getComputedStyle($(".card.details")[0]).getPropertyValue("--cards");var computedTextColor=getComputedStyle($(".card.details")[0]).getPropertyValue("--text");var blob=new Blob([`\n                <base target="_blank" /> \n                <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n                <style>body {background-color: ${computedBackgroundColor}; color: ${computedTextColor};</style>\n                ${assignment.body}\n            `],{type:"text/html"});assignmentBodyURL=window.URL.createObjectURL(blob)}var assignmentRubricHTML="";if(assignment.rubric){var assignmentRubricHTML=assignment.rubric.map((function(rubricItem){return`\n                    <div class="dtpsAssignmentRubricItem">\n                        <h5>${rubricItem.title}</h5>\n                        <div class="score">\n                            <p style="color: ${rubricItem.color?rubricItem.color:"var(--secText)"};" class="scoreName">\n                                ${rubricItem.score?rubricItem.scoreName||"":"Not assessed"}\n\n                                <div class="points">\n                                    <p class="earned">${rubricItem.score||""}</p>\n                                    <p class="possible">${"/"+rubricItem.value}</p>\n                                </div>\n                            </p>\n                        </div>\n                    </div>\n                `})).join("")}var assignmentFeedbackHTML="";if(assignment.feedback){var assignmentFeedbackHTML=assignment.feedback.map(feedback=>`\n                    <div class="dtpsSubmissionComment">\n                        ${feedback.author?`\n                            <img src="${feedback.author.photoURL}" />\n                            <h5>${feedback.author.name}</h5>\n                        `:``}\n\n                        <p>${feedback.comment}</p>\n                    </div>\n                `).join("")}var scoreHTML="";if(assignment.rubric){var rubricHTML=[];assignment.rubric.forEach(rubricItem=>{if(rubricItem.score){rubricHTML.push(`\n                    <div class="assignmentChip" title="${rubricItem.title}" style="color: ${rubricItem.color||"var(--text)"}; font-weight: bold;">\n                        ${rubricItem.score}\n                    </div>\n                `)}});scoreHTML=rubricHTML.join("")}$(".card.details").html(`\n            <i onclick="fluid.cards.close('.card.details'); $('.card.details').html('');" class="material-icons close">close</i>\n\n            <h4 style="font-weight: bold;">${assignment.title}</h4>\n\n            <div>\n                ${assignment.dueAt?`<div class="assignmentChip"><i class="material-icons">alarm</i><span>Due ${dtps.formatDate(assignment.dueAt)}</span></div>`:""}\n                ${assignment.turnedIn?`<div title="Assignment submitted" class="assignmentChip" style="color: #0bb75b"><i class="material-icons">assignment_turned_in</i></div>`:""}\n                ${assignment.missing?`<div  title="Assignment is missing" class="assignmentChip" style="color: #c44848"><i class="material-icons">remove_circle_outline</i></div>`:""}\n                ${assignment.late?`<div title="Assignment is late" class="assignmentChip" style="color: #c44848"><i class="material-icons">assignment_late</i></div>`:""}\n                ${assignment.locked?`<div title="Assignment submissions are locked" class="assignmentChip" style="color: var(--secText, gray);"><i style="font-family: 'Material Icons Extended';" class="material-icons">lock_outline</i></div>`:""}\n                ${scoreHTML}\n            </div>\n\n            <div style="margin-top: 20px;" class="assignmentBody">\n                ${assignment.body?`<iframe id="assignmentIframe" onload="dtps.iframeLoad('assignmentIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${assignmentBodyURL}" />`:""}\n            </div>\n\n            ${assignment.body?`<div style="margin: 5px 0px; background-color: var(--darker); height: 1px; width: 100%;" class="divider"></div>`:""}\n\n            <div style="width: calc(40% - 2px); margin-top: 20px; display: inline-block; overflow: hidden; vertical-align: top;">\n                ${assignment.publishedAt?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">add_box</i> Published: ${dtps.formatDate(assignment.publishedAt)}</p>`:""}\n                ${assignment.dueAt?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">alarm</i> Due: ${dtps.formatDate(assignment.dueAt)}</p>`:""}\n                ${assignment.value?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">bar_chart</i> Point value: ${assignment.value}</p>`:""}\n                ${assignment.grade?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">assessment</i> Points earned: ${assignment.grade}</p>`:""}\n                ${assignment.letter?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">font_download</i> Letter grade: ${assignment.letter}</p>`:""}\n                ${assignment.category?`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">category</i> Category: ${assignment.category}</p>`:""}\n                ${assignment.rubric?assignment.rubric.map((function(rubricItem){return`<p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">adjust</i> ${rubricItem.title}</p>`})).join(""):""}\n                <p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">class</i> Class: ${dtps.classes[assignment.class].subject}</p>\n                <p style="color: var(--secText); margin: 5px 0px;"><i style="vertical-align: middle;" class="material-icons">bug_report</i> Assignment ID: ${assignment.id}</p>\n\n                <br />\n                <div class="row">\n                    <div class="btn small outline" onclick="dtps.assignment('${assignment.id}', ${classNum}, true)"><i class="material-icons">assignment</i> Submissions</div>\n                    <div class="btn small outline" onclick="window.open('${assignment.url}')"><i class="material-icons">open_in_new</i> Open in ${dtpsLMS.shortName||dtpsLMS.name}</div>\n                </div>\n            </div>\n\n            <div style="width: calc(60% - 7px); margin-top: 20px; margin-left: 5px; display: inline-block; overflow: hidden; vertical-align: middle;">\n                ${assignmentFeedbackHTML}\n\n                ${assignmentRubricHTML}\n            </div>\n        `)}fluid.cards.close(".card.focus");fluid.modal(".card.details")};dtps.search=function(){alert("This feature has not been implemented yet");throw"DTPS v3 IMPLEMENTATION ERR";if(dtps.selectedClass=="dash"){if($("input.search").val()==""){jQuery(".classContent .stream").html(dtps.renderStream(dtps.latestStream,""))}else{jQuery(".classContent .stream").html(dtps.renderStream(dtps.fuse.search($("input.search").val()),$("input.search").val()))}$(".card.assignment").addClass("color")}else{if($("input.search").val()==""){jQuery(".classContent").html(dtps.renderStream(dtps.latestStream,""))}else{jQuery(".classContent").html(dtps.renderStream(dtps.fuse.search($("input.search").val()),$("input.search").val()))}}};dtps.moduleStream=function(num){alert("This feature has not been implemented yet");throw"DTPS v3 IMPLEMENTATION ERR";dtps.selectedContent="moduleStream";var moduleRootHTML=dtps.renderClassTools(num,false,true);if(dtps.selectedContent=="moduleStream")jQuery(".classContent").html(moduleRootHTML+`<div class="spinner"></div>`);streamData=[];dtps.webReq("canvas","/api/v1/courses/"+dtps.classes[num].id+"/modules?include[]=items&include[]=content_details",(function(resp){dtps.webReq("canvas","/courses/"+dtps.classes[num].id+"/modules/progressions",(function(progResp){var data=JSON.parse(resp);var progData=JSON.parse(progResp);var collapsed={};for(var i=0;i<progData.length;i++){collapsed[progData[i].context_module_progression.context_module_id]=progData[i].context_module_progression.collapsed}for(var i=0;i<data.length;i++){var subsetData=[];for(var ii=0;ii<data[i].items.length;ii++){var icon="star_border";if(data[i].items[ii].type=="ExternalTool")icon="insert_link";if(data[i].items[ii].type=="ExternalUrl")icon="open_in_new";if(data[i].items[ii].type=="Assignment")icon="assignment";if(data[i].items[ii].type=="Page")icon="insert_drive_file";if(data[i].items[ii].type=="Discussion")icon="forum";if(data[i].items[ii].type=="Quiz")icon="assessment";if(data[i].items[ii].type=="SubHeader")icon="format_size";var open=`window.open('`+data[i].items[ii].html_url+`')`;if(data[i].items[ii].type=="ExternalTool")open=`$('#moduleIFrame').attr('src', ''); fluid.cards('.card.moduleURL'); $.getJSON('`+data[i].items[ii].url+`', function (data) { $('#moduleIFrame').attr('src', data.url); });`;if(data[i].items[ii].type=="Assignment")open=`dtps.assignment(`+data[i].items[ii].content_id+`, dtps.selectedClass);`;if(data[i].items[ii].type=="Page")open=`dtps.getPage(dtps.classes[dtps.selectedClass].id, '`+data[i].items[ii].page_url+`', true)`;if(data[i].items[ii].type=="SubHeader"){subsetData.push(`<h5 style="font-size: 22px;padding: 2px 10px;">`+data[i].items[ii].title+`</h5>`)}else{subsetData.push(`<div onclick="`+open+`" style="color: var(--lightText); padding:10px;font-size:17px;border-radius:15px;margin:5px 0;margin-left: `+data[i].items[ii].indent*15+`px; cursor: pointer;">\n<i class="material-icons" style="vertical-align: middle; margin-right: 10px;">`+icon+`</i>`+data[i].items[ii].title+`</div>`)}}streamData.push(`<div class="card `+(collapsed[data[i].id]?"collapsed":"")+`">\n<h4 style="margin: 5px 2px; font-size: 32px; font-weight: bold;">\n<i onclick="dtps.moduleCollapse(this, '`+dtps.classes[num].id+`', '`+data[i].id+`');" style="cursor: pointer; vertical-align: middle; color:var(--lightText);" class="material-icons collapseIcon">`+(collapsed[data[i].id]?"keyboard_arrow_right":"keyboard_arrow_down")+`</i>\n`+data[i].name+`</h4>\n<div class="moduleContents" style="padding-top: 10px;">\n`+subsetData.join("")+`\n</div>\n</div>`)}if(dtps.selectedContent=="moduleStream")jQuery(".classContent").html(moduleRootHTML+streamData.join(""))}))}))};dtps.moduleCollapse=function(ele,classID,modID){alert("This feature has not been implemented yet");throw"DTPS v3 IMPLEMENTATION ERR";$(ele).parents(".card").toggleClass("collapsed");if($(ele).parents(".card").hasClass("collapsed")){dtps.webReq("canCOLLAPSE","/courses/"+classID+"/modules/"+modID+"/collapse",undefined,{collapse:1,forceLoad:true});$(ele).html("keyboard_arrow_right")}else{dtps.webReq("canCOLLAPSE","/courses/"+classID+"/modules/"+modID+"/collapse",undefined,{collapse:0,forceLoad:true});$(ele).html("keyboard_arrow_down")}};dtps.renderClassTools=function(num,type,modulesSelector){return`\n        <div style="position: absolute;display:inline-block;margin: ${modulesSelector?"82px":"38px 82px"};">\n\n            ${dtps.classes[num].teacher?`\n                <div class="acrylicMaterial" style="border-radius: 20px; display: inline-block; margin-right: 5px;">\n                    <img src="${dtps.classes[num].teacher.photoURL}" style="width: 40px; height: 40px; border-radius: 50%;vertical-align: middle;"> \n                    <div style="font-size: 16px;display: inline-block;vertical-align: middle;margin: 0px 10px;">${dtps.classes[num].teacher.name}</div>\n                </div>`:``}\n\n            <div onclick="dtps.classInfo(${num})" class="acrylicMaterial" style="border-radius: 50%; height: 40px; width: 40px; text-align: center; display: inline-block; vertical-align: middle; cursor: pointer; margin-right: 3px;">\n                <i style="line-height: 40px;" class="material-icons">info</i>\n            </div>\n\n            ${dtps.classes[num].defaultView=="wiki"?`\n                <div onclick="dtps.classHome(${num})" class="acrylicMaterial" style="border-radius: 50%; height: 40px; width: 40px; text-align: center; display: inline-block; vertical-align: middle; cursor: pointer;">\n                    <i style="line-height: 40px;" class="material-icons">home</i>\n                </div>`:""}\n\n        </div>\n        \n        ${type=="modules"||type=="stream"?`\n            <div style="text-align: right;${modulesSelector?"":"margin-top: 20px;"}">\n\n                ${type=="stream"?`<i class="inputIcon material-icons">search</i><input onchange="dtps.search()" class="search inputIcon filled shadow" placeholder="Search assignments" type="search" />`:""}\n\n                <br />\n                ${modulesSelector?`\n                    <div class="btns row small acrylicMaterial assignmentPicker" style="margin: ${type=="stream"?`20px 80px 20px 0px !important`:`63px 80px 20px 0px !important`};">\n                        <button class="btn ${type=="stream"?"active":""}" onclick="dtps.classStream(dtps.selectedClass);"><i class="material-icons">assignment</i>Assignments</button>\n                        <button class="btn ${type=="modules"?"active":""}" onclick="dtps.moduleStream(dtps.selectedClass);"><i class="material-icons">view_module</i>Modules</button>\n                    </div>\n                `:``}\n                \n            </div>`:``}\n    `};dtps.classInfo=function(num){if(dtps.classes[num].syllabus!==""&&dtps.classes[num].syllabus!==null){var blob=new Blob([`<base target="_blank" /> <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n    <style>body {background-color: `+getComputedStyle($(".card.details")[0]).getPropertyValue("--cards")+`; color: `+getComputedStyle($(".card.details")[0]).getPropertyValue("--text")+`}</style>`+dtps.classes[num].syllabus],{type:"text/html"});var newurl=window.URL.createObjectURL(blob)}$(".card.details").html(`<i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n    <h4 style="font-weight: bold;">`+dtps.classes[num].name+`</h4>\n    <p style="color: var(--secText)">`+(dtps.classes[num].description?dtps.classes[num].description:"")+`</p>\n    <div class="assignmentChip"><i class="material-icons">group</i><span>`+dtps.classes[num].numStudents+` students</span></div>\n    <div class="assignmentChip"><i class="material-icons">bug_report</i><span>Class ID: `+dtps.classes[num].id+`</span></div>\n    `+(dtps.classes[num].favorite?`<div title="Favorited class" class="assignmentChip" style="background-color: #daa520"><i style="color:white;font-family: 'Material Icons Outline'" class="material-icons">star_border</i></div>`:"")+`\n    <br />\n    <div style="margin-top: 20px;" class="syllabusBody">`+(dtps.classes[num].syllabus!==""&&dtps.classes[num].syllabus!==null?`<iframe id="syllabusIframe" onload="dtps.iframeLoad('syllabusIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="`+newurl+`" />`:"")+`</div>\n    `);fluid.modal(".card.details")};dtps.classHome=function(num){$(".card.details").html(`\n        <i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n        <h4 style="font-weight: bold;">${dtps.classes[num].subject} Homepage</h4>\n\n        <br />\n        <p>Loading...</p>\n    `);dtps.webReq("canvas","/api/v1/courses/"+dtps.classes[num].id+"/front_page",(function(resp){var data=JSON.parse(resp);if(!data.message){var blob=new Blob([`<base target="_blank" /> <link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>\n        <style>body {background-color: `+getComputedStyle($(".card.details")[0]).getPropertyValue("--cards")+`; color: `+getComputedStyle($(".card.details")[0]).getPropertyValue("--text")+`}</style>`+data.body],{type:"text/html"});var newurl=window.URL.createObjectURL(blob);$(".card.details").html(`<i onclick="fluid.cards.close('.card.details')" class="material-icons close">close</i>\n        <h4 style="font-weight: bold;">`+data.title+`</h4>\n        <br />\n        <div style="margin-top: 20px;" class="homepageBody"><iframe id="homepageIframe" onload="dtps.iframeLoad('homepageIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="`+newurl+`" /></div>\n        `);fluid.modal(".card.details")}else{alert("Error: No homepage found for this class");fluid.cards.close(".card.details")}}))};fluid.externalScreens.dashboard=()=>{dtps.masterStream()};fluid.externalScreens.stream=courseID=>{dtps.classStream(courseID)};