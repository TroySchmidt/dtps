{"version":3,"sources":["scripts/pages-discussions.js"],"names":["dtps","loadThreadsList","courseID","defaultThread","classNum","classes","map","course","id","indexOf","selectedClass","selectedContent","$","removeClass","addClass","error","presentClass","jQuery","html","dtpsLMS","fetchDiscussionThreads","then","threadData","discussions","length","discussionHTML","discussionThread","title","locked","join","newDiscussionThreadURL","loadThreadPosts","click","event","this","siblings","postID","attr","catch","err","threadID","thread","forEach","fetchDiscussionPosts","postData","posts","postHTML","post","index","computedBackgroundColor","getComputedStyle","getPropertyValue","computedTextColor","blob","Blob","body","type","replyHTML","window","URL","createObjectURL","replies","push","reply","depth","author","photoURL","name","replyURL","formatDate","postedAt","requireInitialPost","loadPagesList","defaultPage","fetchPages","pagesData","pages","pageHTML","page","loadPage","pageID","pageCheck","fetchPageContent","pageContentData","content","pageContentURL","updatedAt","fluid","externalScreens","param","split"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\n * @file DTPS pages & discussion functions\n * @author jottocraft\n * \n * @copyright Copyright (c) 2018-2020 jottocraft. All rights reserved.\n * @license GPL-2.0-only\n */\n\n\n/**\n * Renders the discussions list for a class\n * \n * @param {string} courseID The course ID to render discussion threads for\n * @param {string} [defaultThread] The thread to load by default\n */\ndtps.loadThreadsList = function (courseID, defaultThread) {\n    //Get class index and set as selected class\n    var classNum = dtps.classes.map(course => course.id).indexOf(courseID);\n    dtps.selectedClass = classNum;\n\n    //Set discussions as the selected content\n    dtps.selectedContent = \"discuss\";\n    $(\"#dtpsTabBar .btn\").removeClass(\"active\");\n    $(\"#dtpsTabBar .btn.discuss\").addClass(\"active\");\n\n    if (classNum == -1) {\n        //Class does not exist\n        dtps.error(\"The selected class doesn't exist\", \"classNum check failed @ dtps.loadThreadsList\");\n    }\n\n    //Load class color and things\n    dtps.presentClass(classNum);\n    jQuery(\"body\").removeClass(\"collapsedSidebar\");\n\n    if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"discuss\")) {\n        //Render sidebar\n        jQuery(\".sidebar\").html(/*html*/`\n            <div class=\"bigLogo\" style=\"text-align: center; margin: 10px 0 20px; height: 38px;\">\n                <i style=\"font-size: 28px; margin-right: 7px; vertical-align: middle;\" class=\"material-icons\">forum</i>\n                <h4 style=\"color: var(--text); display: inline-block; font-size: 28px; vertical-align: middle; margin: 0px;\">Discussions</h4>\n            </div>\n                        \n            <div class=\"items\">\n                <div class=\"spinner\"></div>\n            </div>\n        `);\n\n        //Delete existing class content HTML\n        jQuery(\".classContent\").html(\"\");\n    }\n\n    //Fetch discussion thread data\n    dtpsLMS.fetchDiscussionThreads(dtps.classes[classNum].id).then(function (threadData) {\n        //Store fetched data to the selected class\n        dtps.classes[classNum].discussions = threadData;\n\n        if (dtps.classes[classNum].discussions.length == 0) {\n            //No discussion topics in this class\n            jQuery(\".sidebar .items\").html(/*html*/`\n                <div onclick=\"fluid.screen('stream', '${dtps.classes[classNum].id}');\" class=\"class item main back\">\n                    <span class=\"label\">Classes</span>\n                    <div class=\"icon\">\n                        <i class=\"material-icons\">keyboard_arrow_left</i>\n                    </div>\n                </div>\n\n                <p style=\"text-align: center; font-weight: bold; margin-top: 60px;\">No discussions found</p>\n                <p style=\"text-align: center; font-size: 14px;\">This class doesn't have any discussions</p>\n            `);\n        } else {\n            //Loop over discusson threads array to create discussion thread HTML for the sidebar\n            var discussionHTML = dtps.classes[classNum].discussions.map(discussionThread => {\n                return /*html*/`\n                    <div data-threadID=\"${discussionThread.id}\" class=\"item\">\n                        <span class=\"label\">${discussionThread.title}</span>\n                        <div class=\"icon\">\n                            <i style=\"font-family: 'Material Icons Extended';\" class=\"material-icons\">${discussionThread.locked ? \"lock_outline\" : \"chat_bubble_outline\"}</i>\n                        </div>\n                    </div>\n                `;\n            }).join(\"\");\n\n            //Render discussion threads in the sidebar\n            if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"discuss\")) {\n                jQuery(\".sidebar .items\").html(/*html*/`\n                    <div onclick=\"fluid.screen('stream', '${dtps.classes[classNum].id}');\" class=\"class item main back\">\n                        <span class=\"label\">Classes</span>\n                        <div class=\"icon\">\n                            <i class=\"material-icons\">keyboard_arrow_left</i>\n                        </div>\n                    </div>\n\n                    ${\n                    dtps.classes[classNum].newDiscussionThreadURL ? (/*html*/`\n                            <div onclick=\"window.open('${dtps.classes[classNum].newDiscussionThreadURL}')\" class=\"class item back\">\n                                <span class=\"label\">New discussion</span>\n                                <div class=\"icon\">\n                                    <i class=\"material-icons\">add</i>\n                                </div>\n                            </div>\n                        `) : \"\"\n                    }\n\n                    <div class=\"divider\"></div>\n\n                    ${discussionHTML}\n                `);\n\n                //Load default thread if provided\n                if (defaultThread) {\n                    dtps.loadThreadPosts(classNum, defaultThread);\n                }\n\n                //Add click event listeners for discussion threads\n                $(\".sidebar .item:not(.back)\").click(function (event) {\n                    //Show the selected thread as active\n                    $(this).siblings().removeClass(\"active\");\n                    $(this).addClass(\"active\");\n\n                    //Get thread ID from HTML attribute\n                    var postID = $(this).attr(\"data-threadID\");\n\n                    //Load the thread\n                    dtps.loadThreadPosts(classNum, postID);\n                });\n            }\n        }\n\n    }).catch(function (err) {\n        dtps.error(\"Couldn't fetch discussion threads\", \"Caught promise rejection @ dtps.loadThreadsList\", err);\n    });\n}\n\n/**\n * Fetches and displays posts in a discussion\n * \n * @param {number} classNum The class number to render\n * @param {string} threadID The discussion thread to render\n */\ndtps.loadThreadPosts = function (classNum, threadID) {\n    //Show loading indicator\n    if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"discuss\")) {\n        jQuery(\".classContent\").html(`<div class=\"spinner\"></div>`);\n    }\n\n    //Get discussion data\n    var thread = null;\n    dtps.classes[classNum].discussions.forEach(discussionThread => {\n        if (discussionThread.id == threadID) {\n            thread = discussionThread;\n        }\n    });\n\n    if (!thread) {\n        dtps.error(\"Thread does not exist\", \"thread is null @ dtps.loadThreadPosts\");\n        throw null;\n    }\n\n    //Fetch discussion posts from the LMS\n    dtpsLMS.fetchDiscussionPosts(dtps.classes[classNum].id, threadID).then(function (postData) {\n        //Store posts in the discussion thread\n        thread.posts = postData;\n\n        //Post HTML array\n        var postHTML = [];\n\n        thread.posts.forEach((post, index) => {\n            //Get background and text color for iFrame content\n            var computedBackgroundColor = getComputedStyle($(\".card.details\")[0]).getPropertyValue(\"--cards\");\n            var computedTextColor = getComputedStyle($(\".card.details\")[0]).getPropertyValue(\"--text\");\n\n            //Create a new blob data URL with the post's content\n            var blob = new Blob([`\n                    <base target=\"_blank\" /> \n                    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdn.jottocraft.com/CanvasCSS.css\" media=\"screen,projection\"/>\n                    <style>body {background-color: ${computedBackgroundColor}; color: ${computedTextColor};</style>\n                    ${post.body}\n                `], { type: 'text/html' });\n            var discussionPostContentURL = window.URL.createObjectURL(blob);\n\n            //Create HTML for replies\n            var replyHTML = [];\n            if (post.replies) {\n                //Add space above replies\n                replyHTML.push(`<br />`);\n\n                //Get HTML for each reply and add to array\n                post.replies.forEach(reply => {\n                    replyHTML.push(/*html*/`\n                        <div style=\"margin-left: ${(reply.depth || 0) * 50}px;\" class=\"discussionReply\">\n                            <div class=\"discussionHeader\">\n                                ${post.author ? /*html*/`\n                                    <img src=\"${reply.author.photoURL}\" />\n                                    <h5>${reply.author.name}</h5>\n                                ` : ``}\n                                \n                                <span style=\"cursor: pointer;\" onclick=\"window.open('${reply.replyURL}')\">\n                                    <i class=\"material-icons\">reply</i>\n                                    <span>Reply</span>\n                                </span>\n                            </div>\n\n                            ${reply.body}\n                        </div>\n                    `)\n                });\n\n                //Add space below replies\n                replyHTML.push(`<br />`);\n            }\n\n            //Create HTML for this post\n            //Note that index == 0 is the initial post\n            postHTML.push(/*html*/`\n                    <div class=\"card\" style=\"margin-top: 20px;${index == 0 ? \"margin-bottom: 75px;\" : \"padding: 20px 30px;\"}\">\n                        <!-- Thread title (Initial post) -->\n                        ${index == 0 ? /*html*/`\n                            <h4 style=\"font-weight: bold\">${thread.title}</h4>\n                        ` : ''}\n\n                        <!-- Author header -->\n                        <div ${index == 0 ? `style=\"margin-bottom: 32px;\"` : \"\"} class=\"discussionHeader\">\n                            ${post.author ? /*html*/`\n                                <img src=\"${post.author.photoURL}\" />\n                                <h5>${post.author.name}</h5>\n                            ` : ``}\n\n                            <i class=\"material-icons\">calendar_today</i>\n                            <span>${dtps.formatDate(post.postedAt)}</span>\n\n                            <!-- Thread info (initial post) -->\n                            ${index == 0 ? /*html*/`\n                                ${thread.locked ? `<i class=\"material-icons\">lock</i>` : \"\"}\n                                ${thread.requireInitialPost ? /*html*/`\n                                    <i class=\"material-icons\">visibility</i>\n                                    <span>You must post before you can see other replies</span>\n                                ` : \"\"}\n                            ` : ''}\n                        </div>\n         \n                        ${post.body}\n\n                        ${replyHTML.join(\"\")}\n\n                        <!-- Reply / Add post footer -->\n                        ${post.replyURL ? /*html*/`\n                            <div ${index == 0 ? `style=\"margin-top: 32px;\"` : \"\"} class=\"discussionFooter\">\n                                ${index == 0 ? /*html*/`\n                                    <button onclick=\"window.open('${post.replyURL}')\" class=\"btn small\"><i class=\"material-icons\">post_add</i> Add Post</button>\n                                ` : /*html*/`\n                                    <button onclick=\"window.open('${post.replyURL}')\" class=\"btn small\"><i class=\"material-icons\">reply</i> Reply</button>\n                                `}\n                            </div> \n                        ` : \"\"}\n                    </div>\n                `);\n        });\n\n        //Render HTML\n        if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"discuss\")) {\n            jQuery(\".classContent\").html(postHTML.join(\"\"));\n        }\n    }).catch(function (err) {\n        dtps.error(\"Could not fetch discussion posts\", \"Caught promise rejection @ dtps.loadThreadPosts\", err);\n    });\n}\n\n/**\n * Renders the pages list for a class\n * \n * @param {string} courseID The course ID to render pages for\n * @param {string} [defaultPage] If provided, load the pageID by default\n */\ndtps.loadPagesList = function (courseID, defaultPage) {\n    //Get class index and set as selected class\n    var classNum = dtps.classes.map(course => course.id).indexOf(courseID);\n    dtps.selectedClass = classNum;\n\n    //Set pages as the selected content\n    dtps.selectedContent = \"pages\";\n    $(\"#dtpsTabBar .btn\").removeClass(\"active\");\n    $(\"#dtpsTabBar .btn.pages\").addClass(\"active\");\n\n    if (classNum == -1) {\n        //Class does not exist\n        dtps.error(\"The selected class doesn't exist\", \"classNum check failed @ dtps.loadPagesList\");\n    }\n\n    //Load class color and things\n    dtps.presentClass(classNum);\n    jQuery(\"body\").removeClass(\"collapsedSidebar\");\n\n    if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"pages\")) {\n        //Render sidebar\n        jQuery(\".sidebar\").html(/*html*/`\n            <div class=\"bigLogo\" style=\"text-align: center; margin: 10px 0 20px; height: 38px;\">\n                <i style=\"font-size: 28px; margin-right: 7px; vertical-align: middle;\" class=\"material-icons\">insert_drive_file</i>\n                <h4 style=\"color: var(--text); display: inline-block; font-size: 28px; vertical-align: middle; margin: 0px;\">Pages</h4>\n            </div>\n                        \n            <div class=\"items\">\n                <div class=\"spinner\"></div>\n            </div>\n        `);\n\n        //Delete existing class content HTML\n        jQuery(\".classContent\").html(\"\");\n    }\n\n    dtpsLMS.fetchPages(dtps.classes[classNum].id).then(function (pagesData) {\n        //Store fetched pages data to the class\n        dtps.classes[classNum].pages = pagesData;\n\n        if (pagesData.length == 0) {\n            //No pages in this class\n            jQuery(\".sidebar .items\").html(/*html*/`\n                <div onclick=\"fluid.screen('stream', '${dtps.classes[classNum].id}');\" class=\"class item main back\">\n                    <span class=\"label\">Classes</span>\n                    <div class=\"icon\">\n                        <i class=\"material-icons\">keyboard_arrow_left</i>\n                    </div>\n                </div>\n\n                <p style=\"text-align: center; font-weight: bold; margin-top: 60px;\">No pages found</p>\n                <p style=\"text-align: center; font-size: 14px;\">This class doesn't have any pages</p>\n            `);\n        } else {\n            //Loop over discusson threads array to create discussion thread HTML for the sidebar\n            var pageHTML = dtps.classes[classNum].pages.map(page => {\n                return /*html*/`\n                    <div data-pageID=\"${page.id}\" class=\"item ${(defaultPage && (page.id == defaultPage)) ? \"active\" : \"\"}\">\n                        <span class=\"label\">${page.title}</span>\n                        <div class=\"icon\">\n                            <i class=\"material-icons\">insert_drive_file</i>\n                        </div>\n                    </div>\n                `;\n            }).join(\"\");\n\n            //Render discussion threads in the sidebar\n            if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"pages\")) {\n                jQuery(\".sidebar .items\").html(/*html*/`\n                    <div onclick=\"fluid.screen('stream', '${dtps.classes[classNum].id}');\" class=\"class item main back\">\n                        <span class=\"label\">Classes</span>\n                        <div class=\"icon\">\n                            <i class=\"material-icons\">keyboard_arrow_left</i>\n                        </div>\n                    </div>\n\n                    <div class=\"divider\"></div>\n\n                    ${pageHTML}\n                `);\n            }\n\n            //Load default page if provided\n            if (defaultPage) {\n                dtps.loadPage(classNum, defaultPage);\n            }\n\n            //Add click event listeners for pages\n            $(\".sidebar .item:not(.back)\").click(function (event) {\n                //Show the selected thread as active\n                $(this).siblings().removeClass(\"active\");\n                $(this).addClass(\"active\");\n\n                //Get page ID from HTML attribute\n                var pageID = $(this).attr(\"data-pageID\");\n\n                //Load the page content\n                dtps.loadPage(classNum, pageID);\n            });\n        }\n    }).catch((err) => {\n        dtps.error(\"Couldn't fetch pages\", \"Caught promise rejection @ dtps.loadPagesList\", err);\n    });\n}\n\n/**\n * Fetches and renders a page and its contents\n * \n * @param {string} classNum The class number of the page to render\n * @param {string} pageID The page ID to render\n */\ndtps.loadPage = function (classNum, pageID) {\n    //Show loading indicator\n    if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"pages\")) {\n        jQuery(\".classContent\").html(`<div class=\"spinner\"></div>`);\n    }\n\n    //Get page data\n    var page = null;\n    dtps.classes[classNum].pages.forEach(pageCheck => {\n        if (pageCheck.id == pageID) {\n            page = pageCheck;\n        }\n    });\n\n    if (!page) {\n        dtps.error(\"Page does not exist\", \"page is null @ dtps.loadPage\");\n        throw null;\n    }\n\n    //Fetch page content\n    dtpsLMS.fetchPageContent(dtps.classes[classNum].id, page.id).then(function (pageContentData) {\n        //Store page content in the page object\n        page.content = pageContentData;\n\n        if ((dtps.selectedClass == classNum) && (dtps.selectedContent == \"pages\")) {\n            //Get computed background and text color to style the iFrame with\n            var computedBackgroundColor = getComputedStyle($(\".card.details\")[0]).getPropertyValue(\"--cards\");\n            var computedTextColor = getComputedStyle($(\".card.details\")[0]).getPropertyValue(\"--text\");\n\n            //Generate a blob with the page content and get its data URL\n            var blob = new Blob([`\n                <base target=\"_blank\" /> \n                <link type=\"text/css\" rel=\"stylesheet\" href=\"https://cdn.jottocraft.com/CanvasCSS.css\" media=\"screen,projection\"/>\n                <style>body {background-color: ${computedBackgroundColor}; color: ${computedTextColor};</style>\n                ${page.content}\n            `], { type: 'text/html' });\n\n            //Get URL from blob\n            var pageContentURL = window.URL.createObjectURL(blob);\n\n            //Render page card in the class content\n            jQuery(\".classContent\").html(/*html*/`\n                <div class=\"card\">\n                    <!-- Page title -->\n                    <h4 style=\"font-weight: bold;\">${page.title}</h4>\n\n                    <!-- Page header -->\n                    <div style=\"margin-bottom: 32px;\" class=\"discussionHeader\">\n                        ${page.author ? /*html*/`\n                            <img src=\"${page.author.photoURL}\" />\n                            <h5>${page.author.name}</h5>\n                        ` : ``}\n\n                        <i class=\"material-icons\">calendar_today</i>\n                        <span>${\"Last Updated \" + dtps.formatDate(page.updatedAt)}</span>\n                    </div>\n\n                    <!-- Page content -->\n                    <br />\n                    <iframe id=\"classPageIframe\" onload=\"dtps.iframeLoad('classPageIframe')\" style=\"margin: 10px 0px; width: 100%; border: none; outline: none;\" src=\"${pageContentURL}\" />\n                </div>\n            `);\n        }\n    }).catch((err) => {\n        dtps.error(\"Couldn't load page\", \"Caught promise rejection @ dtps.loadPage\", err);\n    });\n}\n\n//Fluid UI screen definitions\nfluid.externalScreens.discussions = (param) => {\n    //Split parameter string into variables\n    var courseID = param.split(\"|\")[0];\n    var threadID = param.split(\"|\")[1];\n\n    dtps.loadThreadsList(courseID, threadID);\n}\n\nfluid.externalScreens.pages = (param) => {\n    //Split parameter string into variables\n    var courseID = param.split(\"|\")[0];\n    var pageID = param.split(\"|\")[1];\n\n    dtps.loadPagesList(courseID, pageID);\n}\n\n//Type definitions\n\n/**\n* @typedef {Object} DiscussionThread\n* @description Defines discussion thread objects in DTPS\n* @property {string} title Title of the discussion thread\n* @property {string} id Discussion thread ID\n* @property {DiscussionPost[]} posts Posts in this thread, with the initial one first. Assume that the topic has not been selected and loaded if this is undefined, and that there are no posts if this is an empty array.\n* @property {boolean} [locked] True if posting to the discussion thread is locked\n* @property {boolean} [requireInitialPost] True if the user must post before viewing others' posts\n*/\n\n/**\n* @typedef {Object} DiscussionPost\n* @description Defines discussion post objects in DTPS\n* @property {string} id Discussion post ID\n* @property {string} body Discussion post body HTML\n* @property {Date} postedAt Date for when the post was posted\n* @property {number} [depth] The depth level this post is\n* @property {User} [author] Discussion post author\n* @property {DiscussionPost[]} [replies] Replies to this post. Nested replies (replies to replies) should be after this post in the array with a depth of 1, not in the replies key.\n* @property {string} [replyURL] A URL that the user can visit to reply to this post\n*/\n\n/**\n* @typedef {Object} Page\n* @description Defines Page objects in DTPS\n* @property {string} title Page title\n* @property {string} id Page ID\n* @property {string} content Page content. Assume the page hasn't been selected/loaded if this is undefined.\n* @property {Date} [updatedAt] When the page was last updated\n* @property {User} [author] Page author\n*/"]}