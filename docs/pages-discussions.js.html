<!-- start:source.tmpl.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>pages-discussions.js</title>
		<link rel="icon" type="image/png" href="favicon.png"/>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
			<style>
				.page-header,
				pre.code-toolbar > .toolbar:hover {
					background-color: #c5982f;
				}
				.callout-primary,
				.toc .nav > li > a:hover,
				.toc .nav > li > a:focus,
				.toc .nav > li.active > a,
				.toc .nav > li.active > a:hover,
				.toc .nav > li.active > a:focus,
				pre.code-toolbar > .toolbar:hover {
					border-left-color: #c5982f;
				}
				pre.code-toolbar > .toolbar:hover {
					border-bottom-color: #c5982f;
				}
				.callout-primary h5,
				.symbol-title.collapsible-symbol .toggle-icon,
				.breadcrumb li a,
				.toc .nav > li > a:hover,
				.toc .nav > li > a:focus,
				.toc .nav > li.active > a,
				.toc .nav > li.active > a:hover,
				.toc .nav > li.active > a:focus {
					color: #c5982f;
				}
			</style>
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"Power+ Docs","systemSummary":"Reference documentation for the latest version of Power+","systemLogo":"img/favicon.png","systemColor":"#c5982f","navMembers":[{"kind":"class","title":"Classes","summary":"All documented classes."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"namespace","title":"Namespaces","summary":"All documented namespaces."},{"kind":"tutorial","title":"Tutorials","summary":"All available tutorials."}],"footer":"<img style='height: 32px; margin: 10px 0px;' src='https://cdn.jottocraft.com/images/footerImage.png' />","copyright":"(c) 2018-2021 jottocraft. All rights reserved.","linenums":true,"collapseSymbols":false,"inverseNav":true,"inlineNav":false,"outputSourceFiles":true,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"linenum, longname, version, since","search":true,"favicon":"favicon.png","stylesheets":[],"scripts":[],"monospaceLinks":false,"cleverLinks":false};
			window.DOCLET_TOC_ENABLED = false;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand branding-logo" href="index.html" style="background-image: url(img/favicon.png);">
					Power+ Docs
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="global.html#Announcement">Announcement</a></li>
											<li><a href="global.html#Assignment">Assignment</a></li>
											<li><a href="global.html#AssignmentFeedback">AssignmentFeedback</a></li>
											<li><a href="global.html#Class">Class</a></li>
											<li><a href="global.html#ClassSection">ClassSection</a></li>
											<li><a href="global.html#DashboardItem">DashboardItem</a></li>
											<li><a href="global.html#Date">Date</a></li>
											<li><a href="global.html#DiscussionPost">DiscussionPost</a></li>
											<li><a href="global.html#DiscussionThread">DiscussionThread</a></li>
											<li><a href="global.html#Module">Module</a></li>
											<li><a href="global.html#ModuleItem">ModuleItem</a></li>
											<li><a href="global.html#Page">Page</a></li>
											<li><a href="global.html#PartialDiscussionThread">PartialDiscussionThread</a></li>
											<li><a href="global.html#PartialPage">PartialPage</a></li>
											<li><a href="global.html#RubricItem">RubricItem</a></li>
											<li><a href="global.html#SearchData">SearchData</a></li>
											<li><a href="global.html#User">User</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_namespace.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="dtps.html">dtps</a></li>
											<li><a href="dtpsLMS.html">dtpsLMS</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">source</span>
				<h1><span class="name">pages-discussions.js</span></h1>
			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-12 main-content">
		<section class="source-section">
			<article></article>
			<pre class="prettyprint source language-javascript line-numbers"><code class="language-javascript">/**
 * @file DTPS pages &amp; discussion functions
 * @author jottocraft
 * 
 * @copyright Copyright (c) 2018-2021 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */


/**
 * Renders the discussions list for a class
 * 
 * @param {string} courseID The course ID to render discussion threads for
 * @param {string} [defaultThread] The thread to load by default
 * @param {boolean} [fromModules] True if this page is being loaded from the moduleStream
 * @param {string} [defaultPost] The post to load by default
 */
dtps.loadThreadsList = function (courseID, defaultThread, fromModules, defaultPost) {
    //Get class index and set as selected class
    var classNum = dtps.classes.map(course => course.id).indexOf(courseID);
    dtps.selectedClass = classNum;

    //Set discussions as the selected content
    if (!fromModules) {
        dtps.selectedContent = "discuss";
        $("#dtpsTabBar .btn").removeClass("active");
        $("#dtpsTabBar .btn.discuss").addClass("active");
        jQuery("body").removeClass("collapsedSidebar");
    }

    if (classNum == -1) {
        //Class does not exist
        dtps.error("The selected class doesn't exist", "classNum check failed @ dtps.loadThreadsList");
    }

    //Load class color and things
    dtps.presentClass(classNum);

    //Load module thread
    if (fromModules) {
        dtps.loadThreadPosts(classNum, defaultThread, fromModules, defaultPost);
        return;
    }

    if ((dtps.selectedClass == classNum) &amp;&amp; (dtps.selectedContent == "discuss")) {
        //Render sidebar
        jQuery(".sidebar").html(/*html*/`
            &lt;div class="title">
                &lt;i style="font-size: 28px; margin-right: 7px; vertical-align: middle;" class="fluid-icon">forum&lt;/i>
               &lt;h4>Discussions&lt;/h4>
             &lt;/div>
                        
            &lt;div class="items">
                &lt;div onclick="fluid.screen('stream', '${dtps.classes[classNum].id}');" class="item main back">
                    &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i> &lt;span class="label">Classes&lt;/span>
                &lt;/div>

                &lt;div class="divider">&lt;/div>

                &lt;div class="item shimmerParent">
                    &lt;i class="fluid-icon">star&lt;/i>
                    &lt;span class="label">Discussion thread Title&lt;/span>
                &lt;/div>
                &lt;div class="item shimmerParent">
                    &lt;i class="fluid-icon">star&lt;/i>
                    &lt;span class="label">Discussion thread Title&lt;/span>
                &lt;/div>
                &lt;div class="item shimmerParent">
                    &lt;i class="fluid-icon">star&lt;/i>
                    &lt;span class="label">Discussion thread Title&lt;/span>
                &lt;/div>
            &lt;/div>
        `);

        //Delete existing class content HTML
        jQuery(".classContent").html("");
    }

    //Fetch discussion thread data
    dtpsLMS.fetchDiscussionThreads(dtps.classes[classNum].lmsID).then(function (threadData) {
        //Store fetched data to the selected class
        dtps.classes[classNum].discussions = threadData;

        if (dtps.classes[classNum].discussions.length == 0) {
            //No discussion topics in this class
            jQuery(".sidebar .items").html(/*html*/`
                &lt;div onclick="fluid.screen('stream', '${dtps.classes[classNum].id}');" class="item main back">
                    &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i> &lt;span class="label">Classes&lt;/span>
                &lt;/div>

                &lt;p style="text-align: center; font-weight: bold; margin-top: 60px; margin-bottom: 10px;">No discussions found&lt;/p>
                &lt;p style="text-align: center; font-size: 14px; margin: 0px;">This class doesn't have any discussions&lt;/p>
            `);
        } else {
            //Loop over discusson threads array to create discussion thread HTML for the sidebar
            var discussionHTML = dtps.classes[classNum].discussions.map(discussionThread => {
                return /*html*/`
                    &lt;div data-threadID="${discussionThread.id}" class="item">
                        &lt;i class="fluid-icon">${discussionThread.locked ? "lock_outline" : "chat_bubble_outline"}&lt;/i>
                        &lt;span class="label">${discussionThread.title}&lt;/span>
                    &lt;/div>
                `;
            }).join("");

            //Render discussion threads in the sidebar
            if ((dtps.selectedClass == classNum) &amp;&amp; (dtps.selectedContent == "discuss")) {
                jQuery(".sidebar .items").html(/*html*/`
                &lt;div onclick="fluid.screen('stream', '${dtps.classes[classNum].id}');" class="item main back">
                    &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i> &lt;span class="label">Classes&lt;/span>
                &lt;/div>

                    ${
                    dtps.classes[classNum].newDiscussionThreadURL ? (/*html*/`
                            &lt;div onclick="window.open('${dtps.classes[classNum].newDiscussionThreadURL}')" class="item back">
                                &lt;i class="fluid-icon">add&lt;/i>
                                &lt;span class="label">New discussion&lt;/span>
                            &lt;/div>
                        `) : ""
                    }

                    &lt;div class="divider">&lt;/div>

                    ${discussionHTML}
                `);

                //Load default thread if provided
                if (defaultThread) {
                    dtps.loadThreadPosts(classNum, defaultThread, fromModules, defaultPost);
                }

                //Add click event listeners for discussion threads
                $(".sidebar .item:not(.back)").click(function (event) {
                    //Show the selected thread as active
                    $(this).siblings().removeClass("active");
                    $(this).addClass("active");

                    //Get thread ID from HTML attribute
                    var postID = $(this).attr("data-threadID");

                    //Load the thread
                    dtps.loadThreadPosts(classNum, postID);
                });
            }
        }

    }).catch(function (err) {
        dtps.error("Couldn't fetch discussion threads", "Caught promise rejection @ dtps.loadThreadsList", err);
    });
}

/**
 * Fetches and displays posts in a discussion
 * 
 * @param {number} classNum The class number to render
 * @param {string} threadID The discussion thread to render
 * @param {boolean} [fromModules] True if this page is being loaded from the moduleStream
 * @param {string} [defaultPost] The post ID to jump to
 */
dtps.loadThreadPosts = function (classNum, threadID, fromModules, defaultPost) {
    //Show loading indicator
    if ((dtps.selectedClass == classNum) &amp;&amp; ((dtps.selectedContent == "discuss") || fromModules)) {
        jQuery(".classContent").html(/*html*/`
            &lt;div class="card" style="margin-top: 20px;margin-bottom: 75px;">
                &lt;h4>&lt;span class="shimmer">[SHIMMER] Thread Title&lt;/span>&lt;/h4>

                &lt;div style="margin-bottom: 32px;" class="discussionHeader">
                    &lt;h5 >&lt;span class="shimmer">Discussion author name&lt;/span>&lt;/h5>

                    &lt;i class="fluid-icon shimmer">calendar_today&lt;/i>
                    &lt;span class="shimmer">Discussion date&lt;/span>
                &lt;/div>

                &lt;div class="shimmer" style="margin: 10px 0px; width: 100%; height: 400px; border: none; outline: none;">&lt;/div>

                &lt;div style="margin-top: 32px;" class="discussionFooter">
                    &lt;button class="btn small shimmer">&lt;i class="fluid-icon">post_add&lt;/i> Add Post&lt;/button>
                &lt;/div> 
            &lt;/div>
        `);
    }

    //Fetch discussion posts from the LMS
    dtpsLMS.fetchDiscussionPosts(dtps.classes[classNum].lmsID, threadID).then(function (thread) {
        //Post HTML array
        var postHTML = [];

        thread.posts.forEach((post, index) => {
            //Get background and text color for iFrame content
            var computedBackgroundColor = getComputedStyle($(".card.details")[0]).getPropertyValue("--cards");
            var computedTextColor = getComputedStyle($(".card.details")[0]).getPropertyValue("--text");

            //Create a new blob data URL with the post's content
            var blob = new Blob([`
                    &lt;base target="_blank" /> 
                    &lt;link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>
                    &lt;style>body {background-color: ${computedBackgroundColor}; color: ${computedTextColor};&lt;/style>
                    ${post.body}
                `], { type: 'text/html' });
            var discussionPostContentURL = window.URL.createObjectURL(blob);

            //Create HTML for replies
            var replyHTML = [];
            if (post.replies) {
                //Add space above replies
                replyHTML.push(`&lt;br />`);

                //Get HTML for each reply and add to array
                post.replies.forEach(reply => {
                    replyHTML.push(/*html*/`
                        &lt;div data-post-id="${reply.id}" style="margin-left: ${(reply.depth || 0) * 50}px;" class="discussionReply">
                            &lt;div class="discussionHeader">
                                ${post.author ? /*html*/`
                                    &lt;img src="${reply.author.photoURL}" />
                                    &lt;h5>${reply.author.name}&lt;/h5>
                                ` : ``}
                                
                                &lt;span style="cursor: pointer;" onclick="window.open('${reply.replyURL}')">
                                    &lt;i class="fluid-icon">reply&lt;/i>
                                    &lt;span>Reply&lt;/span>
                                &lt;/span>
                            &lt;/div>

                            ${reply.body}
                        &lt;/div>
                    `)
                });

                //Add space below replies
                replyHTML.push(`&lt;br />`);
            }

            //Create HTML for this post
            //Note that index == 0 is the initial post
            postHTML.push(/*html*/`
                    &lt;div class="card" data-post-id="${post.id}" style="margin-top: 20px;${index == 0 ? "margin-bottom: 75px;" : "padding: 20px 30px;"}">
                        &lt;!-- Thread title (Initial post) -->
                        ${index == 0 ? /*html*/`
                            &lt;h4 style="font-weight: bold">${thread.title}&lt;/h4>
                        ` : ''}

                        &lt;!-- Author header -->
                        &lt;div ${index == 0 ? `style="margin-bottom: 32px;"` : ""} class="discussionHeader">
                            ${post.author ? /*html*/`
                                &lt;img src="${post.author.photoURL}" />
                                &lt;h5>${post.author.name}&lt;/h5>
                            ` : ``}

                            &lt;i class="fluid-icon">calendar_today&lt;/i>
                            &lt;span>${dtps.formatDate(post.postedAt)}&lt;/span>

                            &lt;!-- Thread info (initial post) -->
                            ${index == 0 ? /*html*/`
                                ${thread.locked ? `&lt;i class="fluid-icon">lock&lt;/i>` : ""}
                                ${thread.requireInitialPost ? /*html*/`
                                    &lt;i class="fluid-icon">visibility&lt;/i>
                                    &lt;span>You must post before you can see other replies&lt;/span>
                                ` : ""}
                            ` : ''}
                        &lt;/div>
         
                        ${index == 0 ? /*html*/`
                            &lt;iframe id="classThreadIframe" onload="dtps.iframeLoad('classThreadIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${discussionPostContentURL}" />
                        ` : post.body}

                        ${replyHTML.join("")}

                        &lt;!-- Reply / Add post footer -->
                        ${post.replyURL ? /*html*/`
                            &lt;div ${index == 0 ? `style="margin-top: 32px;"` : ""} class="discussionFooter">
                                ${index == 0 ? /*html*/`
                                    &lt;button onclick="window.open('${post.replyURL}')" class="btn small">&lt;i class="fluid-icon">post_add&lt;/i> Add Post&lt;/button>
                                ` : /*html*/`
                                    &lt;button onclick="window.open('${post.replyURL}')" class="btn small">&lt;i class="fluid-icon">reply&lt;/i> Reply&lt;/button>
                                `}
                            &lt;/div> 
                        ` : ""}
                    &lt;/div>
                `);
        });

        //Render HTML
        if ((dtps.selectedClass == classNum) &amp;&amp; ((dtps.selectedContent == "discuss") || fromModules)) {
            jQuery(".classContent").html((fromModules ? /*html*/`
                &lt;button style="margin: 10px 0px 0px 20px;" class="btn" onclick="fluid.screen('moduleStream', '${dtps.classes[classNum].id}')">
                    &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i> Back
                &lt;/button>
            ` : "") + postHTML.join(""));

            //Jump to post if specified
            if (defaultPost) {
                $("[data-post-id=" + defaultPost + "]").get(0).scrollIntoView();
            }
        }
    }).catch(function (err) {
        dtps.error("Could not fetch discussion posts", "Caught promise rejection @ dtps.loadThreadPosts", err);
    });
}

/**
 * Renders the pages list for a class
 * 
 * @param {string} courseID The course ID to render pages for
 * @param {string} [defaultPage] If provided, load the pageID by default
 * @param {boolean} fromModules True if this page is being loaded from the moduleStream
 */
dtps.loadPagesList = function (courseID, defaultPage, fromModules) {
    //Get class index and set as selected class
    var classNum = dtps.classes.map(course => course.id).indexOf(courseID);
    dtps.selectedClass = classNum;

    //Set pages as the selected content
    if (!fromModules) {
        dtps.selectedContent = "pages";
        $("#dtpsTabBar .btn").removeClass("active");
        $("#dtpsTabBar .btn.pages").addClass("active");
        jQuery("body").removeClass("collapsedSidebar");
    }

    if (classNum == -1) {
        //Class does not exist
        dtps.error("The selected class doesn't exist", "classNum check failed @ dtps.loadPagesList");
    }

    //Load class color and things
    dtps.presentClass(classNum);

    //Load module page
    if (fromModules) {
        dtps.loadPage(classNum, defaultPage, fromModules);
        return;
    }

    if ((dtps.selectedClass == classNum) &amp;&amp; (dtps.selectedContent == "pages")) {
        //Render sidebar
        jQuery(".sidebar").html(/*html*/`
            &lt;div class="title">
                &lt;i style="font-size: 28px; margin-right: 7px; vertical-align: middle;" class="fluid-icon">insert_drive_file&lt;/i>
                &lt;h4>Pages&lt;/h4>
             &lt;/div>

             &lt;div class="items">
                &lt;div onclick="fluid.screen('stream', '${dtps.classes[classNum].id}');" class="item main back">
                    &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i> &lt;span class="label">Classes&lt;/span>
                &lt;/div>

                &lt;div class="divider">&lt;/div>

                &lt;div class="item shimmerParent">
                    &lt;i class="fluid-icon">star&lt;/i>
                    &lt;span class="label">Class page title&lt;/span>
                &lt;/div>
                &lt;div class="item shimmerParent">
                    &lt;i class="fluid-icon">star&lt;/i>
                    &lt;span class="label">Class page title&lt;/span>
                &lt;/div>
                &lt;div class="item shimmerParent">
                    &lt;i class="fluid-icon">star&lt;/i>
                    &lt;span class="label">Class page title&lt;/span>
                &lt;/div>
            &lt;/div>
        `);

        //Delete existing class content HTML
        jQuery(".classContent").html("");
    }

    dtpsLMS.fetchPages(dtps.classes[classNum].lmsID).then(function (pagesData) {
        //Store fetched pages data to the class
        dtps.classes[classNum].pages = pagesData;

        if (pagesData.length == 0) {
            //No pages in this class
            jQuery(".sidebar .items").html(/*html*/`
                &lt;div onclick="fluid.screen('stream', '${dtps.classes[classNum].id}');" class="item main back">
                    &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i>
                    &lt;span class="label">Classes&lt;/span>
                &lt;/div>

                &lt;p style="text-align: center; font-weight: bold; margin-top: 60px; margin-bottom: 10px;">No pages found&lt;/p>
                &lt;p style="text-align: center; font-size: 14px; margin: 0px;">This class doesn't have any pages&lt;/p>
            `);
        } else {
            //Loop over discusson threads array to create discussion thread HTML for the sidebar
            var pageHTML = dtps.classes[classNum].pages.map(page => {
                return /*html*/`
                    &lt;div data-pageID="${page.id}" class="item ${(defaultPage &amp;&amp; (page.id == defaultPage)) ? "active" : ""}">
                        &lt;i class="fluid-icon">insert_drive_file&lt;/i>    
                        &lt;span class="label">${page.title}&lt;/span>
                    &lt;/div>
                `;
            }).join("");

            //Render discussion threads in the sidebar
            if ((dtps.selectedClass == classNum) &amp;&amp; (dtps.selectedContent == "pages")) {
                jQuery(".sidebar .items").html(/*html*/`
                    &lt;div onclick="fluid.screen('stream', '${dtps.classes[classNum].id}');" class="item main back">
                        &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i>    
                        &lt;span class="label">Classes&lt;/span>
                    &lt;/div>

                    &lt;div class="divider">&lt;/div>

                    ${pageHTML}
                `);
            }

            //Load default page if provided
            if (defaultPage) {
                dtps.loadPage(classNum, defaultPage);
            }

            //Add click event listeners for pages
            $(".sidebar .item:not(.back)").click(function (event) {
                //Show the selected thread as active
                $(this).siblings().removeClass("active");
                $(this).addClass("active");

                //Get page ID from HTML attribute
                var pageID = $(this).attr("data-pageID");

                //Load the page content
                dtps.loadPage(classNum, pageID);
            });
        }
    }).catch((err) => {
        dtps.error("Couldn't fetch pages", "Caught promise rejection @ dtps.loadPagesList", err);
    });
}

/**
 * Fetches and renders a page and its contents
 * 
 * @param {string} classNum The class number of the page to render
 * @param {string} pageID The page ID to render
 * @param {boolean} fromModules True if this page is being loaded from the moduleStream
 */
dtps.loadPage = function (classNum, pageID, fromModules) {
    //Show loading indicator
    if ((dtps.selectedClass == classNum) &amp;&amp; ((dtps.selectedContent == "pages") || fromModules)) {
        jQuery(".classContent").html(/*html*/`
             &lt;div style="margin: 20px; padding: 20px;">
                &lt;h4>&lt;span class="shimmer">[SHIMMER] Class page title&lt;/span>&lt;/h4>

                &lt;div style="margin-bottom: 32px;" class="discussionHeader">
                    &lt;h5 class="shimmer">Page author name&lt;/h5>

                    &lt;i class="fluid-icon shimmer">calendar_today&lt;/i>
                    &lt;span class="shimmer">[SHIMMER] Last updated at&lt;/span>
                &lt;/div>

                &lt;!-- Page content -->
                &lt;br />
                &lt;div class="shimmer" style="margin: 10px 0px; width: 100%; height: 600px; border: none; outline: none;">&lt;/div>
            &lt;/div>
         `);
    }

    //Fetch page content
    dtpsLMS.fetchPageContent(dtps.classes[classNum].lmsID, pageID).then(function (page) {
        if ((dtps.selectedClass == classNum) &amp;&amp; ((dtps.selectedContent == "pages") || fromModules)) {
            //Get computed background and text color to style the iFrame with
            var computedBackgroundColor = getComputedStyle($(".classContent")[0]).getPropertyValue("--background");
            var computedTextColor = getComputedStyle($(".card.details")[0]).getPropertyValue("--text");

            //Generate a blob with the page content and get its data URL
            var blob = new Blob([`
                &lt;base target="_blank" /> 
                &lt;link type="text/css" rel="stylesheet" href="https://cdn.jottocraft.com/CanvasCSS.css" media="screen,projection"/>
                &lt;style>body {background-color: ${computedBackgroundColor}; color: ${computedTextColor};&lt;/style>
                ${page.content}
            `], { type: 'text/html' });

            //Get URL from blob
            var pageContentURL = window.URL.createObjectURL(blob);

            //Render page card in the class content
            jQuery(".classContent").html(/*html*/`
                ${fromModules ? /*html*/`
                    &lt;button style="margin: 10px 0px 0px 20px;" class="btn" onclick="fluid.screen('moduleStream', '${dtps.classes[classNum].id}')">
                        &lt;i class="fluid-icon">keyboard_arrow_left&lt;/i> Back
                    &lt;/button>
                ` : ""}
                &lt;div style="margin: 20px; padding: 20px;">
                    &lt;!-- Page title -->
                    &lt;h4 style="font-weight: bold;">${page.title}&lt;/h4>

                    &lt;!-- Page header -->
                    &lt;div style="margin-bottom: 32px;" class="discussionHeader">
                        ${page.author ? /*html*/`
                            &lt;img src="${page.author.photoURL}" />
                            &lt;h5>${page.author.name}&lt;/h5>
                        ` : ``}

                        &lt;i class="fluid-icon">calendar_today&lt;/i>
                        &lt;span>${"Last Updated " + dtps.formatDate(page.updatedAt)}&lt;/span>
                    &lt;/div>

                    &lt;!-- Page content -->
                    &lt;br />
                    &lt;iframe id="classPageIframe" onload="dtps.iframeLoad('classPageIframe')" style="margin: 10px 0px; width: 100%; border: none; outline: none;" src="${pageContentURL}" />
                &lt;/div>
            `);
        }
    }).catch((err) => {
        dtps.error("Couldn't load page", "Caught promise rejection @ dtps.loadPage", err);
    });
}

//Fluid UI screen definitions
fluid.externalScreens.discussions = (param) => {
    //Split parameter string into variables
    var courseID = param.split("|")[0];
    var threadID = param.split("|")[1];
    var fromModules = param.split("|")[2] == "true";
    var postID = param.split("|")[3];

    dtps.loadThreadsList(courseID, threadID, fromModules, postID);
}

fluid.externalScreens.pages = (param) => {
    //Split parameter string into variables
    var courseID = param.split("|")[0];
    var pageID = param.split("|")[1];
    var fromModules = param.split("|")[2] == "true";

    dtps.loadPagesList(courseID, pageID, fromModules);
}

//Type definitions

/**
* @typedef {Object} PartialDiscussionThread
* @description Defines partial discussion thread objects in DTPS (for threads list)
* @property {string} title Title of the discussion thread
* @property {string} id Discussion thread ID
* @property {boolean} [locked] True if posting to the discussion thread is locked
*/

/**
* @typedef {Object} DiscussionThread
* @description Defines discussion thread objects in DTPS
* @property {string} title Title of the discussion thread
* @property {string} id Discussion thread ID
* @property {DiscussionPost[]} posts Posts in this thread, with the initial one first.
* @property {boolean} [locked] True if posting to the discussion thread is locked
* @property {boolean} [requireInitialPost] True if the user must post before viewing others' posts
*/

/**
* @typedef {Object} DiscussionPost
* @description Defines discussion post objects in DTPS
* @property {string} id Discussion post ID
* @property {string} body Discussion post body HTML
* @property {Date} postedAt Date for when the post was posted
* @property {number} [depth] The depth level this post is
* @property {User} [author] Discussion post author
* @property {DiscussionPost[]} [replies] Replies to this post. Nested replies (replies to replies) should be after this post in the array with a depth of 1, not in the replies key.
* @property {string} [replyURL] A URL that the user can visit to reply to this post
*/

/**
* @typedef {Object} PartialPage
* @description Defines a partial page object in DTPS (for pages list)
* @property {string} title Page title
* @property {string} id Page ID
*/

/**
* @typedef {Object} Page
* @description Defines Page objects in DTPS
* @property {string} title Page title
* @property {string} id Page ID
* @property {string} content Page content HTML
* @property {Date} [updatedAt] When the page was last updated
* @property {User} [author] Page author
*/</code></pre>
		</section>
			</div>
		</div>
	</div>
	<footer>
				<div class="footer-option"><img style='height: 32px; margin: 10px 0px;' src='https://cdn.jottocraft.com/images/footerImage.png' /></div>
				<div class="copyright">(c) 2018-2021 jottocraft. All rights reserved.</div>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on 8th Jan 2021 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:source.tmpl.hbs -->