<!-- start:source.tmpl.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>search.js</title>
		<link rel="icon" type="image/png" href="favicon.png"/>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
			<style>
				.page-header,
				pre.code-toolbar > .toolbar:hover {
					background-color: #c5982f;
				}
				.callout-primary,
				.toc .nav > li > a:hover,
				.toc .nav > li > a:focus,
				.toc .nav > li.active > a,
				.toc .nav > li.active > a:hover,
				.toc .nav > li.active > a:focus,
				pre.code-toolbar > .toolbar:hover {
					border-left-color: #c5982f;
				}
				pre.code-toolbar > .toolbar:hover {
					border-bottom-color: #c5982f;
				}
				.callout-primary h5,
				.symbol-title.collapsible-symbol .toggle-icon,
				.breadcrumb li a,
				.toc .nav > li > a:hover,
				.toc .nav > li > a:focus,
				.toc .nav > li.active > a,
				.toc .nav > li.active > a:hover,
				.toc .nav > li.active > a:focus {
					color: #c5982f;
				}
			</style>
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"Power+ Docs","systemSummary":"Reference documentation for the latest version of Power+","systemLogo":"img/favicon.png","systemColor":"#c5982f","navMembers":[{"kind":"class","title":"Classes","summary":"All documented classes."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"namespace","title":"Namespaces","summary":"All documented namespaces."},{"kind":"tutorial","title":"Tutorials","summary":"All available tutorials."}],"footer":"<img style='height: 32px; margin: 10px 0px;' src='https://cdn.jottocraft.com/images/footerImage.png' />","copyright":"(c) 2018-2021 jottocraft. All rights reserved.","linenums":true,"collapseSymbols":false,"inverseNav":true,"inlineNav":false,"outputSourceFiles":true,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"linenum, longname, version, since","search":true,"favicon":"favicon.png","stylesheets":[],"scripts":[],"monospaceLinks":false,"cleverLinks":false};
			window.DOCLET_TOC_ENABLED = false;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand branding-logo" href="index.html" style="background-image: url(img/favicon.png);">
					Power+ Docs
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="global.html#Announcement">Announcement</a></li>
											<li><a href="global.html#Assignment">Assignment</a></li>
											<li><a href="global.html#AssignmentFeedback">AssignmentFeedback</a></li>
											<li><a href="global.html#Class">Class</a></li>
											<li><a href="global.html#ClassSection">ClassSection</a></li>
											<li><a href="global.html#DashboardItem">DashboardItem</a></li>
											<li><a href="global.html#Date">Date</a></li>
											<li><a href="global.html#DiscussionPost">DiscussionPost</a></li>
											<li><a href="global.html#DiscussionThread">DiscussionThread</a></li>
											<li><a href="global.html#Module">Module</a></li>
											<li><a href="global.html#ModuleItem">ModuleItem</a></li>
											<li><a href="global.html#Page">Page</a></li>
											<li><a href="global.html#PartialDiscussionThread">PartialDiscussionThread</a></li>
											<li><a href="global.html#PartialPage">PartialPage</a></li>
											<li><a href="global.html#RubricItem">RubricItem</a></li>
											<li><a href="global.html#SearchData">SearchData</a></li>
											<li><a href="global.html#User">User</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_namespace.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="dtps.html">dtps</a></li>
											<li><a href="dtpsLMS.html">dtpsLMS</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">source</span>
				<h1><span class="name">search.js</span></h1>
			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-12 main-content">
		<section class="source-section">
			<article></article>
			<pre class="prettyprint source language-javascript line-numbers"><code class="language-javascript">/**
 * @file DTPS global search
 * @author jottocraft
 * 
 * @copyright Copyright (c) 2018-2021 jottocraft. All rights reserved.
 * @license GPL-2.0-only
 */


/**
 * Searches Power+ globally and shows results on the "Search Results" screen
 * 
 * @param term {string} The search term typed in the input box
 */
dtps.globalSearch = function (param) {
    var term = param.term;
    var type = param.type;
    var courseNum = param.course;

    $("#dtpsMainSearchBox").attr("data-search-type", param.type).attr("data-dtps-course", param.course).attr("data-ctx-type", param.ctxType).attr("data-ctx-course", param.ctxCourse);

    //Ensure classes are rendered in the sidebar
    dtps.presentClass("search");
    dtps.showClasses();
    dtps.selectedContent = "stream";

    //Clear active state from all tabs
    $("#dtpsTabBar .btn").removeClass("active");

    jQuery(".classContent").html([1, 2, 3, 4].map(() => (
        /*html*/`
            &lt;div class="card assignment graded">
                &lt;h4>
                    &lt;span style="width: 450px;" class="shimmer">Assignment Title&lt;/span>
                    &lt;div class="points shimmer">00/00&lt;/div>
                &lt;/h4>

                &lt;h5 style="white-space: nowrap; overflow: hidden;">
                    &lt;div style="width: 200px;" class="infoChip shimmer">&lt;/div>
                    &lt;i class="fluid-icon statusIcon shimmer">more_horiz&lt;/i>
                &lt;/h5>
            &lt;/div>
        `
    )).join(""));

    //Fetch everything
    var dataset = [];
    var datasetPromises = [];
    var checkedCourses = [];

    (courseNum == "all" ? dtps.classes : [dtps.classes[Number(courseNum)]]).forEach(course => {
        if ((type == "assignments") || (type == "coursework") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.assignments) return resolve([]);
                resolve(course.assignments.map(assignment => ({
                    title: assignment.title,
                    class: course.num,
                    body: $('&lt;div>' + assignment.body + '&lt;/div>').text(),
                    onclick: "dtps.assignment('" + assignment.id + "', " + assignment.class + ")",
                    locatedIn: assignment.category ? assignment.category : "Assignment",
                    icon: "assignment",
                    type: "assignment",
                    infoIcons: [
                        assignment.dueAt ? "alarm" : null,
                        dtps.user.parent ? "person" : null
                    ].filter(i => i),
                    info: [
                        assignment.dueAt ? "Due: " + dtps.formatDate(assignment.dueAt) : null,
                        dtps.user.parent ? dtps.user.children.find(c => c.id == course.userID).name : null
                    ].filter(i => i).join("$|$"),
                    icons: [
                        {
                            icon: assignment.missing ? "remove_circle_outline" : null,
                            state: "missing"
                        },
                        {
                            icon: assignment.turnedIn ? "assignment_turned_in" : null,
                            state: "turnedIn"
                        },
                        {
                            icon: assignment.locked ? "lock_outline" : null,
                            state: "locked"
                        },
                        {
                            icon: assignment.late ? "assignment_late" : null,
                            state: "late"
                        }
                    ].filter(i => i.icon)
                })));
            }));
        }

        if ((type == "grades") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.assignments) return resolve([]);
                var res = [];

                course.assignments.forEach(assignment => {
                    if (dtpsLMS.useRubricGrades &amp;&amp; assignment.rubric) {
                        assignment.rubric.forEach(rubric => {
                            if (rubric.score) {
                                res.push({
                                    title: assignment.title,
                                    class: course.num,
                                    onclick: "dtps.assignment('" + assignment.id + "', " + assignment.class + ")",
                                    locatedIn: rubric.title,
                                    icon: "assessment",
                                    infoIcons: [
                                        "bar_chart",
                                        dtps.user.parent ? "person" : null
                                    ].filter(i => i),
                                    info: [
                                        "Score: " + rubric.score + "/" + rubric.value + (rubric.scoreName ? " " + rubric.scoreName : ""),
                                        dtps.user.parent ? dtps.user.children.find(c => c.id == course.userID).name : null
                                    ].filter(i => i).join("$|$"),
                                    icons: []
                                });
                            }
                        });
                    } else if (assignment.grade) {
                        res.push({
                            title: assignment.title,
                            class: course.num,
                            onclick: "dtps.assignment('" + assignment.id + "', " + assignment.class + ")",
                            locatedIn: "Grade",
                            icon: "assessment",
                            infoIcons: [
                                "bar_chart",
                                dtps.user.parent ? "person" : null
                            ].filter(i => i),
                            info: [
                                "Score: " + assignment.grade + "/" + assignment.value + " (" + Math.round((assignment.grade / assignment.value) * 100) + "%" + (assignment.letter ? ", " + assignment.letter : "") + ")",
                                dtps.user.parent ? dtps.user.children.find(c => c.id == course.userID).name : null
                            ].filter(i => i).join("$|$"),
                            icons: []
                        });
                    }
                });

                resolve(res);
            }));
        }

        //Check if this course has already been checked
        if (checkedCourses.includes(course.lmsID)) return;
        checkedCourses.push(course.lmsID);

        if ((type == "modules") || (type == "coursework") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.modules) return resolve([]);
                new Promise(resolve => {
                    if (course.modules &amp;&amp; (course.modules !== true)) {
                        resolve(course.modules);
                    } else {
                        dtpsLMS.fetchModules(dtps.user.id, course.lmsID).then(data => resolve(data));
                    }
                }).then(data => {
                    var res = [];
                    data.forEach(module => {
                        module.items.forEach(item => {
                            //Prevent assignments from showing twice in coursework search results
                            //(since assignments can appear in both assignments and modules tab)
                            if ((item.type == "assignment") &amp;&amp; (type == "coursework")) return;

                            item.locatedIn = module.title;
                            res.push(item);
                        });
                    });

                    resolve(res.map(item => ({
                        title: item.title,
                        class: course.num,
                        url: item.url,
                        locatedIn: item.locatedIn,
                        icon: "view_module",
                        infoIcons: [
                            "category"
                        ].filter(i => i),
                        info: [
                            "Type: " + item.type
                        ].filter(i => i).join("$|$"),
                        icons: [
                            {
                                icon: item.completed ? "check" : null,
                                keywords: "completed done submitted"
                            }
                        ].filter(i => i.icon)
                    })));
                }).catch(() => resolve([]));
            }));
        }

        if ((type == "homepages") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.homepage) return resolve([]);
                dtpsLMS.fetchHomepage(course.lmsID).then(data => {
                    resolve([{
                        title: course.subject + " Homepage",
                        class: course.num,
                        onclick: "dtps.classHome(" + course.num + ");",
                        locatedIn: course.subject,
                        icon: "home",
                        body: $('&lt;div>' + data + '&lt;/div>').text(),
                        icons: []
                    }]);
                }).catch(() => resolve([]));
            }));
        }

        if ((type == "pages") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.pages) return resolve([]);
                dtpsLMS.fetchPages(course.lmsID).then(pages => {
                    Promise.all(pages.map(page => (
                        dtpsLMS.fetchPageContent(course.lmsID, page.id)
                    ))).then(pages => {
                        resolve(pages.map(page => ({
                            title: page.title,
                            class: course.num,
                            onclick: "fluid.screen('pages', '" + course.id + "|" + page.id + "');",
                            body: $('&lt;div>' + page.content + '&lt;/div>').text(),
                            locatedIn: "Page",
                            icon: "insert_drive_file",
                            infoIcons: [
                                page.author &amp;&amp; page.author.name ? "person" : null
                            ].filter(i => i),
                            info: [
                                page.author &amp;&amp; page.author.name ? "Author: " + page.author &amp;&amp; page.author.name : null
                            ].filter(i => i).join("$|$"),
                            icons: []
                        })));
                    })
                }).catch(() => resolve([]));
            }));
        }

        if ((type == "discussions") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.discussions) return resolve([]);
                dtpsLMS.fetchDiscussionThreads(course.lmsID).then(discussions => {
                    Promise.all(discussions.map(discussion => (
                        dtpsLMS.fetchDiscussionPosts(course.lmsID, discussion.id)
                    ))).then(discussions => {
                        var res = [];
                        discussions.forEach(discussion => {
                            discussion.posts.forEach(post => {
                                post.locatedIn = discussion.title;
                                post.threadID = discussion.id;
                                res.push(post);

                                if (post.replies) {
                                    post.replies.forEach(reply => {
                                        reply.locatedIn = discussion.title;
                                        reply.threadID = discussion.id;
                                        res.push(reply);
                                    });
                                }
                            })
                        });
                        resolve(res.map(post => ({
                            body: $('&lt;div>' + post.body + '&lt;/div>').text(),
                            class: course.num,
                            onclick: "fluid.screen('discussions', '" + course.id + "|" + post.threadID + "|false|" + post.id + "');",
                            locatedIn: post.locatedIn,
                            icon: "forum",
                            infoIcons: [
                                post.author &amp;&amp; post.author.name ? "person" : null,
                                post.postedAt ? "calendar_today" : null
                            ].filter(i => i),
                            info: [
                                post.author &amp;&amp; post.author.name ? "Author: " + post.author &amp;&amp; post.author.name : null,
                                post.postedAt ? "Posted At: " + dtps.formatDate(post.postedAt) : null
                            ].filter(i => i).join("$|$"),
                            icons: []
                        })));
                    })
                }).catch(() => resolve([]));
            }));
        }

        if ((type == "people") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                if (!course.people) return resolve([]);
                new Promise(resolve => {
                    if (course.people &amp;&amp; (course.people !== true)) {
                        resolve(course.people);
                    } else {
                        dtpsLMS.fetchUsers(course.lmsID).then(data => resolve(data));
                    }
                }).then(data => {
                    var res = [];
                    data.forEach(section => {
                        section.users.forEach(user => {
                            user.locatedIn = section.title;
                            res.push(user);
                        });
                    });
                    resolve(res.map(person => ({
                        title: person.name,
                        class: course.num,
                        url: person.url,
                        locatedIn: person.locatedIn,
                        icon: "people",
                        icons: []
                    })));
                }).catch(() => resolve([]));
            }));
        }

        if ((type == "announcements") || (type == "everything")) {
            datasetPromises.push(new Promise((resolve, reject) => {
                dtpsLMS.fetchAnnouncements(course.lmsID).then(announcements => {
                    resolve(announcements.map((announcement) => ({
                        title: announcement.title,
                        url: announcement.url,
                        class: course.num,
                        locatedIn: course.subject,
                        icon: "announcement",
                        body: $('&lt;div>' + announcement.body + '&lt;/div>').text(),
                        infoIcons: [
                            "calendar_today"
                        ].filter(i => i),
                        info: [
                            "Posted at: " + dtps.formatDate(announcement.postedAt)
                        ].filter(i => i).join("$|$"),
                        icons: []
                    })));
                }).catch(() => resolve([]));
            }));
        }
    });

    Promise.all(datasetPromises).then(results => {
        results.forEach(result => {
            dataset = dataset.concat(result);
        });

        var idx = lunr(function () {
            this.ref('id');
            this.field('title');
            this.field('body');
            this.field('locatedIn');
            this.field('info');
            this.metadataWhitelist = ['position'];

            dataset.forEach(function (doc, i) {
                this.add({
                    id: i,
                    ...doc
                });
            }, this)
        });

        var result = idx.search(term);
        var resHTML = result.map(res => dtps.renderSearchResult(dataset[Number(res.ref)], res.matchData.metadata, courseNum == "all")).join("");

        if (dtps.selectedClass == "search") {
            $(".headerArea .contentLabel i").text("find_in_page");
            $(".headerArea .contentLabel span").text(result.length + " results");
            $(".headerArea .contentLabel").show();

            $(".classContent").html(/*html*/`
                &lt;div ${!["assignments", "coursework"].includes(type) ? `style="display: none;"` : ``} id="searchFilterContainer">
                    &lt;div id="searchFilterCard" class="card">
                        &lt;h5>&lt;i class="fluid-icon">filter_alt&lt;/i>&lt;span>Filters&lt;/span>&lt;/h5>
                        &lt;div class="checkContainer">
                            &lt;div id="missingSearchFilter" init="true" onclick="dtps.filterSearch(this)" class="checkbox">&lt;i class="fluid-icon">check&lt;/i>&lt;/div> 
                            &lt;div class="label">&lt;i class="fluid-icon">remove_circle_outline&lt;/i> Missing&lt;/div> 
                        &lt;/div>
                        &lt;div class="checkContainer">
                            &lt;div id="turnedInSearchFilter" init="true" onclick="dtps.filterSearch(this)" class="checkbox">&lt;i class="fluid-icon">check&lt;/i>&lt;/div> 
                            &lt;div class="label">&lt;i class="fluid-icon">assignment_turned_in&lt;/i> Turned in&lt;/div> 
                        &lt;/div>
                        &lt;div class="checkContainer">
                            &lt;div id="lateSearchFilter" init="true" onclick="dtps.filterSearch(this)" class="checkbox">&lt;i class="fluid-icon">check&lt;/i>&lt;/div> 
                            &lt;div class="label">&lt;i class="fluid-icon">assignment_late&lt;/i> Late&lt;/div> 
                        &lt;/div>
                        &lt;div class="checkContainer">
                            &lt;div id="lockedSearchFilter" init="true" onclick="dtps.filterSearch(this)" class="checkbox">&lt;i class="fluid-icon">check&lt;/i>&lt;/div> 
                            &lt;div class="label">&lt;i class="fluid-icon">lock_outline&lt;/i> Locked&lt;/div> 
                        &lt;/div>
                    &lt;/div>
                &lt;/div>
                &lt;div ${["assignments", "coursework"].includes(type) ? `class="withFilters"` : ``} id="searchResultsContainer">
                    ${resHTML}
                &lt;/div>
            `);

            if (!dtps.searchScrollListener) {
                dtps.searchScrollListener = true;
                var searchFilters = document.getElementById("searchFilterCard");
                var sticky = searchFilters.offsetTop - parseFloat($("body").css("padding-top"));
                window.onscroll = function () {
                    if ((window.pageYOffset >= sticky) &amp;&amp; (dtps.selectedClass == "search")) {
                        $(".classContent").addClass("fixedSearchFilters");
                    } else {
                        $(".classContent").removeClass("fixedSearchFilters");
                    }
                };
            }
        }

        /**
        * Filters search results
        * 
        * @param {Element|string} [toggleItem] The selector for the element to toggle
        */
        dtps.filterSearch = function (toggleItem) {
            if (toggleItem) $(toggleItem).toggleClass("active");

            //Check for enabled filters
            var missingFilter = $("#missingSearchFilter").hasClass("active");
            var turnedInFilter = $("#turnedInSearchFilter").hasClass("active");
            var lateFilter = $("#lateSearchFilter").hasClass("active");
            var lockedFilter = $("#lockedSearchFilter").hasClass("active");

            var filtersActive = missingFilter || turnedInFilter || lateFilter || lockedFilter;

            var filterRes = result.filter(function (res) {
                var item = dataset[Number(res.ref)];

                if (!filtersActive) return true;

                if (item.type == "assignment") {
                    if (missingFilter &amp;&amp; item.icons.map(i => i.state).includes("missing")) return true;
                    if (turnedInFilter &amp;&amp; item.icons.map(i => i.state).includes("turnedIn")) return true;
                    if (lateFilter &amp;&amp; item.icons.map(i => i.state).includes("late")) return true;
                    if (lockedFilter &amp;&amp; item.icons.map(i => i.state).includes("locked")) return true;
                }

                return false;
            });

            var filterHTML = filterRes.map(res => dtps.renderSearchResult(dataset[Number(res.ref)], res.matchData.metadata, courseNum == "all")).join("");

            if (dtps.selectedClass == "search") {
                $(".headerArea .contentLabel i").text(filtersActive ? "filter_alt" : "find_in_page");
                $(".headerArea .contentLabel span").text(filterRes.length + " results");
                $(".headerArea .contentLabel").show();

                $("#searchResultsContainer").html(filterHTML);
            }
        }
    });
}

/**
 * Renders a Search data object into HTML for display in the search results list
 * 
 * @param {SearchData} result The search result to render
 * @param {Object[]} matchData The list of matches from Lunr
 * @param {boolean} [mixedClasses] True if there are results from multiple classes
 * @return {string} The HTML for this result in the results list
 */
dtps.renderSearchResult = function (result, matchData, mixedClasses) {

    if (!result.processed) {
        var matches = {};
        var matchTerms = Object.values(matchData);
        matchTerms.forEach(term => {
            Object.keys(term).forEach(k => {
                if (matches[k]) {
                    matches[k] = matches[k].concat(term[k].position);
                } else {
                    matches[k] = term[k].position;
                }
            });
        });
        matches = Object.keys(matches).map(k => ({ key: k, position: matches[k] }));

        //A function that highlights a string
        function highlightString(string, position) {
            var parts = string.split("");
            position.forEach(pos => {
                //highlight part
                parts.forEach((part, i) => {
                    if (i == pos[0]) {
                        parts[i] = '&lt;span class="highlight">' + parts[i];
                    }

                    if (i == (pos[0] + pos[1] - 1)) {
                        parts[i] = parts[i] + '&lt;/span>';
                    }
                });
            });

            return parts.join("");
        }

        //Highlight matches
        result.bodyParts = [];
        result.bodyOverflow = 0;
        matches.forEach(match => {
            if (match.key == "title") {
                result.title = highlightString(result.title, match.position);
            } else if (match.key == "locatedIn") {
                result.locatedIn = highlightString(result.locatedIn, match.position);
            } else if (match.key == "body") {
                //Get longest 2 matches
                var sections = match.position.sort((a, b) => b[1] - a[1]);
                var matchesToDisplay = 2;
                if (sections.length &lt; matchesToDisplay) matchesToDisplay = sections.length;
                result.bodyOverflow = sections.length - matchesToDisplay;

                for (var i = 0; i &lt; matchesToDisplay; i++) {
                    var matchStartIndex = sections[i][0];
                    var matchEndIndex = sections[i][0] + sections[i][1] - 1;

                    var startIndex = matchStartIndex - 10;
                    var endIndex = matchEndIndex + 10;

                    if (startIndex &lt; 0) startIndex = 0;
                    if (endIndex > (result.body.length - 1)) endIndex = result.body.length - 1;

                    var res = result.body.slice(startIndex, matchStartIndex) + '&lt;span class="highlight">' + result.body.slice(matchStartIndex, matchEndIndex + 1) + '&lt;/span>' + result.body.slice(matchEndIndex + 1, endIndex + 1);
                    result.bodyParts.push(res);
                }
            } else if (match.key == "info") {
                result.info = highlightString(result.info, match.position);
            }
        });

        //Map result info back into an array
        if (result.info) {
            result.info = result.info.split("$|$").map((info, i) => {
                return {
                    icon: result.infoIcons[i],
                    info: info,
                }
            });
        }

        //Mark this result as processed so it doesn't have to be re-highlighted if a filter is used
        result.processed = true;
    }

    return /*html*/`
        &lt;div 
            class="card searchResult ${mixedClasses ? "mixedClasses" : ""}"
            style="${'--classColor: ' + dtps.classes[result.class].color}"
            onclick="${result.onclick || (result.url &amp;&amp; "window.open('" + result.url + "')")}"
        >

            &lt;!-- Color bar for the dashboard -->
            &lt;div class="colorBar">&lt;/div>

            &lt;!-- Assignment title and points -->
            ${result.title ? `&lt;h4>${result.title}&lt;/h4>` : ""}

            &lt;h5>
                &lt;div class="infoChip">&lt;i style="margin-top: -2px;" class="fluid-icon">${result.icon}&lt;/i> ${result.locatedIn}&lt;/div>
                ${result.info ? result.info.map(info => (
        `&lt;div class="infoChip">&lt;i style="margin-top: -2px;" class="fluid-icon">${info.icon}&lt;/i> ${info.info}&lt;/div>`
    )).join("") : ""}
            &lt;/h5>

            ${result.bodyParts.map(part => (
        `&lt;p>&lt;span style="color: var(--secText);">...&lt;/span>${part}&lt;span style="color: var(--secText);">...&lt;/span>&lt;/p>`
    )).join("")}
            ${result.bodyOverflow ? `&lt;p style="color: var(--secText);">+${result.bodyOverflow} more matches&lt;/p>` : ""}

            &lt;h5>
                ${result.icons.map((icon, i) => (`&lt;i class="fluid-icon statusIcon">${icon.icon}&lt;/i>`)).join("")}
            &lt;/h5>
        &lt;/div>
    `;
}

//Fluid UI screen definitions
fluid.externalScreens.search = (term) => {
    dtps.globalSearch(term);
}

/**
 * @typedef {Object} SearchData
 * @description An object that can represent any type of data to be searched.
 * @property {string} [title] Result title
 * @property {string} [body] Result body (can be HTML)
 * @property {string} [url] A URL for opening this result in the LMS
 * @property {string} locatedIn Describes where this result was found (as specific as possible)
 * @property {string} icon The icon to use for this result. Should match (and is displayed with) the locatedIn property.
 * @property {Object[]} [info] Contains any info (e.g. due dates) for this result. Has an icon property, label property, and info property.
 * @property {Object[]} icons Status icons for this result. Has an "icon" property, for the icon, and a "keywords" property for a string with all of the search keywords for the icon.
 * @property {number} class The number of the class that this result is from
 */</code></pre>
		</section>
			</div>
		</div>
	</div>
	<footer>
				<div class="footer-option"><img style='height: 32px; margin: 10px 0px;' src='https://cdn.jottocraft.com/images/footerImage.png' /></div>
				<div class="copyright">(c) 2018-2021 jottocraft. All rights reserved.</div>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on 5th Jan 2021 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:source.tmpl.hbs -->